"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/@heygen+streaming-avatar@2.1.0";
exports.ids = ["vendor-chunks/@heygen+streaming-avatar@2.1.0"];
exports.modules = {

/***/ "(ssr)/../../node_modules/.pnpm/@heygen+streaming-avatar@2.1.0/node_modules/@heygen/streaming-avatar/lib/index.esm.js":
/*!**********************************************************************************************************************!*\
  !*** ../../node_modules/.pnpm/@heygen+streaming-avatar@2.1.0/node_modules/@heygen/streaming-avatar/lib/index.esm.js ***!
  \**********************************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AvatarQuality: () => (/* binding */ AvatarQuality),\n/* harmony export */   ConnectionQuality: () => (/* binding */ ConnectionQuality),\n/* harmony export */   ElevenLabsModel: () => (/* binding */ ElevenLabsModel),\n/* harmony export */   STTProvider: () => (/* binding */ STTProvider),\n/* harmony export */   StreamingEvents: () => (/* binding */ StreamingEvents),\n/* harmony export */   TaskMode: () => (/* binding */ TaskMode),\n/* harmony export */   TaskType: () => (/* binding */ TaskType),\n/* harmony export */   VoiceChatTransport: () => (/* binding */ VoiceChatTransport),\n/* harmony export */   VoiceEmotion: () => (/* binding */ VoiceEmotion),\n/* harmony export */   \"default\": () => (/* binding */ StreamingAvatar)\n/* harmony export */ });\n/* harmony import */ var livekit_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! livekit-client */ \"(ssr)/../../node_modules/.pnpm/livekit-client@2.11.3/node_modules/livekit-client/dist/livekit-client.esm.mjs\");\n/* harmony import */ var protobufjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! protobufjs */ \"(ssr)/../../node_modules/.pnpm/protobufjs@7.5.0/node_modules/protobufjs/index.js\");\n\n\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\r\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\n\nvar options = {\n\tsyntax: \"proto3\"\n};\nvar nested = {\n\tpipecat: {\n\t\tnested: {\n\t\t\tTextFrame: {\n\t\t\t\tfields: {\n\t\t\t\t\tid: {\n\t\t\t\t\t\ttype: \"uint64\",\n\t\t\t\t\t\tid: 1\n\t\t\t\t\t},\n\t\t\t\t\tname: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 2\n\t\t\t\t\t},\n\t\t\t\t\ttext: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 3\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tAudioRawFrame: {\n\t\t\t\tfields: {\n\t\t\t\t\tid: {\n\t\t\t\t\t\ttype: \"uint64\",\n\t\t\t\t\t\tid: 1\n\t\t\t\t\t},\n\t\t\t\t\tname: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 2\n\t\t\t\t\t},\n\t\t\t\t\taudio: {\n\t\t\t\t\t\ttype: \"bytes\",\n\t\t\t\t\t\tid: 3\n\t\t\t\t\t},\n\t\t\t\t\tsampleRate: {\n\t\t\t\t\t\ttype: \"uint32\",\n\t\t\t\t\t\tid: 4\n\t\t\t\t\t},\n\t\t\t\t\tnumChannels: {\n\t\t\t\t\t\ttype: \"uint32\",\n\t\t\t\t\t\tid: 5\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tTranscriptionFrame: {\n\t\t\t\tfields: {\n\t\t\t\t\tid: {\n\t\t\t\t\t\ttype: \"uint64\",\n\t\t\t\t\t\tid: 1\n\t\t\t\t\t},\n\t\t\t\t\tname: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 2\n\t\t\t\t\t},\n\t\t\t\t\ttext: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 3\n\t\t\t\t\t},\n\t\t\t\t\tuserId: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 4\n\t\t\t\t\t},\n\t\t\t\t\ttimestamp: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 5\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tFrame: {\n\t\t\t\toneofs: {\n\t\t\t\t\tframe: {\n\t\t\t\t\t\toneof: [\n\t\t\t\t\t\t\t\"text\",\n\t\t\t\t\t\t\t\"audio\",\n\t\t\t\t\t\t\t\"transcription\"\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfields: {\n\t\t\t\t\ttext: {\n\t\t\t\t\t\ttype: \"TextFrame\",\n\t\t\t\t\t\tid: 1\n\t\t\t\t\t},\n\t\t\t\t\taudio: {\n\t\t\t\t\t\ttype: \"AudioRawFrame\",\n\t\t\t\t\t\tid: 2\n\t\t\t\t\t},\n\t\t\t\t\ttranscription: {\n\t\t\t\t\t\ttype: \"TranscriptionFrame\",\n\t\t\t\t\t\tid: 3\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\nvar jsonDescriptor = {\n\toptions: options,\n\tnested: nested\n};\n\nvar ConnectionQuality;\n(function (ConnectionQuality) {\n    ConnectionQuality[\"UNKNOWN\"] = \"UNKNOWN\";\n    ConnectionQuality[\"GOOD\"] = \"GOOD\";\n    ConnectionQuality[\"BAD\"] = \"BAD\";\n})(ConnectionQuality || (ConnectionQuality = {}));\nvar AbstractConnectionQualityIndicator = /** @class */ (function () {\n    function AbstractConnectionQualityIndicator(onConnectionQualityChanged) {\n        this._connectionQuality = ConnectionQuality.UNKNOWN;\n        this.onConnectionQualityChanged = onConnectionQualityChanged;\n    }\n    Object.defineProperty(AbstractConnectionQualityIndicator.prototype, \"connectionQuality\", {\n        get: function () {\n            return this._connectionQuality;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    AbstractConnectionQualityIndicator.prototype.handleStatsChanged = function () {\n        var newConnectionQuality = this.calculateConnectionQuality();\n        if (newConnectionQuality !== this._connectionQuality) {\n            this._connectionQuality = newConnectionQuality;\n            this.onConnectionQualityChanged(newConnectionQuality);\n        }\n    };\n    AbstractConnectionQualityIndicator.prototype.start = function (params) {\n        this.stop(true);\n        this._start(params);\n    };\n    AbstractConnectionQualityIndicator.prototype.stop = function (muted) {\n        if (muted === void 0) { muted = false; }\n        this._stop();\n        this._connectionQuality = ConnectionQuality.UNKNOWN;\n        if (!muted) {\n            this.onConnectionQualityChanged(ConnectionQuality.UNKNOWN);\n        }\n    };\n    return AbstractConnectionQualityIndicator;\n}());\nfunction QualityIndicatorMixer() {\n    var configs = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        configs[_i] = arguments[_i];\n    }\n    var CombinedQualityIndicator = /** @class */ (function (_super) {\n        __extends(CombinedQualityIndicator, _super);\n        function CombinedQualityIndicator(onConnectionQualityChanged) {\n            var _this = _super.call(this, onConnectionQualityChanged) || this;\n            _this.childTrackers = configs.map(function (_a) {\n                var getParams = _a.getParams, TrackerClass = _a.TrackerClass;\n                return ({\n                    tracker: new TrackerClass(function () { return _this.handleStatsChanged(); }),\n                    getParams: getParams,\n                });\n            });\n            return _this;\n        }\n        CombinedQualityIndicator.prototype.calculateConnectionQuality = function () {\n            var connectionQualities = this.childTrackers.map(function (_a) {\n                var tracker = _a.tracker;\n                return tracker.connectionQuality;\n            });\n            if (connectionQualities.some(function (quality) { return quality === ConnectionQuality.BAD; })) {\n                return ConnectionQuality.BAD;\n            }\n            if (connectionQualities.every(function (quality) { return quality === ConnectionQuality.UNKNOWN; })) {\n                return ConnectionQuality.UNKNOWN;\n            }\n            return ConnectionQuality.GOOD;\n        };\n        CombinedQualityIndicator.prototype._start = function (params) {\n            this.childTrackers.forEach(function (_a) {\n                var tracker = _a.tracker, getParams = _a.getParams;\n                return tracker.start(getParams(params));\n            });\n        };\n        CombinedQualityIndicator.prototype._stop = function () {\n            this.childTrackers.forEach(function (_a) {\n                var tracker = _a.tracker;\n                return tracker.stop(true);\n            });\n        };\n        return CombinedQualityIndicator;\n    }(AbstractConnectionQualityIndicator));\n    return CombinedQualityIndicator;\n}\n\nvar LiveKitConnectionQualityIndicator = /** @class */ (function (_super) {\n    __extends(LiveKitConnectionQualityIndicator, _super);\n    function LiveKitConnectionQualityIndicator() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.room = null;\n        _this.liveKitConnectionQuality = livekit_client__WEBPACK_IMPORTED_MODULE_0__.ConnectionQuality.Unknown;\n        _this.liveKitConnectionState = null;\n        _this.handleConnectionQualityChanged = function (quality) {\n            _this.liveKitConnectionQuality = quality;\n            _this.handleStatsChanged();\n        };\n        _this.handleConnectionStateChanged = function (state) {\n            _this.liveKitConnectionState = state;\n            _this.handleStatsChanged();\n        };\n        return _this;\n    }\n    LiveKitConnectionQualityIndicator.prototype._start = function (room) {\n        this.room = room;\n        this.room.localParticipant.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.ParticipantEvent.ConnectionQualityChanged, this.handleConnectionQualityChanged);\n        this.room.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ConnectionStateChanged, this.handleConnectionStateChanged);\n    };\n    LiveKitConnectionQualityIndicator.prototype._stop = function () {\n        if (this.room) {\n            this.room.localParticipant.off(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ConnectionQualityChanged, this.handleConnectionQualityChanged);\n            this.room.off(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.ConnectionStateChanged, this.handleConnectionStateChanged);\n        }\n    };\n    LiveKitConnectionQualityIndicator.prototype.calculateConnectionQuality = function () {\n        if ([livekit_client__WEBPACK_IMPORTED_MODULE_0__.ConnectionQuality.Lost, livekit_client__WEBPACK_IMPORTED_MODULE_0__.ConnectionQuality.Poor].includes(this.liveKitConnectionQuality)) {\n            return ConnectionQuality.BAD;\n        }\n        if (this.liveKitConnectionState &&\n            [\n                livekit_client__WEBPACK_IMPORTED_MODULE_0__.ConnectionState.Disconnected,\n                livekit_client__WEBPACK_IMPORTED_MODULE_0__.ConnectionState.Reconnecting,\n                livekit_client__WEBPACK_IMPORTED_MODULE_0__.ConnectionState.SignalReconnecting,\n            ].includes(this.liveKitConnectionState)) {\n            return ConnectionQuality.BAD;\n        }\n        return ConnectionQuality.GOOD;\n    };\n    return LiveKitConnectionQualityIndicator;\n}(AbstractConnectionQualityIndicator));\n\nvar t,e,s,n;function r(){}function o(){o.init.call(this);}function i(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function a(t,e,s){if(e)t.call(s);else for(var n=t.length,r=m(t,n),o=0;o<n;++o)r[o].call(s);}function c(t,e,s,n){if(e)t.call(s,n);else for(var r=t.length,o=m(t,r),i=0;i<r;++i)o[i].call(s,n);}function d(t,e,s,n,r){if(e)t.call(s,n,r);else for(var o=t.length,i=m(t,o),a=0;a<o;++a)i[a].call(s,n,r);}function u(t,e,s,n,r,o){if(e)t.call(s,n,r,o);else for(var i=t.length,a=m(t,i),c=0;c<i;++c)a[c].call(s,n,r,o);}function h(t,e,s,n){if(e)t.apply(s,n);else for(var r=t.length,o=m(t,r),i=0;i<r;++i)o[i].apply(s,n);}function l(t,e,s,n){var o,a,c,d;if(\"function\"!=typeof s)throw new TypeError('\"listener\" argument must be a function');if((a=t._events)?(a.newListener&&(t.emit(\"newListener\",e,s.listener?s.listener:s),a=t._events),c=a[e]):(a=t._events=new r,t._eventsCount=0),c){if(\"function\"==typeof c?c=a[e]=n?[s,c]:[c,s]:n?c.unshift(s):c.push(s),!c.warned&&(o=i(t))&&o>0&&c.length>o){c.warned=!0;var u=new Error(\"Possible EventEmitter memory leak detected. \"+c.length+\" \"+e+\" listeners added. Use emitter.setMaxListeners() to increase limit\");u.name=\"MaxListenersExceededWarning\",u.emitter=t,u.type=e,u.count=c.length,d=u,\"function\"==typeof console.warn?console.warn(d):console.log(d);}}else c=a[e]=s,++t._eventsCount;return t}function p(t,e,s){var n=!1;function r(){t.removeListener(e,r),n||(n=!0,s.apply(t,arguments));}return r.listener=s,r}function f(t){var e=this._events;if(e){var s=e[t];if(\"function\"==typeof s)return 1;if(s)return s.length}return 0}function m(t,e){for(var s=new Array(e);e--;)s[e]=t[e];return s}r.prototype=Object.create(null),o.EventEmitter=o,o.usingDomains=!1,o.prototype.domain=void 0,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.init=function(){this.domain=null,o.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new r,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0;},o.prototype.setMaxListeners=function(t){if(\"number\"!=typeof t||t<0||isNaN(t))throw new TypeError('\"n\" argument must be a positive number');return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return i(this)},o.prototype.emit=function(t){var e,s,n,r,o,i,l,p=\"error\"===t;if(i=this._events)p=p&&null==i.error;else if(!p)return !1;if(l=this.domain,p){if(e=arguments[1],!l){if(e instanceof Error)throw e;var f=new Error('Uncaught, unspecified \"error\" event. ('+e+\")\");throw f.context=e,f}return e||(e=new Error('Uncaught, unspecified \"error\" event')),e.domainEmitter=this,e.domain=l,e.domainThrown=!1,l.emit(\"error\",e),!1}if(!(s=i[t]))return !1;var m=\"function\"==typeof s;switch(n=arguments.length){case 1:a(s,m,this);break;case 2:c(s,m,this,arguments[1]);break;case 3:d(s,m,this,arguments[1],arguments[2]);break;case 4:u(s,m,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(n-1),o=1;o<n;o++)r[o-1]=arguments[o];h(s,m,this,r);}return !0},o.prototype.addListener=function(t,e){return l(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return l(this,t,e,!0)},o.prototype.once=function(t,e){if(\"function\"!=typeof e)throw new TypeError('\"listener\" argument must be a function');return this.on(t,p(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){if(\"function\"!=typeof e)throw new TypeError('\"listener\" argument must be a function');return this.prependListener(t,p(this,t,e)),this},o.prototype.removeListener=function(t,e){var s,n,o,i,a;if(\"function\"!=typeof e)throw new TypeError('\"listener\" argument must be a function');if(!(n=this._events))return this;if(!(s=n[t]))return this;if(s===e||s.listener&&s.listener===e)0==--this._eventsCount?this._events=new r:(delete n[t],n.removeListener&&this.emit(\"removeListener\",t,s.listener||e));else if(\"function\"!=typeof s){for(o=-1,i=s.length;i-- >0;)if(s[i]===e||s[i].listener&&s[i].listener===e){a=s[i].listener,o=i;break}if(o<0)return this;if(1===s.length){if(s[0]=void 0,0==--this._eventsCount)return this._events=new r,this;delete n[t];}else !function(t,e){for(var s=e,n=s+1,r=t.length;n<r;s+=1,n+=1)t[s]=t[n];t.pop();}(s,o);n.removeListener&&this.emit(\"removeListener\",t,a||e);}return this},o.prototype.off=function(t,e){return this.removeListener(t,e)},o.prototype.removeAllListeners=function(t){var e,s;if(!(s=this._events))return this;if(!s.removeListener)return 0===arguments.length?(this._events=new r,this._eventsCount=0):s[t]&&(0==--this._eventsCount?this._events=new r:delete s[t]),this;if(0===arguments.length){for(var n,o=Object.keys(s),i=0;i<o.length;++i)\"removeListener\"!==(n=o[i])&&this.removeAllListeners(n);return this.removeAllListeners(\"removeListener\"),this._events=new r,this._eventsCount=0,this}if(\"function\"==typeof(e=s[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1]);}while(e[0]);return this},o.prototype.listeners=function(t){var e,s=this._events;return s&&(e=s[t])?\"function\"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),s=0;s<e.length;++s)e[s]=t[s].listener||t[s];return e}(e):[]},o.listenerCount=function(t,e){return \"function\"==typeof t.listenerCount?t.listenerCount(e):f.call(t,e)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};class g extends o{}!function(t){t.Issue=\"issue\",t.NetworkScoresUpdated=\"network-scores-updated\",t.StatsParsingFinished=\"stats-parsing-finished\";}(t||(t={})),function(t){t.Network=\"network\",t.CPU=\"cpu\",t.Server=\"server\",t.Stream=\"stream\";}(e||(e={})),function(t){t.OutboundNetworkQuality=\"outbound-network-quality\",t.InboundNetworkQuality=\"inbound-network-quality\",t.OutboundNetworkMediaLatency=\"outbound-network-media-latency\",t.InboundNetworkMediaLatency=\"inbound-network-media-latency\",t.NetworkMediaSyncFailure=\"network-media-sync-failure\",t.OutboundNetworkThroughput=\"outbound-network-throughput\",t.InboundNetworkThroughput=\"inbound-network-throughput\",t.EncoderCPUThrottling=\"encoder-cpu-throttling\",t.DecoderCPUThrottling=\"decoder-cpu-throttling\",t.ServerIssue=\"server-issue\",t.UnknownVideoDecoderIssue=\"unknown-video-decoder\",t.LowInboundMOS=\"low-inbound-mean-opinion-score\",t.LowOutboundMOS=\"low-outbound-mean-opinion-score\",t.FrozenVideoTrack=\"frozen-video-track\",t.MissingVideoStreamData=\"missing-video-stream-data\",t.MissingAudioStreamData=\"missing-audio-stream-data\";}(s||(s={})),function(t){t[t.BAD=2.1]=\"BAD\",t[t.POOR=2.6]=\"POOR\",t[t.FAIR=3.1]=\"FAIR\",t[t.GOOD=3.8]=\"GOOD\",t[t.EXCELLENT=4.3]=\"EXCELLENT\";}(n||(n={}));class S extends o{static STATS_REPORT_READY_EVENT=\"stats-report-ready\";static STATS_REPORTS_PARSED=\"stats-reports-parsed\";isStopped=!1;reportTimer;getStatsInterval;compositeStatsParser;constructor(t){super(),this.compositeStatsParser=t.compositeStatsParser,this.getStatsInterval=t.getStatsInterval??1e4;}get isRunning(){return !!this.reportTimer&&!this.isStopped}startReporting(){if(this.reportTimer)return;const t=()=>setTimeout((()=>{this.isStopped?this.reportTimer=void 0:this.parseReports().finally((()=>{this.reportTimer=t();}));}),this.getStatsInterval);this.isStopped=!1,this.reportTimer=t();}stopReporting(){this.isStopped=!0,this.reportTimer&&(clearTimeout(this.reportTimer),this.reportTimer=void 0);}async parseReports(){const t=Date.now(),e=await this.compositeStatsParser.parse(),s=Date.now()-t;this.emit(S.STATS_REPORTS_PARSED,{timeTaken:s,reportItems:e}),e.forEach((t=>{this.emit(S.STATS_REPORT_READY_EVENT,t);}));}}const v=(()=>{const t=new Map;return e=>{const{taskId:s,delayMs:n,maxJitterMs:r,callback:o}=e,i=Math.ceil(Math.random()*(r||0)),a=t.get(s);a&&clearTimeout(a);const c=setTimeout((()=>{o(),t.delete(s);}),n+i);t.set(s,c);}})();class k{#t={};calculate(t){const{connection:{id:e}}=t,{mos:s,stats:n}=this.calculateOutboundScore(t)||{},{mos:r,stats:o}=this.calculateInboundScore(t)||{};return this.#t[e]=t,v({taskId:e,delayMs:35e3,callback:()=>delete this.#t[e]}),{outbound:s,inbound:r,connectionId:e,statsSamples:{inboundStatsSample:o,outboundStatsSample:n}}}calculateOutboundScore(t){const e=[...t.remote?.audio.inbound||[],...t.remote?.video.inbound||[]];if(!e.length)return;const s=this.#t[t.connection.id];if(!s)return;const n=[...s.remote?.audio.inbound||[],...s.remote?.video.inbound||[]],{packetsSent:r}=t.connection,o=s.connection.packetsSent,i=e.reduce(((t,e)=>{const s=n.find((t=>t.ssrc===e.ssrc));return {sumJitter:t.sumJitter+e.jitter,packetsLost:t.packetsLost+e.packetsLost,lastPacketsLost:t.lastPacketsLost+(s?.packetsLost||0)}}),{sumJitter:0,packetsLost:0,lastPacketsLost:0}),a=1e3*t.connection.currentRoundTripTime||0,{sumJitter:c}=i,d=c/e.length,u=r-o,h=i.packetsLost-i.lastPacketsLost,l=u&&h?Math.round(100*h/(u+h)):0;return {mos:this.calculateMOS({avgJitter:d,rtt:a,packetsLoss:l}),stats:{avgJitter:d,rtt:a,packetsLoss:l}}}calculateInboundScore(t){const e=[...t.audio?.inbound,...t.video?.inbound];if(!e.length)return;const s=this.#t[t.connection.id];if(!s)return;const n=[...s.video?.inbound,...s.audio?.inbound],{packetsReceived:r}=t.connection,o=s.connection.packetsReceived,i=e.reduce(((t,e)=>{const s=n.find((t=>t.ssrc===e.ssrc));return {sumJitter:t.sumJitter+e.jitter,packetsLost:t.packetsLost+e.packetsLost,lastPacketsLost:t.lastPacketsLost+(s?.packetsLost||0)}}),{sumJitter:0,packetsLost:0,lastPacketsLost:0}),a=1e3*t.connection.currentRoundTripTime||0,{sumJitter:c}=i,d=c/e.length,u=r-o,h=i.packetsLost-i.lastPacketsLost,l=u&&h?Math.round(100*h/(u+h)):0;return {mos:this.calculateMOS({avgJitter:d,rtt:a,packetsLoss:l}),stats:{avgJitter:d,rtt:a,packetsLoss:l}}}calculateMOS({avgJitter:t,rtt:e,packetsLoss:s}){const n=e+2*t+10;let r=n<160?93.2-n/40:93.2-n/120-10;return r-=2.5*s,1+.035*r+7e-6*r*(r-60)*(100-r)}}class y{#e=new Map;#s;#n;constructor(t={}){this.#s=t.statsCleanupTtlMs??35e3,this.#n=t.maxParsedStatsStorageSize??5;}detect(t,e){const s={...t,networkScores:{...e,statsSamples:e?.statsSamples||{}}},n=this.performDetection(s);return this.setLastProcessedStats(t.connection.id,s),this.performPrevStatsCleanup({connectionId:t.connection.id}),n}performPrevStatsCleanup(t){const{connectionId:e,cleanupCallback:s}=t;this.#e.has(e)&&v({taskId:e,delayMs:this.#s,callback:()=>{this.deleteLastProcessedStats(e),\"function\"==typeof s&&s();}});}setLastProcessedStats(t,e){if(!t||e.connection.id!==t)return;const s=this.#e.get(t)??[];s.push(e),s.length>this.#n&&s.shift(),this.#e.set(t,s);}getLastProcessedStats(t){const e=this.#e.get(t);return e?.[e.length-1]}getAllLastProcessedStats(t){return this.#e.get(t)??[]}deleteLastProcessedStats(t){this.#e.delete(t);}}class w extends y{#r;constructor(t={}){super(t),this.#r=t.availableOutgoingBitrateThreshold??1e5;}performDetection(t){const n=[],{availableOutgoingBitrate:r}=t.connection;if(void 0===r)return n;const o=t.audio.outbound.reduce(((t,e)=>t+e.targetBitrate),0),i=t.video.outbound.reduce(((t,e)=>t+e.bitrate),0);if(!o&&!i)return n;const a={availableOutgoingBitrate:r,videoStreamsTotalBitrate:i,audioStreamsTotalTargetBitrate:o};return o>r||i>0&&r<this.#r?(n.push({statsSample:a,type:e.Network,reason:s.OutboundNetworkThroughput}),n):n}}class b extends y{#o;#i;#a;#c;constructor(t={}){super(),this.#o=t.highPacketLossThresholdPct??5,this.#i=t.highJitterThreshold??200,this.#a=t.highJitterBufferDelayThresholdMs??500,this.#c=t.highRttThresholdMs??250;}performDetection(t){return this.processData(t)}processData(t){const n=[],r=[...t.audio?.inbound,...t.video?.inbound];if(!r.length)return n;const o=this.getLastProcessedStats(t.connection.id);if(!o)return n;const i=[...o.video?.inbound,...o.audio?.inbound],{packetsReceived:a}=t.connection,c=o.connection.packetsReceived,d=r.reduce(((t,e)=>{const s=i.find((t=>t.ssrc===e.ssrc)),n=s?.jitterBufferDelay||0,r=s?.jitterBufferEmittedCount||0,o=e.jitterBufferDelay-n,a=e.jitterBufferEmittedCount-r,c=o&&a?1e3*o/a:0;return {sumJitter:t.sumJitter+e.jitter,sumJitterBufferDelayMs:t.sumJitterBufferDelayMs+c,packetsLost:t.packetsLost+e.packetsLost,lastPacketsLost:t.lastPacketsLost+(s?.packetsLost||0)}}),{sumJitter:0,sumJitterBufferDelayMs:0,packetsLost:0,lastPacketsLost:0}),u=1e3*t.connection.currentRoundTripTime||0,{sumJitter:h,sumJitterBufferDelayMs:l}=d,p=h/r.length,f=l/r.length,m=a-c,g=d.packetsLost-d.lastPacketsLost,S=m&&g?Math.round(100*g/(m+g)):0,v=S>this.#o,k=p>=this.#i,y=u>=this.#c,w=f>this.#a,b=y&&!k&&!v,P=v&&k,T=k&&w,L={rtt:u,packetLossPct:S,avgJitter:p,avgJitterBufferDelay:f};return (k||v)&&n.push({statsSample:L,type:e.Network,reason:s.InboundNetworkQuality,iceCandidate:t.connection.local.id}),b&&n.push({statsSample:L,type:e.Server,reason:s.ServerIssue,iceCandidate:t.connection.remote.id}),P&&n.push({statsSample:L,type:e.Network,reason:s.InboundNetworkMediaLatency,iceCandidate:t.connection.local.id}),T&&n.push({statsSample:L,type:e.Network,reason:s.NetworkMediaSyncFailure,iceCandidate:t.connection.local.id}),n}}class P extends y{#d;constructor(t={}){super(),this.#d=t.correctedSamplesThresholdPct??5;}performDetection(t){return this.processData(t)}processData(t){const n=t.audio.inbound,r=[],o=this.getLastProcessedStats(t.connection.id)?.audio.inbound;return o?(n.forEach((t=>{const n=o.find((e=>e.ssrc===t.ssrc));if(!n)return;const i=t.track.insertedSamplesForDeceleration+t.track.removedSamplesForAcceleration,a=n.track.insertedSamplesForDeceleration+n.track.removedSamplesForAcceleration;if(i===a)return;const c=t.track.totalSamplesReceived-n.track.totalSamplesReceived,d=i-a,u=Math.round(100*d/c),h={correctedSamplesPct:u};u>this.#d&&r.push({statsSample:h,type:e.Network,reason:s.NetworkMediaSyncFailure,ssrc:t.ssrc});})),r):r}}class T extends y{#o;#i;constructor(t={}){super(),this.#o=t.highPacketLossThresholdPct??5,this.#i=t.highJitterThreshold??200;}performDetection(t){return this.processData(t)}processData(t){const n=[],r=[...t.remote?.audio.inbound||[],...t.remote?.video.inbound||[]];if(!r.length)return n;const o=this.getLastProcessedStats(t.connection.id);if(!o)return n;const i=[...o.remote?.audio.inbound||[],...o.remote?.video.inbound||[]],{packetsSent:a}=t.connection,c=o.connection.packetsSent,d=r.reduce(((t,e)=>{const s=i.find((t=>t.ssrc===e.ssrc));return {sumJitter:t.sumJitter+e.jitter,packetsLost:t.packetsLost+e.packetsLost,lastPacketsLost:t.lastPacketsLost+(s?.packetsLost||0)}}),{sumJitter:0,packetsLost:0,lastPacketsLost:0}),u=1e3*t.connection.currentRoundTripTime||0,{sumJitter:h}=d,l=h/r.length,p=a-c,f=d.packetsLost-d.lastPacketsLost,m=p&&f?Math.round(100*f/(p+f)):0,g=m>this.#o,S=l>=this.#i,v=!g&&S||S||g,k={rtt:u,avgJitter:l,packetLossPct:m};return g&&S&&n.push({statsSample:k,type:e.Network,reason:s.OutboundNetworkMediaLatency,iceCandidate:t.connection.local.id}),v&&n.push({statsSample:k,type:e.Network,reason:s.OutboundNetworkQuality,iceCandidate:t.connection.local.id}),n}}class L extends y{performDetection(t){return this.processData(t)}processData(t){const n=t.video.outbound.filter((t=>\"none\"!==t.qualityLimitationReason)),r=[],o=this.getLastProcessedStats(t.connection.id)?.video.outbound;return o?(n.forEach((t=>{const n=o.find((e=>e.ssrc===t.ssrc));if(!n)return;const i={qualityLimitationReason:t.qualityLimitationReason};t.framesSent>n.framesSent||(\"cpu\"===t.qualityLimitationReason&&r.push({statsSample:i,type:e.CPU,reason:s.EncoderCPUThrottling,ssrc:t.ssrc}),\"bandwidth\"===t.qualityLimitationReason&&r.push({statsSample:i,type:e.Network,reason:s.OutboundNetworkThroughput,ssrc:t.ssrc}));})),r):r}}class D extends y{UNKNOWN_DECODER=\"unknown\";#u={};performDetection(t){return this.processData(t)}performPrevStatsCleanup(t){const{connectionId:e,cleanupCallback:s}=t;super.performPrevStatsCleanup({...t,cleanupCallback:()=>{delete this.#u[e],\"function\"==typeof s&&s();}});}processData(t){const n=[],{id:r}=t.connection,o=this.getLastProcessedStats(r)?.video.inbound;return t.video.inbound.forEach((t=>{const{decoderImplementation:i,ssrc:a}=t,c=o?.find((t=>t.ssrc===a));if(c)if(i===this.UNKNOWN_DECODER){if(!this.hadLastDecoderWithIssue(r,a)){this.setLastDecoderWithIssue(r,a,this.UNKNOWN_DECODER);const o={mimeType:t.mimeType,decoderImplementation:i};n.push({ssrc:a,statsSample:o,type:e.Stream,reason:s.UnknownVideoDecoderIssue,trackIdentifier:t.track.trackIdentifier});}}else this.setLastDecoderWithIssue(r,a,void 0);})),n}setLastDecoderWithIssue(t,e,s){const n=this.#u[t]??{};void 0===s?delete n[e]:n[e]=s,this.#u[t]=n;}hadLastDecoderWithIssue(t,e){const s=this.#u[t];return (s&&s[e])===this.UNKNOWN_DECODER}}const C=t=>t.reduce(((t,e)=>t+e),0)/t.length,R=(t,e,s=30)=>{const n=[];for(let s=1;s<e.length-1;s+=1){const r=e[s]?.video?.inbound.find((e=>e.ssrc===t));if(!r)continue;const o=e[s-1]?.video?.inbound?.find((e=>e.ssrc===t));if(!r||!o)continue;const i=r.timestamp-o.timestamp,a=r.framesDecoded-o.framesDecoded;if(a>0){const t=i/a;n.push(t);}}if(n.length<=1)return !1;return (t=>{const e=((t,e)=>e.reduce(((e,s)=>e+(s-t)**2),0)/e.length)(C(t),t);return Math.sqrt(e)})(n)>s},M=(t,e)=>{for(let s=1;s<e.length;s+=1){const n=e[s].video.inbound.find((e=>e.ssrc===t));if(!n)continue;const r=e[s-1].video.inbound.find((e=>e.ssrc===t)),o=n.frameWidth!==r?.frameWidth,i=n.frameHeight!==r?.frameHeight;if(o||i)return !0}return !1};class I extends y{#h;#l;#p;constructor(t={}){super(),this.#h=t.avgFreezeDurationThresholdMs??1e3,this.#l=t.frozenDurationThresholdPct??30,this.#p=t.minMosQuality??n.BAD;}performDetection(t){const e=t.networkScores.inbound;return void 0!==e&&e<=this.#p?[]:this.processData(t)}processData(t){const n=[],r=this.getAllLastProcessedStats(t.connection.id);if(0===r.length)return [];const o=t.video.inbound.map((e=>{const s=r[r.length-1].video.inbound.find((t=>t.ssrc===e.ssrc));if(!s)return;if(M(e.ssrc,[r[r.length-1],t]))return;if(R(e.ssrc,r))return;const n=e.freezeCount-(s.freezeCount??0),o=1e3*(e.totalFreezesDuration-(s.totalFreezesDuration??0)),i=n>0?o/n:0,a=o/(e.timestamp-s.timestamp)*100;return a>this.#l||i>this.#h?{ssrc:e.ssrc,avgFreezeDurationMs:i,frozenDurationPct:a}:void 0})).filter((t=>void 0!==t));return o.length>0&&(n.push({type:e.Stream,reason:s.FrozenVideoTrack,statsSample:{ssrcs:o.map((t=>t.ssrc))}}),this.deleteLastProcessedStats(t.connection.id)),n}}class E extends y{#f;#m;#p;constructor(t={}){super(t),this.#f=t.volatilityThreshold??8,this.#m=t.affectedStreamsPercentThreshold??30,this.#p=t.minMosQuality??n.BAD;}performDetection(t){return [...this.getAllLastProcessedStats(t.connection.id),t].find((t=>void 0!==t.networkScores.inbound&&t.networkScores.inbound<=this.#p))?[]:this.processData(t)}processData(t){const n=[],r=[...this.getAllLastProcessedStats(t.connection.id),t],o=t.video.inbound.map((t=>{if(r.length<5)return;if(M(t.ssrc,r))return;const e=[];for(let s=0;s<r.length-1;s+=1){const n=r[s].video.inbound.find((e=>e.ssrc===t.ssrc));void 0!==n?.framesPerSecond&&e.push(n.framesPerSecond);}if(e.length<5)return;if(R(t.ssrc,r))return;const s=(t=>{if(0===t.length)throw new Error(\"Cannot calculate volatility for empty array\");const e=C(t);return t.reduce(((t,s)=>t+Math.abs(s-e)),0)/t.length*100/e})(e);return s>this.#f?{ssrc:t.ssrc,allFps:e,volatility:s}:void 0})).filter((t=>Boolean(t)));if(0===o.length)return n;const i=o.length/(t.video.inbound.length/100);return i>this.#m&&(n.push({type:e.CPU,reason:s.DecoderCPUThrottling,statsSample:{affectedStreamsPercent:i,throtthedStreams:o}}),this.deleteLastProcessedStats(t.connection.id)),n}}const N=t=>\"closed\"===t.iceConnectionState||\"closed\"===t.connectionState,_=(t,e,s)=>8*((t,e,s)=>{if(!e)return 0;const n=t[s],r=e[s];if(null==n||null==r)return 0;const o=Math.floor(t.timestamp)-Math.floor(e.timestamp);return 0===o?0:(Number(n)-Number(r))/o*1e3})(t,e,s);class A{connections=[];statsParser;constructor(t){this.statsParser=t.statsParser;}listConnections(){return [...this.connections]}addPeerConnection(t){this.connections.push({id:t.id??String(Date.now()+Math.random().toString(32)),pc:t.pc});}removePeerConnection(t){const e=this.connections.findIndex((({pc:e})=>e===t.pc));e>=0&&this.removeConnectionsByIndexes([e]);}async parse(){const t=[],e=this.connections.map((async(e,s)=>{if(!N(e.pc))return this.statsParser.parse(e);t.unshift(s);}));t.length&&this.removeConnectionsByIndexes(t);return (await Promise.all(e)).filter((t=>void 0!==t))}removeConnectionsByIndexes(t){t.forEach((t=>{this.connections.splice(t,1);}));}}class O{prevStats=new Map;allowedReportTypes=new Set([\"candidate-pair\",\"inbound-rtp\",\"outbound-rtp\",\"remote-outbound-rtp\",\"remote-inbound-rtp\",\"track\",\"transport\"]);ignoreSSRCList;logger;constructor(t){this.ignoreSSRCList=t.ignoreSSRCList??[],this.logger=t.logger;}get previouslyParsedStatsConnectionsIds(){return [...this.prevStats.keys()]}async parse(t){if(!N(t.pc))return this.getConnectionStats(t);this.logger.debug(\"Skip stats parsing. Connection is closed.\",{connection:t});}async getConnectionStats(t){const{pc:e,id:s}=t;try{const n=Date.now(),r=e.getReceivers().filter((t=>t.track?.enabled)),o=e.getSenders().filter((t=>t.track?.enabled)),i=await Promise.all(r.map((t=>t.getStats()))),a=await Promise.all(o.map((t=>t.getStats())));return {id:s,stats:this.mapReportsStats([...i,...a],t),timeTaken:Date.now()-n}}catch(t){return void this.logger.error(\"Failed to get stats for PC\",{id:s,pc:e,error:t})}}mapReportsStats(t,e){const s={audio:{inbound:[],outbound:[]},video:{inbound:[],outbound:[]},connection:{},remote:{video:{inbound:[],outbound:[]},audio:{inbound:[],outbound:[]}}};t.forEach((t=>{t.forEach((e=>{this.allowedReportTypes.has(e.type)&&this.updateMappedStatsWithReportItemData(e,s,t);}));}));const{id:n}=e,r=this.prevStats.get(n);return r&&this.propagateStatsWithRateValues(s,r.stats),this.prevStats.set(n,{stats:s,ts:Date.now()}),v({taskId:n,delayMs:35e3,callback:()=>this.prevStats.delete(n)}),s}updateMappedStatsWithReportItemData(t,e,s){const n=t.type;if(\"candidate-pair\"===n&&\"succeeded\"===t.state&&t.nominated)return void(e.connection=this.prepareConnectionStats(t,s));const r=this.getMediaType(t);if(!r)return;const o=t.ssrc;if(!o||!this.ignoreSSRCList.includes(o))if(\"outbound-rtp\"!==n)if(\"inbound-rtp\"!==n)\"remote-outbound-rtp\"!==n?\"remote-inbound-rtp\"===n&&(this.mapConnectionStatsIfNecessary(e,t,s),e.remote[r].inbound.push({...t})):e.remote[r].outbound.push({...t});else {const n=s.get(t.trackId)||s.get(t.mediaSourceId)||{};this.mapConnectionStatsIfNecessary(e,t,s);const o={...t,track:{...n}};e[r].inbound.push(o);}else {const n=s.get(t.trackId)||s.get(t.mediaSourceId)||{},o={...t,track:{...n}};e[r].outbound.push(o);}}getMediaType(t){const e=t.mediaType||t.kind;if(![\"audio\",\"video\"].includes(e)){const{id:e}=t;if(!e)return;return String(e).includes(\"Video\")?\"video\":String(e).includes(\"Audio\")?\"audio\":void 0}return e}propagateStatsWithRateValues(t,e){t.audio.inbound.forEach((t=>{const s=e.audio.inbound.find((({id:e})=>e===t.id));t.bitrate=_(t,s,\"bytesReceived\"),t.packetRate=_(t,s,\"packetsReceived\");})),t.audio.outbound.forEach((t=>{const s=e.audio.outbound.find((({id:e})=>e===t.id));t.bitrate=_(t,s,\"bytesSent\"),t.packetRate=_(t,s,\"packetsSent\");})),t.video.inbound.forEach((t=>{const s=e.video.inbound.find((({id:e})=>e===t.id));t.bitrate=_(t,s,\"bytesReceived\"),t.packetRate=_(t,s,\"packetsReceived\");})),t.video.outbound.forEach((t=>{const s=e.video.outbound.find((({id:e})=>e===t.id));t.bitrate=_(t,s,\"bytesSent\"),t.packetRate=_(t,s,\"packetsSent\");}));}mapConnectionStatsIfNecessary(t,e,s){if(t.connection.id||!e.transportId)return;const n=s.get(e.transportId);if(n&&n.selectedCandidatePairId){const e=s.get(n.selectedCandidatePairId);t.connection=this.prepareConnectionStats(e,s);}}prepareConnectionStats(t,e){if(!t||!e)return {};const s={...t};if(s.remoteCandidateId){const t=e.get(s.remoteCandidateId);s.remote={...t};}if(s.localCandidateId){const t=e.get(s.localCandidateId);s.local={...t};}return s}}class J extends y{#g=new Map;#S;#v;constructor(t={}){super(),this.#S=t.timeoutMs??15e3,this.#v=t.steps??3;}performDetection(t){return this.processData(t)}processData(t){const n=[],r=[...this.getAllLastProcessedStats(t.connection.id),t];if(r.length<this.#v)return n;const o=r.slice(-this.#v),i=o.map((t=>t.video.inbound)),a=o.map((t=>t.audio.inbound));n.push(...this.detectMissingData(a,e.Stream,s.MissingAudioStreamData)),n.push(...this.detectMissingData(i,e.Stream,s.MissingVideoStreamData));return new Set(this.#g.keys()).forEach((t=>{const e=this.#g.get(t);e&&Date.now()-e>this.#S&&this.removeMarkedIssue(t);})),n}detectMissingData(t,e,s){const n=[],r=t.pop(),o=J.mapStatsByTrackId(t);return r.forEach((t=>{const r=t.track.trackIdentifier,i=o.get(r);if(!Array.isArray(i)||0===i.length)return;if(t.track.detached||t.track.ended)return;if(!J.isAllBytesReceivedDidntChange(t.bytesReceived,i))return void this.removeMarkedIssue(r);if(!this.markIssue(r))return;const a={bytesReceived:t.bytesReceived};n.push({type:e,reason:s,statsSample:a,trackIdentifier:r});})),n}static mapStatsByTrackId(t){const e=new Map;return t.forEach((t=>{t.forEach((t=>{const s=e.get(t.track.trackIdentifier)||[];s.push(t),e.set(t.track.trackIdentifier,s);}));})),e}static isAllBytesReceivedDidntChange(t,e){for(let s=0;s<e.length;s+=1){if(e[s].bytesReceived!==t)return !1}return !0}markIssue(t){const e=Date.now(),s=this.#g.get(t);return (!s||e-s>this.#S)&&(this.#g.set(t,e),!0)}removeMarkedIssue(t){this.#g.delete(t);}}class x{eventEmitter;#k=!1;detectors=[];networkScoresCalculator;statsReporter;compositeStatsParser;logger;autoAddPeerConnections;constructor(e){this.logger=e.logger??{debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},this.eventEmitter=e.issueEmitter??new g,e.onIssues&&this.eventEmitter.on(t.Issue,e.onIssues),e.onNetworkScoresUpdated&&this.eventEmitter.on(t.NetworkScoresUpdated,e.onNetworkScoresUpdated),this.detectors=e.detectors??[new L,new b,new T,new P,new w,new D,new I,new E,new J],this.networkScoresCalculator=e.networkScoresCalculator??new k,this.compositeStatsParser=e.compositeStatsParser??new A({statsParser:new O({ignoreSSRCList:e.ignoreSSRCList,logger:this.logger})}),this.statsReporter=e.statsReporter??new S({compositeStatsParser:this.compositeStatsParser,getStatsInterval:e.getStatsInterval??5e3}),window.wid=this,this.autoAddPeerConnections=e.autoAddPeerConnections??!0,this.autoAddPeerConnections&&this.wrapRTCPeerConnection(),this.statsReporter.on(S.STATS_REPORT_READY_EVENT,(t=>{const e=this.calculateNetworkScores(t.stats);this.detectIssues({data:t.stats},e);})),this.statsReporter.on(S.STATS_REPORTS_PARSED,(s=>{const n={timeTaken:s.timeTaken,ts:Date.now()};e.onStats&&e.onStats(s.reportItems),this.eventEmitter.emit(t.StatsParsingFinished,n);}));}watchNewPeerConnections(){if(!this.autoAddPeerConnections)throw new Error(\"Auto add peer connections was disabled in the constructor.\");this.#k?this.logger.warn(\"WebRTCIssueDetector is already started. Skip processing\"):(this.logger.info(\"Start watching peer connections\"),this.#k=!0,this.statsReporter.startReporting());}stopWatchingNewPeerConnections(){this.#k?(this.logger.info(\"Stop watching peer connections\"),this.#k=!1,this.statsReporter.stopReporting()):this.logger.warn(\"WebRTCIssueDetector is already stopped. Skip processing\");}handleNewPeerConnection(t,e){this.#k||!this.autoAddPeerConnections?(this.#k||!1!==this.autoAddPeerConnections||(this.logger.info(\"Starting stats reporting for new peer connection\"),this.#k=!0,this.statsReporter.startReporting()),this.logger.debug(\"Handling new peer connection\",t),this.compositeStatsParser.addPeerConnection({pc:t,id:e})):this.logger.debug(\"Skip handling new peer connection. Detector is not running\",t);}emitIssues(e){this.eventEmitter.emit(t.Issue,e);}detectIssues({data:t},e){const s=this.detectors.reduce(((s,n)=>[...s,...n.detect(t,e)]),[]);s.length>0&&this.emitIssues(s);}calculateNetworkScores(e){const s=this.networkScoresCalculator.calculate(e);return this.eventEmitter.emit(t.NetworkScoresUpdated,s),s}wrapRTCPeerConnection(){if(!window.RTCPeerConnection)return void this.logger.warn(\"No RTCPeerConnection found in browser window. Skipping\");const t=window.RTCPeerConnection,e=t=>this.handleNewPeerConnection(t);function s(s){const n=new t(s);return e(n),n}s.prototype=t.prototype,window.RTCPeerConnection=s;}}\n\nvar WebRTCConnectionQualityIndicator = /** @class */ (function (_super) {\n    __extends(WebRTCConnectionQualityIndicator, _super);\n    function WebRTCConnectionQualityIndicator() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.issueDetector = null;\n        _this.mosScores = null;\n        return _this;\n    }\n    WebRTCConnectionQualityIndicator.prototype._start = function (peerConnection) {\n        var _this = this;\n        this.issueDetector = new x({\n            autoAddPeerConnections: false,\n            getStatsInterval: 3000,\n            onNetworkScoresUpdated: function (scores) {\n                _this.mosScores = scores;\n                _this.handleStatsChanged();\n            },\n        });\n        this.issueDetector.handleNewPeerConnection(peerConnection);\n    };\n    WebRTCConnectionQualityIndicator.prototype._stop = function () {\n        if (this.issueDetector) {\n            this.issueDetector.stopWatchingNewPeerConnections();\n            this.issueDetector = null;\n        }\n        this.mosScores = null;\n    };\n    WebRTCConnectionQualityIndicator.prototype.calculateConnectionQuality = function () {\n        if (!this.mosScores || (this.mosScores.inbound && this.mosScores.outbound)) {\n            return ConnectionQuality.UNKNOWN;\n        }\n        if ((this.mosScores.inbound && this.mosScores.inbound < 3) ||\n            (this.mosScores.outbound && this.mosScores.outbound < 3)) {\n            return ConnectionQuality.BAD;\n        }\n        return ConnectionQuality.GOOD;\n    };\n    return WebRTCConnectionQualityIndicator;\n}(AbstractConnectionQualityIndicator));\n\nvar VoiceChatState;\n(function (VoiceChatState) {\n    VoiceChatState[\"INACTIVE\"] = \"inactive\";\n    VoiceChatState[\"STARTING\"] = \"starting\";\n    VoiceChatState[\"ACTIVE\"] = \"started\";\n    VoiceChatState[\"STOPPING\"] = \"stopping\";\n})(VoiceChatState || (VoiceChatState = {}));\nvar AbstractVoiceChat = /** @class */ (function () {\n    function AbstractVoiceChat() {\n    }\n    return AbstractVoiceChat;\n}());\nvar AbstractVoiceChatImplementation = /** @class */ (function (_super) {\n    __extends(AbstractVoiceChatImplementation, _super);\n    function AbstractVoiceChatImplementation() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this._isMuted = true;\n        _this.state = VoiceChatState.INACTIVE;\n        return _this;\n    }\n    Object.defineProperty(AbstractVoiceChatImplementation.prototype, \"isMuted\", {\n        get: function () {\n            return this._isMuted;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(AbstractVoiceChatImplementation.prototype, \"isVoiceChatting\", {\n        get: function () {\n            return this.state !== VoiceChatState.INACTIVE;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    AbstractVoiceChatImplementation.prototype.startVoiceChat = function (voiceChatConfig) {\n        return __awaiter(this, void 0, void 0, function () {\n            var e_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(this.state !== VoiceChatState.INACTIVE)) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.stopVoiceChat()];\n                    case 1:\n                        _a.sent();\n                        _a.label = 2;\n                    case 2:\n                        _a.trys.push([2, 4, , 6]);\n                        this.state = VoiceChatState.STARTING;\n                        return [4 /*yield*/, this._startVoiceChat(voiceChatConfig)];\n                    case 3:\n                        _a.sent();\n                        this.state = VoiceChatState.ACTIVE;\n                        return [3 /*break*/, 6];\n                    case 4:\n                        e_1 = _a.sent();\n                        return [4 /*yield*/, this.stopVoiceChat()];\n                    case 5:\n                        _a.sent();\n                        throw e_1;\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    AbstractVoiceChatImplementation.prototype.stopVoiceChat = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.state === VoiceChatState.INACTIVE) {\n                            return [2 /*return*/];\n                        }\n                        this.state = VoiceChatState.STOPPING;\n                        return [4 /*yield*/, this._stopVoiceChat()];\n                    case 1:\n                        _a.sent();\n                        this._isMuted = true;\n                        this.state = VoiceChatState.INACTIVE;\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    AbstractVoiceChatImplementation.prototype._mute = function () {\n        return;\n    };\n    AbstractVoiceChatImplementation.prototype._unmute = function () {\n        return;\n    };\n    AbstractVoiceChatImplementation.prototype.mute = function () {\n        if (!this.isVoiceChatting) {\n            return;\n        }\n        this._mute();\n        this._isMuted = true;\n    };\n    AbstractVoiceChatImplementation.prototype.unmute = function () {\n        if (!this.isVoiceChatting) {\n            return;\n        }\n        this._unmute();\n        this._isMuted = false;\n    };\n    return AbstractVoiceChatImplementation;\n}(AbstractVoiceChat));\n\nfunction sleep(ms) {\n    return new Promise(function (resolve) { return setTimeout(resolve, ms); });\n}\nfunction convertFloat32ToS16PCM(float32Array) {\n    var int16Array = new Int16Array(float32Array.length);\n    for (var i = 0; i < float32Array.length; i++) {\n        var clampedValue = Math.max(-1, Math.min(1, float32Array[i]));\n        int16Array[i] = clampedValue < 0 ? clampedValue * 32768 : clampedValue * 32767;\n    }\n    return int16Array;\n}\n\nvar LivekitVoiceChat = /** @class */ (function (_super) {\n    __extends(LivekitVoiceChat, _super);\n    function LivekitVoiceChat() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.room = null;\n        _this.track = null;\n        return _this;\n    }\n    LivekitVoiceChat.prototype._startVoiceChat = function (voiceChatConfig) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a;\n            var _b;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        this.room = voiceChatConfig.room;\n                        _a = this;\n                        return [4 /*yield*/, (0,livekit_client__WEBPACK_IMPORTED_MODULE_0__.createLocalAudioTrack)({\n                                echoCancellation: true,\n                                noiseSuppression: true,\n                                autoGainControl: true,\n                            })];\n                    case 1:\n                        _a.track = _c.sent();\n                        return [4 /*yield*/, this.room.localParticipant.publishTrack(this.track)];\n                    case 2:\n                        _c.sent();\n                        if (!((_b = voiceChatConfig.config) === null || _b === void 0 ? void 0 : _b.defaultMuted)) {\n                            this.unmute();\n                        }\n                        else {\n                            this.mute();\n                        }\n                        return [4 /*yield*/, sleep(4000)];\n                    case 3:\n                        _c.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    LivekitVoiceChat.prototype._stopVoiceChat = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a;\n            return __generator(this, function (_b) {\n                if ((_a = this.room) === null || _a === void 0 ? void 0 : _a.localParticipant) {\n                    this.room.localParticipant.getTrackPublications().forEach(function (publication) {\n                        if (publication.track && publication.track.kind === livekit_client__WEBPACK_IMPORTED_MODULE_0__.Track.Kind.Audio) {\n                            publication.track.stop();\n                        }\n                    });\n                }\n                if (this.track) {\n                    this.track.stop();\n                    this.track = null;\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    LivekitVoiceChat.prototype._mute = function () {\n        if (this.track && !this.track.isMuted) {\n            this.track.mute();\n        }\n    };\n    LivekitVoiceChat.prototype._unmute = function () {\n        if (this.track && this.track.isMuted) {\n            this.track.unmute();\n        }\n    };\n    return LivekitVoiceChat;\n}(AbstractVoiceChatImplementation));\n\nvar WebSocketVoiceChat = /** @class */ (function (_super) {\n    __extends(WebSocketVoiceChat, _super);\n    function WebSocketVoiceChat() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.audioContext = null;\n        _this.webSocket = null;\n        _this.scriptProcessor = null;\n        _this.mediaStreamAudioSource = null;\n        _this.mediaDevicesStream = null;\n        _this.audioRawFrame = null;\n        return _this;\n    }\n    WebSocketVoiceChat.prototype._startVoiceChat = function (voiceChatConfig) {\n        return __awaiter(this, void 0, void 0, function () {\n            var devicesStream;\n            var _this = this;\n            var _a, _b, _c, _d;\n            return __generator(this, function (_e) {\n                switch (_e.label) {\n                    case 0:\n                        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n                            throw new Error('Cannot start voice chat without media devices');\n                        }\n                        this.webSocket = voiceChatConfig.webSocket;\n                        this.audioRawFrame = voiceChatConfig.audioRawFrame;\n                        this.audioContext = new window.AudioContext({\n                            latencyHint: 'interactive',\n                            sampleRate: 16000,\n                        });\n                        if (!((_a = voiceChatConfig.config) === null || _a === void 0 ? void 0 : _a.defaultMuted)) {\n                            this.unmute();\n                        }\n                        return [4 /*yield*/, navigator.mediaDevices.getUserMedia({\n                                audio: {\n                                    sampleRate: 16000,\n                                    channelCount: 1,\n                                    autoGainControl: true,\n                                    echoCancellation: true,\n                                    noiseSuppression: true,\n                                },\n                            })];\n                    case 1:\n                        devicesStream = _e.sent();\n                        this.mediaDevicesStream = devicesStream;\n                        this.mediaStreamAudioSource =\n                            (_b = this.audioContext) === null || _b === void 0 ? void 0 : _b.createMediaStreamSource(devicesStream);\n                        this.scriptProcessor = (_c = this.audioContext) === null || _c === void 0 ? void 0 : _c.createScriptProcessor(512, 1, 1);\n                        this.mediaStreamAudioSource.connect(this.scriptProcessor);\n                        this.scriptProcessor.connect((_d = this.audioContext) === null || _d === void 0 ? void 0 : _d.destination);\n                        this.scriptProcessor.onaudioprocess = function (event) {\n                            var _a;\n                            if (!_this.webSocket || !_this.audioRawFrame) {\n                                return;\n                            }\n                            var audioData;\n                            if (_this.isMuted) {\n                                audioData = new Float32Array(512);\n                            }\n                            else {\n                                audioData = event.inputBuffer.getChannelData(0);\n                            }\n                            var pcmS16Array = convertFloat32ToS16PCM(audioData);\n                            var pcmByteArray = new Uint8Array(pcmS16Array.buffer);\n                            var frame = _this.audioRawFrame.create({\n                                audio: {\n                                    audio: Array.from(pcmByteArray),\n                                    sampleRate: 16000,\n                                    numChannels: 1,\n                                },\n                            });\n                            var encodedFrame = new Uint8Array(_this.audioRawFrame.encode(frame).finish());\n                            (_a = _this.webSocket) === null || _a === void 0 ? void 0 : _a.send(encodedFrame);\n                        };\n                        // though room has been connected, but the stream may not be ready.\n                        return [4 /*yield*/, sleep(2000)];\n                    case 2:\n                        // though room has been connected, but the stream may not be ready.\n                        _e.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    WebSocketVoiceChat.prototype._stopVoiceChat = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, _b;\n            return __generator(this, function (_c) {\n                if (this.audioContext) {\n                    this.audioContext = null;\n                }\n                if (this.scriptProcessor) {\n                    this.scriptProcessor.disconnect();\n                    this.scriptProcessor = null;\n                }\n                if (this.mediaStreamAudioSource) {\n                    this.mediaStreamAudioSource.disconnect();\n                    this.mediaStreamAudioSource = null;\n                }\n                if (this.mediaDevicesStream) {\n                    (_b = (_a = this.mediaDevicesStream) === null || _a === void 0 ? void 0 : _a.getTracks()) === null || _b === void 0 ? void 0 : _b.forEach(function (track) { return track.stop(); });\n                    this.mediaDevicesStream = null;\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    return WebSocketVoiceChat;\n}(AbstractVoiceChatImplementation));\n\nvar VoiceChatTransport;\n(function (VoiceChatTransport) {\n    VoiceChatTransport[\"LIVEKIT\"] = \"livekit\";\n    VoiceChatTransport[\"WEBSOCKET\"] = \"websocket\";\n})(VoiceChatTransport || (VoiceChatTransport = {}));\nvar VoiceChatFactory = /** @class */ (function (_super) {\n    __extends(VoiceChatFactory, _super);\n    function VoiceChatFactory(_a) {\n        var voiceChatInstance = _a.voiceChatInstance, initialConfig = _a.initialConfig;\n        var _this = _super.call(this) || this;\n        _this.initialConfig = initialConfig;\n        _this.voiceChat = voiceChatInstance;\n        return _this;\n    }\n    Object.defineProperty(VoiceChatFactory.prototype, \"isMuted\", {\n        get: function () {\n            return this.voiceChat.isMuted;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(VoiceChatFactory.prototype, \"isVoiceChatting\", {\n        get: function () {\n            return this.voiceChat.isVoiceChatting;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    VoiceChatFactory.prototype.startVoiceChat = function (_a) {\n        return __awaiter(this, arguments, void 0, function (_b) {\n            var config = _b.config;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0: return [4 /*yield*/, this.voiceChat.startVoiceChat(__assign(__assign({}, this.initialConfig), { config: config }))];\n                    case 1:\n                        _c.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    VoiceChatFactory.prototype.stopVoiceChat = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.voiceChat.stopVoiceChat()];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    VoiceChatFactory.prototype.mute = function () {\n        this.voiceChat.mute();\n    };\n    VoiceChatFactory.prototype.unmute = function () {\n        this.voiceChat.unmute();\n    };\n    VoiceChatFactory.createLiveKitVoiceChat = function (voiceChatConfig) {\n        return new this({\n            voiceChatInstance: new LivekitVoiceChat(),\n            initialConfig: voiceChatConfig,\n        });\n    };\n    VoiceChatFactory.createWebSocketVoiceChat = function (voiceChatConfig) {\n        return new this({\n            voiceChatInstance: new WebSocketVoiceChat(),\n            initialConfig: voiceChatConfig,\n        });\n    };\n    return VoiceChatFactory;\n}(AbstractVoiceChat));\n\nvar AvatarQuality;\n(function (AvatarQuality) {\n    AvatarQuality[\"Low\"] = \"low\";\n    AvatarQuality[\"Medium\"] = \"medium\";\n    AvatarQuality[\"High\"] = \"high\";\n})(AvatarQuality || (AvatarQuality = {}));\nvar VoiceEmotion;\n(function (VoiceEmotion) {\n    VoiceEmotion[\"EXCITED\"] = \"excited\";\n    VoiceEmotion[\"SERIOUS\"] = \"serious\";\n    VoiceEmotion[\"FRIENDLY\"] = \"friendly\";\n    VoiceEmotion[\"SOOTHING\"] = \"soothing\";\n    VoiceEmotion[\"BROADCASTER\"] = \"broadcaster\";\n})(VoiceEmotion || (VoiceEmotion = {}));\nvar ElevenLabsModel;\n(function (ElevenLabsModel) {\n    ElevenLabsModel[\"eleven_flash_v2_5\"] = \"eleven_flash_v2_5\";\n    ElevenLabsModel[\"eleven_multilingual_v2\"] = \"eleven_multilingual_v2\";\n})(ElevenLabsModel || (ElevenLabsModel = {}));\nvar STTProvider;\n(function (STTProvider) {\n    STTProvider[\"DEEPGRAM\"] = \"deepgram\";\n    STTProvider[\"GLADIA\"] = \"gladia\";\n})(STTProvider || (STTProvider = {}));\nvar TaskType;\n(function (TaskType) {\n    TaskType[\"TALK\"] = \"talk\";\n    TaskType[\"REPEAT\"] = \"repeat\";\n})(TaskType || (TaskType = {}));\nvar TaskMode;\n(function (TaskMode) {\n    TaskMode[\"SYNC\"] = \"sync\";\n    TaskMode[\"ASYNC\"] = \"async\";\n})(TaskMode || (TaskMode = {}));\n// event types --------------------------------\nvar StreamingEvents;\n(function (StreamingEvents) {\n    StreamingEvents[\"AVATAR_START_TALKING\"] = \"avatar_start_talking\";\n    StreamingEvents[\"AVATAR_STOP_TALKING\"] = \"avatar_stop_talking\";\n    StreamingEvents[\"AVATAR_TALKING_MESSAGE\"] = \"avatar_talking_message\";\n    StreamingEvents[\"AVATAR_END_MESSAGE\"] = \"avatar_end_message\";\n    StreamingEvents[\"USER_TALKING_MESSAGE\"] = \"user_talking_message\";\n    StreamingEvents[\"USER_END_MESSAGE\"] = \"user_end_message\";\n    StreamingEvents[\"USER_START\"] = \"user_start\";\n    StreamingEvents[\"USER_STOP\"] = \"user_stop\";\n    StreamingEvents[\"USER_SILENCE\"] = \"user_silence\";\n    StreamingEvents[\"STREAM_READY\"] = \"stream_ready\";\n    StreamingEvents[\"STREAM_DISCONNECTED\"] = \"stream_disconnected\";\n    StreamingEvents[\"CONNECTION_QUALITY_CHANGED\"] = \"connection_quality_changed\";\n})(StreamingEvents || (StreamingEvents = {}));\nvar APIError = /** @class */ (function (_super) {\n    __extends(APIError, _super);\n    function APIError(message, status, responseText) {\n        var _this = _super.call(this, message) || this;\n        _this.name = 'APIError';\n        _this.status = status;\n        _this.responseText = responseText;\n        return _this;\n    }\n    return APIError;\n}(Error));\nvar ConnectionQualityIndicatorClass = QualityIndicatorMixer({\n    TrackerClass: LiveKitConnectionQualityIndicator,\n    getParams: function (room) { return room; },\n}, {\n    TrackerClass: WebRTCConnectionQualityIndicator,\n    getParams: function (room) { var _a; return ((_a = room.engine.pcManager) === null || _a === void 0 ? void 0 : _a.subscriber)._pc; },\n});\nvar StreamingAvatar = /** @class */ (function () {\n    function StreamingAvatar(_a) {\n        var token = _a.token, _b = _a.basePath, basePath = _b === void 0 ? 'https://api.heygen.com' : _b;\n        var _this = this;\n        this.room = null;\n        this.mediaStream = null;\n        this.eventTarget = new EventTarget();\n        this.webSocket = null;\n        this.sessionId = null;\n        this.voiceChat = null;\n        this.isLiveKitTransport = false;\n        this.enablePushToTalk = false;\n        this.token = token;\n        this.basePath = basePath;\n        this.connectionQualityIndicator = new ConnectionQualityIndicatorClass(function (quality) {\n            return _this.emit(StreamingEvents.CONNECTION_QUALITY_CHANGED, quality);\n        });\n    }\n    Object.defineProperty(StreamingAvatar.prototype, \"connectionQuality\", {\n        get: function () {\n            return this.connectionQualityIndicator.connectionQuality;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(StreamingAvatar.prototype, \"isInputAudioMuted\", {\n        get: function () {\n            var _a, _b;\n            return (_b = (_a = this.voiceChat) === null || _a === void 0 ? void 0 : _a.isMuted) !== null && _b !== void 0 ? _b : true;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    StreamingAvatar.prototype.muteInputAudio = function () {\n        var _a;\n        (_a = this.voiceChat) === null || _a === void 0 ? void 0 : _a.mute();\n    };\n    StreamingAvatar.prototype.unmuteInputAudio = function () {\n        var _a;\n        (_a = this.voiceChat) === null || _a === void 0 ? void 0 : _a.unmute();\n    };\n    StreamingAvatar.prototype.createStartAvatar = function (requestData) {\n        return __awaiter(this, void 0, void 0, function () {\n            var sessionInfo;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.newSession(requestData)];\n                    case 1:\n                        sessionInfo = _a.sent();\n                        return [2 /*return*/, this.startAvatar(requestData, sessionInfo)];\n                }\n            });\n        });\n    };\n    StreamingAvatar.prototype.startAvatar = function (requestData, sessionInfo) {\n        return __awaiter(this, void 0, void 0, function () {\n            var room, mediaStream;\n            var _this = this;\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        this.sessionId = sessionInfo.session_id;\n                        this.isLiveKitTransport =\n                            requestData.voiceChatTransport === VoiceChatTransport.LIVEKIT;\n                        room = new livekit_client__WEBPACK_IMPORTED_MODULE_0__.Room({\n                            adaptiveStream: true,\n                            dynacast: true,\n                            videoCaptureDefaults: {\n                                resolution: livekit_client__WEBPACK_IMPORTED_MODULE_0__.VideoPresets.h720.resolution,\n                            },\n                        });\n                        this.room = room;\n                        this.mediaStream = null;\n                        this.enablePushToTalk = (_a = requestData.enablePushToTalk) !== null && _a !== void 0 ? _a : false;\n                        room.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.DataReceived, function (roomMessage) {\n                            var eventMsg = null;\n                            try {\n                                var messageString = new TextDecoder().decode(roomMessage);\n                                eventMsg = JSON.parse(messageString);\n                            }\n                            catch (e) {\n                                console.error(e);\n                            }\n                            if (!eventMsg) {\n                                return;\n                            }\n                            _this.emit(eventMsg.type, eventMsg);\n                        });\n                        mediaStream = new MediaStream();\n                        room.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackSubscribed, function (track) {\n                            if (track.kind === 'video' || track.kind === 'audio') {\n                                mediaStream.addTrack(track.mediaStreamTrack);\n                                var hasVideoTrack = mediaStream.getVideoTracks().length > 0;\n                                var hasAudioTrack = mediaStream.getAudioTracks().length > 0;\n                                if (hasVideoTrack && hasAudioTrack && !_this.mediaStream) {\n                                    _this.mediaStream = mediaStream;\n                                    _this.emit(StreamingEvents.STREAM_READY, _this.mediaStream);\n                                }\n                            }\n                        });\n                        room.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackUnsubscribed, function (track) {\n                            var mediaTrack = track.mediaStreamTrack;\n                            if (mediaTrack) {\n                                mediaStream.removeTrack(mediaTrack);\n                            }\n                        });\n                        room.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.Disconnected, function (reason) {\n                            _this.emit(StreamingEvents.STREAM_DISCONNECTED, reason);\n                        });\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, room.prepareConnection(sessionInfo.url, sessionInfo.access_token)];\n                    case 2:\n                        _b.sent();\n                        return [3 /*break*/, 4];\n                    case 3:\n                        _b.sent();\n                        return [3 /*break*/, 4];\n                    case 4: return [4 /*yield*/, this.startSession()];\n                    case 5:\n                        _b.sent();\n                        return [4 /*yield*/, room.connect(sessionInfo.url, sessionInfo.access_token)];\n                    case 6:\n                        _b.sent();\n                        return [4 /*yield*/, this.connectWebSocket({ useSilencePrompt: !!requestData.useSilencePrompt })];\n                    case 7:\n                        _b.sent();\n                        this.initVoiceChat(requestData.voiceChatTransport || VoiceChatTransport.WEBSOCKET);\n                        this.connectionQualityIndicator.start(room);\n                        return [2 /*return*/, sessionInfo];\n                }\n            });\n        });\n    };\n    StreamingAvatar.prototype.startVoiceChat = function () {\n        return __awaiter(this, arguments, void 0, function (_a) {\n            var _b;\n            var _c = _a === void 0 ? {} : _a, isInputAudioMuted = _c.isInputAudioMuted;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0: return [4 /*yield*/, ((_b = this.voiceChat) === null || _b === void 0 ? void 0 : _b.startVoiceChat({ config: { defaultMuted: isInputAudioMuted } }))];\n                    case 1:\n                        _d.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    StreamingAvatar.prototype.closeVoiceChat = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, ((_a = this.voiceChat) === null || _a === void 0 ? void 0 : _a.stopVoiceChat())];\n                    case 1:\n                        _b.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    StreamingAvatar.prototype.newSession = function (requestData) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, _b, _c, _d, _e;\n            return __generator(this, function (_f) {\n                return [2 /*return*/, this.request('/v1/streaming.new', {\n                        avatar_name: requestData.avatarName,\n                        quality: requestData.quality,\n                        knowledge_base_id: requestData.knowledgeId,\n                        knowledge_base: requestData.knowledgeBase,\n                        voice: {\n                            voice_id: (_a = requestData.voice) === null || _a === void 0 ? void 0 : _a.voiceId,\n                            rate: (_b = requestData.voice) === null || _b === void 0 ? void 0 : _b.rate,\n                            emotion: (_c = requestData.voice) === null || _c === void 0 ? void 0 : _c.emotion,\n                            elevenlabs_settings: __assign(__assign({}, (_d = requestData === null || requestData === void 0 ? void 0 : requestData.voice) === null || _d === void 0 ? void 0 : _d.elevenlabsSettings), { model_id: (_e = requestData.voice) === null || _e === void 0 ? void 0 : _e.model }),\n                        },\n                        language: requestData.language,\n                        version: 'v2',\n                        video_encoding: 'H264',\n                        source: 'sdk',\n                        disable_idle_timeout: requestData.disableIdleTimeout,\n                        stt_settings: requestData.sttSettings,\n                        ia_is_livekit_transport: requestData.voiceChatTransport === VoiceChatTransport.LIVEKIT,\n                        silence_response: requestData.useSilencePrompt,\n                        activity_idle_timeout: requestData.activityIdleTimeout,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.startSession = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.request('/v1/streaming.start', {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.speak = function (requestData) {\n        return __awaiter(this, void 0, void 0, function () {\n            var taskType, taskMode;\n            return __generator(this, function (_a) {\n                taskType = requestData.taskType || requestData.task_type || TaskType.TALK;\n                taskMode = requestData.taskMode || TaskMode.ASYNC;\n                // livekit/websocket text transport supports only async talk task\n                if (taskType === TaskType.TALK && taskMode === TaskMode.ASYNC) {\n                    if (this.isLiveKitTransport && this.room) {\n                        this.sendLivekitMessage(requestData.text);\n                        return [2 /*return*/];\n                    }\n                    if (!this.isLiveKitTransport && this.webSocket && this.audioRawFrame) {\n                        this.sendWebsocketMessage(requestData.text);\n                        return [2 /*return*/];\n                    }\n                }\n                return [2 /*return*/, this.request('/v1/streaming.task', {\n                        text: requestData.text,\n                        session_id: this.sessionId,\n                        task_mode: requestData.taskMode,\n                        task_type: requestData.taskType,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.startListening = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.request('/v1/streaming.start_listening', {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.stopListening = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.request('/v1/streaming.stop_listening', {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.interrupt = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.request('/v1/streaming.interrupt', {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.stopAvatar = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                // clear some resources\n                this.closeVoiceChat();\n                this.connectionQualityIndicator.stop();\n                this.voiceChat = null;\n                if (this.webSocket) {\n                    this.webSocket.close();\n                    this.webSocket = null;\n                }\n                return [2 /*return*/, this.request('/v1/streaming.stop', {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.pushToTalkStart = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (!this.isLiveKitTransport) {\n                    throw new Error('push to talk is only supported for LiveKit transport');\n                }\n                if (!this.enablePushToTalk) {\n                    throw new Error('push to talk is not enabled');\n                }\n                if (!this.voiceChat.isVoiceChatting) {\n                    throw new Error('voice chat is not active');\n                }\n                if (!this.room) {\n                    throw new Error('room is not initialized');\n                }\n                return [2 /*return*/, this.sendLivekitMessage(\"push_to_talk:start\")];\n            });\n        });\n    };\n    StreamingAvatar.prototype.pushToTalkStop = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (!this.isLiveKitTransport) {\n                    throw new Error('push to talk is only supported for LiveKit transport');\n                }\n                if (!this.enablePushToTalk) {\n                    throw new Error('push to talk is not enabled');\n                }\n                if (!this.voiceChat.isVoiceChatting) {\n                    console.log('voice chat is not active');\n                }\n                if (!this.room) {\n                    throw new Error('room is not initialized');\n                }\n                return [2 /*return*/, this.sendLivekitMessage(\"push_to_talk:stop\")];\n            });\n        });\n    };\n    StreamingAvatar.prototype.keepAlive = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.request('/v1/streaming.keep_alive', {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.on = function (eventType, listener) {\n        this.eventTarget.addEventListener(eventType, listener);\n        return this;\n    };\n    StreamingAvatar.prototype.off = function (eventType, listener) {\n        this.eventTarget.removeEventListener(eventType, listener);\n        return this;\n    };\n    StreamingAvatar.prototype.sendLivekitMessage = function (message) {\n        return __awaiter(this, void 0, void 0, function () {\n            var data;\n            return __generator(this, function (_a) {\n                if (!this.room) {\n                    return [2 /*return*/];\n                }\n                data = new TextEncoder().encode(JSON.stringify(message));\n                this.room.localParticipant.publishData(data, { reliable: true });\n                return [2 /*return*/];\n            });\n        });\n    };\n    StreamingAvatar.prototype.sendWebsocketMessage = function (message) {\n        return __awaiter(this, void 0, void 0, function () {\n            var frame, encodedFrame;\n            var _a, _b;\n            return __generator(this, function (_c) {\n                if (!this.webSocket || !this.audioRawFrame) {\n                    return [2 /*return*/];\n                }\n                frame = (_a = this.audioRawFrame) === null || _a === void 0 ? void 0 : _a.create({\n                    text: {\n                        text: message,\n                    },\n                });\n                encodedFrame = new Uint8Array((_b = this.audioRawFrame) === null || _b === void 0 ? void 0 : _b.encode(frame).finish());\n                this.webSocket.send(encodedFrame);\n                return [2 /*return*/];\n            });\n        });\n    };\n    StreamingAvatar.prototype.initVoiceChat = function (transport) {\n        if (transport === VoiceChatTransport.WEBSOCKET) {\n            this.loadAudioRawFrame();\n            if (!this.audioRawFrame || !this.webSocket) {\n                return;\n            }\n            this.voiceChat = VoiceChatFactory.createWebSocketVoiceChat({\n                webSocket: this.webSocket,\n                audioRawFrame: this.audioRawFrame,\n            });\n        }\n        else {\n            if (!this.room) {\n                return;\n            }\n            this.voiceChat = VoiceChatFactory.createLiveKitVoiceChat({\n                room: this.room,\n            });\n        }\n    };\n    StreamingAvatar.prototype.request = function (path, params, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var response, errorText, jsonData, error_2;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 5, , 6]);\n                        return [4 /*yield*/, fetch(this.getRequestUrl(path), {\n                                method: 'POST',\n                                headers: {\n                                    Authorization: \"Bearer \".concat(this.token),\n                                    'Content-Type': 'application/json',\n                                },\n                                body: JSON.stringify(params),\n                            })];\n                    case 1:\n                        response = _a.sent();\n                        if (!!response.ok) return [3 /*break*/, 3];\n                        return [4 /*yield*/, response.text()];\n                    case 2:\n                        errorText = _a.sent();\n                        throw new APIError(\"API request failed with status \".concat(response.status), response.status, errorText);\n                    case 3: return [4 /*yield*/, response.json()];\n                    case 4:\n                        jsonData = _a.sent();\n                        return [2 /*return*/, jsonData.data];\n                    case 5:\n                        error_2 = _a.sent();\n                        throw error_2;\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    StreamingAvatar.prototype.emit = function (eventType, detail) {\n        var event = new CustomEvent(eventType, { detail: detail });\n        this.eventTarget.dispatchEvent(event);\n    };\n    StreamingAvatar.prototype.getRequestUrl = function (endpoint) {\n        return \"\".concat(this.basePath).concat(endpoint);\n    };\n    StreamingAvatar.prototype.connectWebSocket = function (requestData) {\n        return __awaiter(this, void 0, void 0, function () {\n            var websocketUrl;\n            var _this = this;\n            return __generator(this, function (_a) {\n                websocketUrl = \"wss://\".concat(new URL(this.basePath).hostname, \"/v1/ws/streaming.chat?session_id=\").concat(this.sessionId, \"&session_token=\").concat(this.token).concat(this.isLiveKitTransport ? '&arch_version=v2' : '', \"&silence_response=\").concat(requestData.useSilencePrompt, \"&push_to_talk=\").concat(this.enablePushToTalk);\n                this.webSocket = new WebSocket(websocketUrl);\n                this.webSocket.addEventListener('message', function (event) {\n                    var eventData = null;\n                    try {\n                        eventData = JSON.parse(event.data);\n                    }\n                    catch (e) {\n                        console.error(e);\n                        return;\n                    }\n                    if (eventData) {\n                        _this.emit(eventData.event_type, eventData);\n                    }\n                });\n                this.webSocket.addEventListener('close', function (event) {\n                    _this.webSocket = null;\n                });\n                return [2 /*return*/, new Promise(function (resolve, reject) {\n                        var _a, _b;\n                        (_a = _this.webSocket) === null || _a === void 0 ? void 0 : _a.addEventListener('error', function (event) {\n                            _this.webSocket = null;\n                            reject(event);\n                        });\n                        (_b = _this.webSocket) === null || _b === void 0 ? void 0 : _b.addEventListener('open', function () {\n                            resolve(true);\n                        });\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.loadAudioRawFrame = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var root;\n            return __generator(this, function (_a) {\n                if (!this.audioRawFrame) {\n                    root = protobufjs__WEBPACK_IMPORTED_MODULE_1__.Root.fromJSON(jsonDescriptor);\n                    this.audioRawFrame = root === null || root === void 0 ? void 0 : root.lookupType('pipecat.Frame');\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    return StreamingAvatar;\n}());\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BoZXlnZW4rc3RyZWFtaW5nLWF2YXRhckAyLjEuMC9ub2RlX21vZHVsZXMvQGhleWdlbi9zdHJlYW1pbmctYXZhdGFyL2xpYi9pbmRleC5lc20uanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQTBLO0FBQ3hJOztBQUVsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLGdCQUFnQixzQ0FBc0Msa0JBQWtCO0FBQ25GLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELE9BQU87QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsY0FBYyw2QkFBNkIsMEJBQTBCLGNBQWMscUJBQXFCO0FBQ3hHLDZJQUE2SSxjQUFjO0FBQzNKLHVCQUF1QixzQkFBc0I7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDLG1DQUFtQyxTQUFTO0FBQzVDLG1DQUFtQyxXQUFXLFVBQVU7QUFDeEQsMENBQTBDLGNBQWM7QUFDeEQ7QUFDQSw4R0FBOEcsT0FBTztBQUNySCxpRkFBaUYsaUJBQWlCO0FBQ2xHLHlEQUF5RCxnQkFBZ0IsUUFBUTtBQUNqRiwrQ0FBK0MsZ0JBQWdCLGdCQUFnQjtBQUMvRTtBQUNBLGtDQUFrQztBQUNsQztBQUNBO0FBQ0EsVUFBVSxZQUFZLGFBQWEsU0FBUyxVQUFVO0FBQ3RELG9DQUFvQyxTQUFTO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLDhDQUE4QztBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FB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ZXlnZW4rc3RyZWFtaW5nLWF2YXRhckAyLjEuMFxcbm9kZV9tb2R1bGVzXFxAaGV5Z2VuXFxzdHJlYW1pbmctYXZhdGFyXFxsaWJcXGluZGV4LmVzbS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb25uZWN0aW9uUXVhbGl0eSBhcyBDb25uZWN0aW9uUXVhbGl0eSQxLCBQYXJ0aWNpcGFudEV2ZW50LCBSb29tRXZlbnQsIENvbm5lY3Rpb25TdGF0ZSwgY3JlYXRlTG9jYWxBdWRpb1RyYWNrLCBUcmFjaywgUm9vbSwgVmlkZW9QcmVzZXRzIH0gZnJvbSAnbGl2ZWtpdC1jbGllbnQnO1xuaW1wb3J0IHByb3RvYnVmIGZyb20gJ3Byb3RvYnVmanMnO1xuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbkNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLlxyXG5cclxuUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55XHJcbnB1cnBvc2Ugd2l0aCBvciB3aXRob3V0IGZlZSBpcyBoZXJlYnkgZ3JhbnRlZC5cclxuXHJcblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEhcclxuUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZXHJcbkFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCxcclxuSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NXHJcbkxPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SXHJcbk9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1JcclxuUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi9cclxuLyogZ2xvYmFsIFJlZmxlY3QsIFByb21pc2UsIFN1cHByZXNzZWRFcnJvciwgU3ltYm9sLCBJdGVyYXRvciAqL1xyXG5cclxudmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7XHJcbiAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxyXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcclxuICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxufVxyXG5cclxudmFyIF9fYXNzaWduID0gZnVuY3Rpb24oKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpIHRbcF0gPSBzW3BdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIF9fYXdhaXRlcih0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIF9fZ2VuZXJhdG9yKHRoaXNBcmcsIGJvZHkpIHtcclxuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGcgPSBPYmplY3QuY3JlYXRlKCh0eXBlb2YgSXRlcmF0b3IgPT09IFwiZnVuY3Rpb25cIiA/IEl0ZXJhdG9yIDogT2JqZWN0KS5wcm90b3R5cGUpO1xyXG4gICAgcmV0dXJuIGcubmV4dCA9IHZlcmIoMCksIGdbXCJ0aHJvd1wiXSA9IHZlcmIoMSksIGdbXCJyZXR1cm5cIl0gPSB2ZXJiKDIpLCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcclxuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XHJcbiAgICAgICAgd2hpbGUgKGcgJiYgKGcgPSAwLCBvcFswXSAmJiAoXyA9IDApKSwgXykgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xyXG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XHJcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxyXG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xyXG4gICAgfVxyXG59XHJcblxyXG50eXBlb2YgU3VwcHJlc3NlZEVycm9yID09PSBcImZ1bmN0aW9uXCIgPyBTdXBwcmVzc2VkRXJyb3IgOiBmdW5jdGlvbiAoZXJyb3IsIHN1cHByZXNzZWQsIG1lc3NhZ2UpIHtcclxuICAgIHZhciBlID0gbmV3IEVycm9yKG1lc3NhZ2UpO1xyXG4gICAgcmV0dXJuIGUubmFtZSA9IFwiU3VwcHJlc3NlZEVycm9yXCIsIGUuZXJyb3IgPSBlcnJvciwgZS5zdXBwcmVzc2VkID0gc3VwcHJlc3NlZCwgZTtcclxufTtcblxudmFyIG9wdGlvbnMgPSB7XG5cdHN5bnRheDogXCJwcm90bzNcIlxufTtcbnZhciBuZXN0ZWQgPSB7XG5cdHBpcGVjYXQ6IHtcblx0XHRuZXN0ZWQ6IHtcblx0XHRcdFRleHRGcmFtZToge1xuXHRcdFx0XHRmaWVsZHM6IHtcblx0XHRcdFx0XHRpZDoge1xuXHRcdFx0XHRcdFx0dHlwZTogXCJ1aW50NjRcIixcblx0XHRcdFx0XHRcdGlkOiAxXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRuYW1lOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcInN0cmluZ1wiLFxuXHRcdFx0XHRcdFx0aWQ6IDJcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHRleHQ6IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwic3RyaW5nXCIsXG5cdFx0XHRcdFx0XHRpZDogM1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHRcdEF1ZGlvUmF3RnJhbWU6IHtcblx0XHRcdFx0ZmllbGRzOiB7XG5cdFx0XHRcdFx0aWQ6IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwidWludDY0XCIsXG5cdFx0XHRcdFx0XHRpZDogMVxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0bmFtZToge1xuXHRcdFx0XHRcdFx0dHlwZTogXCJzdHJpbmdcIixcblx0XHRcdFx0XHRcdGlkOiAyXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRhdWRpbzoge1xuXHRcdFx0XHRcdFx0dHlwZTogXCJieXRlc1wiLFxuXHRcdFx0XHRcdFx0aWQ6IDNcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHNhbXBsZVJhdGU6IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwidWludDMyXCIsXG5cdFx0XHRcdFx0XHRpZDogNFxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0bnVtQ2hhbm5lbHM6IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwidWludDMyXCIsXG5cdFx0XHRcdFx0XHRpZDogNVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHRcdFRyYW5zY3JpcHRpb25GcmFtZToge1xuXHRcdFx0XHRmaWVsZHM6IHtcblx0XHRcdFx0XHRpZDoge1xuXHRcdFx0XHRcdFx0dHlwZTogXCJ1aW50NjRcIixcblx0XHRcdFx0XHRcdGlkOiAxXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRuYW1lOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcInN0cmluZ1wiLFxuXHRcdFx0XHRcdFx0aWQ6IDJcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHRleHQ6IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwic3RyaW5nXCIsXG5cdFx0XHRcdFx0XHRpZDogM1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0dXNlcklkOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcInN0cmluZ1wiLFxuXHRcdFx0XHRcdFx0aWQ6IDRcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHRpbWVzdGFtcDoge1xuXHRcdFx0XHRcdFx0dHlwZTogXCJzdHJpbmdcIixcblx0XHRcdFx0XHRcdGlkOiA1XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdFx0RnJhbWU6IHtcblx0XHRcdFx0b25lb2ZzOiB7XG5cdFx0XHRcdFx0ZnJhbWU6IHtcblx0XHRcdFx0XHRcdG9uZW9mOiBbXG5cdFx0XHRcdFx0XHRcdFwidGV4dFwiLFxuXHRcdFx0XHRcdFx0XHRcImF1ZGlvXCIsXG5cdFx0XHRcdFx0XHRcdFwidHJhbnNjcmlwdGlvblwiXG5cdFx0XHRcdFx0XHRdXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRmaWVsZHM6IHtcblx0XHRcdFx0XHR0ZXh0OiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcIlRleHRGcmFtZVwiLFxuXHRcdFx0XHRcdFx0aWQ6IDFcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGF1ZGlvOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcIkF1ZGlvUmF3RnJhbWVcIixcblx0XHRcdFx0XHRcdGlkOiAyXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHR0cmFuc2NyaXB0aW9uOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcIlRyYW5zY3JpcHRpb25GcmFtZVwiLFxuXHRcdFx0XHRcdFx0aWQ6IDNcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cbn07XG52YXIganNvbkRlc2NyaXB0b3IgPSB7XG5cdG9wdGlvbnM6IG9wdGlvbnMsXG5cdG5lc3RlZDogbmVzdGVkXG59O1xuXG52YXIgQ29ubmVjdGlvblF1YWxpdHk7XG4oZnVuY3Rpb24gKENvbm5lY3Rpb25RdWFsaXR5KSB7XG4gICAgQ29ubmVjdGlvblF1YWxpdHlbXCJVTktOT1dOXCJdID0gXCJVTktOT1dOXCI7XG4gICAgQ29ubmVjdGlvblF1YWxpdHlbXCJHT09EXCJdID0gXCJHT09EXCI7XG4gICAgQ29ubmVjdGlvblF1YWxpdHlbXCJCQURcIl0gPSBcIkJBRFwiO1xufSkoQ29ubmVjdGlvblF1YWxpdHkgfHwgKENvbm5lY3Rpb25RdWFsaXR5ID0ge30pKTtcbnZhciBBYnN0cmFjdENvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEFic3RyYWN0Q29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3Iob25Db25uZWN0aW9uUXVhbGl0eUNoYW5nZWQpIHtcbiAgICAgICAgdGhpcy5fY29ubmVjdGlvblF1YWxpdHkgPSBDb25uZWN0aW9uUXVhbGl0eS5VTktOT1dOO1xuICAgICAgICB0aGlzLm9uQ29ubmVjdGlvblF1YWxpdHlDaGFuZ2VkID0gb25Db25uZWN0aW9uUXVhbGl0eUNoYW5nZWQ7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYnN0cmFjdENvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yLnByb3RvdHlwZSwgXCJjb25uZWN0aW9uUXVhbGl0eVwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb25RdWFsaXR5O1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgQWJzdHJhY3RDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvci5wcm90b3R5cGUuaGFuZGxlU3RhdHNDaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbmV3Q29ubmVjdGlvblF1YWxpdHkgPSB0aGlzLmNhbGN1bGF0ZUNvbm5lY3Rpb25RdWFsaXR5KCk7XG4gICAgICAgIGlmIChuZXdDb25uZWN0aW9uUXVhbGl0eSAhPT0gdGhpcy5fY29ubmVjdGlvblF1YWxpdHkpIHtcbiAgICAgICAgICAgIHRoaXMuX2Nvbm5lY3Rpb25RdWFsaXR5ID0gbmV3Q29ubmVjdGlvblF1YWxpdHk7XG4gICAgICAgICAgICB0aGlzLm9uQ29ubmVjdGlvblF1YWxpdHlDaGFuZ2VkKG5ld0Nvbm5lY3Rpb25RdWFsaXR5KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQWJzdHJhY3RDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvci5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHRoaXMuc3RvcCh0cnVlKTtcbiAgICAgICAgdGhpcy5fc3RhcnQocGFyYW1zKTtcbiAgICB9O1xuICAgIEFic3RyYWN0Q29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3IucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbiAobXV0ZWQpIHtcbiAgICAgICAgaWYgKG11dGVkID09PSB2b2lkIDApIHsgbXV0ZWQgPSBmYWxzZTsgfVxuICAgICAgICB0aGlzLl9zdG9wKCk7XG4gICAgICAgIHRoaXMuX2Nvbm5lY3Rpb25RdWFsaXR5ID0gQ29ubmVjdGlvblF1YWxpdHkuVU5LTk9XTjtcbiAgICAgICAgaWYgKCFtdXRlZCkge1xuICAgICAgICAgICAgdGhpcy5vbkNvbm5lY3Rpb25RdWFsaXR5Q2hhbmdlZChDb25uZWN0aW9uUXVhbGl0eS5VTktOT1dOKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIEFic3RyYWN0Q29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3I7XG59KCkpO1xuZnVuY3Rpb24gUXVhbGl0eUluZGljYXRvck1peGVyKCkge1xuICAgIHZhciBjb25maWdzID0gW107XG4gICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgY29uZmlnc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgIH1cbiAgICB2YXIgQ29tYmluZWRRdWFsaXR5SW5kaWNhdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgICAgICBfX2V4dGVuZHMoQ29tYmluZWRRdWFsaXR5SW5kaWNhdG9yLCBfc3VwZXIpO1xuICAgICAgICBmdW5jdGlvbiBDb21iaW5lZFF1YWxpdHlJbmRpY2F0b3Iob25Db25uZWN0aW9uUXVhbGl0eUNoYW5nZWQpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG9uQ29ubmVjdGlvblF1YWxpdHlDaGFuZ2VkKSB8fCB0aGlzO1xuICAgICAgICAgICAgX3RoaXMuY2hpbGRUcmFja2VycyA9IGNvbmZpZ3MubWFwKGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHZhciBnZXRQYXJhbXMgPSBfYS5nZXRQYXJhbXMsIFRyYWNrZXJDbGFzcyA9IF9hLlRyYWNrZXJDbGFzcztcbiAgICAgICAgICAgICAgICByZXR1cm4gKHtcbiAgICAgICAgICAgICAgICAgICAgdHJhY2tlcjogbmV3IFRyYWNrZXJDbGFzcyhmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5oYW5kbGVTdGF0c0NoYW5nZWQoKTsgfSksXG4gICAgICAgICAgICAgICAgICAgIGdldFBhcmFtczogZ2V0UGFyYW1zLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgICAgIH1cbiAgICAgICAgQ29tYmluZWRRdWFsaXR5SW5kaWNhdG9yLnByb3RvdHlwZS5jYWxjdWxhdGVDb25uZWN0aW9uUXVhbGl0eSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjb25uZWN0aW9uUXVhbGl0aWVzID0gdGhpcy5jaGlsZFRyYWNrZXJzLm1hcChmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICB2YXIgdHJhY2tlciA9IF9hLnRyYWNrZXI7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYWNrZXIuY29ubmVjdGlvblF1YWxpdHk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChjb25uZWN0aW9uUXVhbGl0aWVzLnNvbWUoZnVuY3Rpb24gKHF1YWxpdHkpIHsgcmV0dXJuIHF1YWxpdHkgPT09IENvbm5lY3Rpb25RdWFsaXR5LkJBRDsgfSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29ubmVjdGlvblF1YWxpdHkuQkFEO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvbm5lY3Rpb25RdWFsaXRpZXMuZXZlcnkoZnVuY3Rpb24gKHF1YWxpdHkpIHsgcmV0dXJuIHF1YWxpdHkgPT09IENvbm5lY3Rpb25RdWFsaXR5LlVOS05PV047IH0pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIENvbm5lY3Rpb25RdWFsaXR5LlVOS05PV047XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gQ29ubmVjdGlvblF1YWxpdHkuR09PRDtcbiAgICAgICAgfTtcbiAgICAgICAgQ29tYmluZWRRdWFsaXR5SW5kaWNhdG9yLnByb3RvdHlwZS5fc3RhcnQgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICB0aGlzLmNoaWxkVHJhY2tlcnMuZm9yRWFjaChmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICB2YXIgdHJhY2tlciA9IF9hLnRyYWNrZXIsIGdldFBhcmFtcyA9IF9hLmdldFBhcmFtcztcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJhY2tlci5zdGFydChnZXRQYXJhbXMocGFyYW1zKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgQ29tYmluZWRRdWFsaXR5SW5kaWNhdG9yLnByb3RvdHlwZS5fc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuY2hpbGRUcmFja2Vycy5mb3JFYWNoKGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHZhciB0cmFja2VyID0gX2EudHJhY2tlcjtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJhY2tlci5zdG9wKHRydWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBDb21iaW5lZFF1YWxpdHlJbmRpY2F0b3I7XG4gICAgfShBYnN0cmFjdENvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yKSk7XG4gICAgcmV0dXJuIENvbWJpbmVkUXVhbGl0eUluZGljYXRvcjtcbn1cblxudmFyIExpdmVLaXRDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTGl2ZUtpdENvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIExpdmVLaXRDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvcigpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnJvb20gPSBudWxsO1xuICAgICAgICBfdGhpcy5saXZlS2l0Q29ubmVjdGlvblF1YWxpdHkgPSBDb25uZWN0aW9uUXVhbGl0eSQxLlVua25vd247XG4gICAgICAgIF90aGlzLmxpdmVLaXRDb25uZWN0aW9uU3RhdGUgPSBudWxsO1xuICAgICAgICBfdGhpcy5oYW5kbGVDb25uZWN0aW9uUXVhbGl0eUNoYW5nZWQgPSBmdW5jdGlvbiAocXVhbGl0eSkge1xuICAgICAgICAgICAgX3RoaXMubGl2ZUtpdENvbm5lY3Rpb25RdWFsaXR5ID0gcXVhbGl0eTtcbiAgICAgICAgICAgIF90aGlzLmhhbmRsZVN0YXRzQ2hhbmdlZCgpO1xuICAgICAgICB9O1xuICAgICAgICBfdGhpcy5oYW5kbGVDb25uZWN0aW9uU3RhdGVDaGFuZ2VkID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgICAgICBfdGhpcy5saXZlS2l0Q29ubmVjdGlvblN0YXRlID0gc3RhdGU7XG4gICAgICAgICAgICBfdGhpcy5oYW5kbGVTdGF0c0NoYW5nZWQoKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBMaXZlS2l0Q29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3IucHJvdG90eXBlLl9zdGFydCA9IGZ1bmN0aW9uIChyb29tKSB7XG4gICAgICAgIHRoaXMucm9vbSA9IHJvb207XG4gICAgICAgIHRoaXMucm9vbS5sb2NhbFBhcnRpY2lwYW50Lm9uKFBhcnRpY2lwYW50RXZlbnQuQ29ubmVjdGlvblF1YWxpdHlDaGFuZ2VkLCB0aGlzLmhhbmRsZUNvbm5lY3Rpb25RdWFsaXR5Q2hhbmdlZCk7XG4gICAgICAgIHRoaXMucm9vbS5vbihSb29tRXZlbnQuQ29ubmVjdGlvblN0YXRlQ2hhbmdlZCwgdGhpcy5oYW5kbGVDb25uZWN0aW9uU3RhdGVDaGFuZ2VkKTtcbiAgICB9O1xuICAgIExpdmVLaXRDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvci5wcm90b3R5cGUuX3N0b3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLnJvb20pIHtcbiAgICAgICAgICAgIHRoaXMucm9vbS5sb2NhbFBhcnRpY2lwYW50Lm9mZihSb29tRXZlbnQuQ29ubmVjdGlvblF1YWxpdHlDaGFuZ2VkLCB0aGlzLmhhbmRsZUNvbm5lY3Rpb25RdWFsaXR5Q2hhbmdlZCk7XG4gICAgICAgICAgICB0aGlzLnJvb20ub2ZmKFJvb21FdmVudC5Db25uZWN0aW9uU3RhdGVDaGFuZ2VkLCB0aGlzLmhhbmRsZUNvbm5lY3Rpb25TdGF0ZUNoYW5nZWQpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBMaXZlS2l0Q29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3IucHJvdG90eXBlLmNhbGN1bGF0ZUNvbm5lY3Rpb25RdWFsaXR5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoW0Nvbm5lY3Rpb25RdWFsaXR5JDEuTG9zdCwgQ29ubmVjdGlvblF1YWxpdHkkMS5Qb29yXS5pbmNsdWRlcyh0aGlzLmxpdmVLaXRDb25uZWN0aW9uUXVhbGl0eSkpIHtcbiAgICAgICAgICAgIHJldHVybiBDb25uZWN0aW9uUXVhbGl0eS5CQUQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubGl2ZUtpdENvbm5lY3Rpb25TdGF0ZSAmJlxuICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgIENvbm5lY3Rpb25TdGF0ZS5EaXNjb25uZWN0ZWQsXG4gICAgICAgICAgICAgICAgQ29ubmVjdGlvblN0YXRlLlJlY29ubmVjdGluZyxcbiAgICAgICAgICAgICAgICBDb25uZWN0aW9uU3RhdGUuU2lnbmFsUmVjb25uZWN0aW5nLFxuICAgICAgICAgICAgXS5pbmNsdWRlcyh0aGlzLmxpdmVLaXRDb25uZWN0aW9uU3RhdGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gQ29ubmVjdGlvblF1YWxpdHkuQkFEO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBDb25uZWN0aW9uUXVhbGl0eS5HT09EO1xuICAgIH07XG4gICAgcmV0dXJuIExpdmVLaXRDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvcjtcbn0oQWJzdHJhY3RDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvcikpO1xuXG52YXIgdCxlLHMsbjtmdW5jdGlvbiByKCl7fWZ1bmN0aW9uIG8oKXtvLmluaXQuY2FsbCh0aGlzKTt9ZnVuY3Rpb24gaSh0KXtyZXR1cm4gdm9pZCAwPT09dC5fbWF4TGlzdGVuZXJzP28uZGVmYXVsdE1heExpc3RlbmVyczp0Ll9tYXhMaXN0ZW5lcnN9ZnVuY3Rpb24gYSh0LGUscyl7aWYoZSl0LmNhbGwocyk7ZWxzZSBmb3IodmFyIG49dC5sZW5ndGgscj1tKHQsbiksbz0wO288bjsrK28pcltvXS5jYWxsKHMpO31mdW5jdGlvbiBjKHQsZSxzLG4pe2lmKGUpdC5jYWxsKHMsbik7ZWxzZSBmb3IodmFyIHI9dC5sZW5ndGgsbz1tKHQsciksaT0wO2k8cjsrK2kpb1tpXS5jYWxsKHMsbik7fWZ1bmN0aW9uIGQodCxlLHMsbixyKXtpZihlKXQuY2FsbChzLG4scik7ZWxzZSBmb3IodmFyIG89dC5sZW5ndGgsaT1tKHQsbyksYT0wO2E8bzsrK2EpaVthXS5jYWxsKHMsbixyKTt9ZnVuY3Rpb24gdSh0LGUscyxuLHIsbyl7aWYoZSl0LmNhbGwocyxuLHIsbyk7ZWxzZSBmb3IodmFyIGk9dC5sZW5ndGgsYT1tKHQsaSksYz0wO2M8aTsrK2MpYVtjXS5jYWxsKHMsbixyLG8pO31mdW5jdGlvbiBoKHQsZSxzLG4pe2lmKGUpdC5hcHBseShzLG4pO2Vsc2UgZm9yKHZhciByPXQubGVuZ3RoLG89bSh0LHIpLGk9MDtpPHI7KytpKW9baV0uYXBwbHkocyxuKTt9ZnVuY3Rpb24gbCh0LGUscyxuKXt2YXIgbyxhLGMsZDtpZihcImZ1bmN0aW9uXCIhPXR5cGVvZiBzKXRocm93IG5ldyBUeXBlRXJyb3IoJ1wibGlzdGVuZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgZnVuY3Rpb24nKTtpZigoYT10Ll9ldmVudHMpPyhhLm5ld0xpc3RlbmVyJiYodC5lbWl0KFwibmV3TGlzdGVuZXJcIixlLHMubGlzdGVuZXI/cy5saXN0ZW5lcjpzKSxhPXQuX2V2ZW50cyksYz1hW2VdKTooYT10Ll9ldmVudHM9bmV3IHIsdC5fZXZlbnRzQ291bnQ9MCksYyl7aWYoXCJmdW5jdGlvblwiPT10eXBlb2YgYz9jPWFbZV09bj9bcyxjXTpbYyxzXTpuP2MudW5zaGlmdChzKTpjLnB1c2gocyksIWMud2FybmVkJiYobz1pKHQpKSYmbz4wJiZjLmxlbmd0aD5vKXtjLndhcm5lZD0hMDt2YXIgdT1uZXcgRXJyb3IoXCJQb3NzaWJsZSBFdmVudEVtaXR0ZXIgbWVtb3J5IGxlYWsgZGV0ZWN0ZWQuIFwiK2MubGVuZ3RoK1wiIFwiK2UrXCIgbGlzdGVuZXJzIGFkZGVkLiBVc2UgZW1pdHRlci5zZXRNYXhMaXN0ZW5lcnMoKSB0byBpbmNyZWFzZSBsaW1pdFwiKTt1Lm5hbWU9XCJNYXhMaXN0ZW5lcnNFeGNlZWRlZFdhcm5pbmdcIix1LmVtaXR0ZXI9dCx1LnR5cGU9ZSx1LmNvdW50PWMubGVuZ3RoLGQ9dSxcImZ1bmN0aW9uXCI9PXR5cGVvZiBjb25zb2xlLndhcm4/Y29uc29sZS53YXJuKGQpOmNvbnNvbGUubG9nKGQpO319ZWxzZSBjPWFbZV09cywrK3QuX2V2ZW50c0NvdW50O3JldHVybiB0fWZ1bmN0aW9uIHAodCxlLHMpe3ZhciBuPSExO2Z1bmN0aW9uIHIoKXt0LnJlbW92ZUxpc3RlbmVyKGUsciksbnx8KG49ITAscy5hcHBseSh0LGFyZ3VtZW50cykpO31yZXR1cm4gci5saXN0ZW5lcj1zLHJ9ZnVuY3Rpb24gZih0KXt2YXIgZT10aGlzLl9ldmVudHM7aWYoZSl7dmFyIHM9ZVt0XTtpZihcImZ1bmN0aW9uXCI9PXR5cGVvZiBzKXJldHVybiAxO2lmKHMpcmV0dXJuIHMubGVuZ3RofXJldHVybiAwfWZ1bmN0aW9uIG0odCxlKXtmb3IodmFyIHM9bmV3IEFycmF5KGUpO2UtLTspc1tlXT10W2VdO3JldHVybiBzfXIucHJvdG90eXBlPU9iamVjdC5jcmVhdGUobnVsbCksby5FdmVudEVtaXR0ZXI9byxvLnVzaW5nRG9tYWlucz0hMSxvLnByb3RvdHlwZS5kb21haW49dm9pZCAwLG8ucHJvdG90eXBlLl9ldmVudHM9dm9pZCAwLG8ucHJvdG90eXBlLl9tYXhMaXN0ZW5lcnM9dm9pZCAwLG8uZGVmYXVsdE1heExpc3RlbmVycz0xMCxvLmluaXQ9ZnVuY3Rpb24oKXt0aGlzLmRvbWFpbj1udWxsLG8udXNpbmdEb21haW5zJiZ1bmRlZmluZWQuYWN0aXZlLHRoaXMuX2V2ZW50cyYmdGhpcy5fZXZlbnRzIT09T2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpLl9ldmVudHN8fCh0aGlzLl9ldmVudHM9bmV3IHIsdGhpcy5fZXZlbnRzQ291bnQ9MCksdGhpcy5fbWF4TGlzdGVuZXJzPXRoaXMuX21heExpc3RlbmVyc3x8dm9pZCAwO30sby5wcm90b3R5cGUuc2V0TWF4TGlzdGVuZXJzPWZ1bmN0aW9uKHQpe2lmKFwibnVtYmVyXCIhPXR5cGVvZiB0fHx0PDB8fGlzTmFOKHQpKXRocm93IG5ldyBUeXBlRXJyb3IoJ1wiblwiIGFyZ3VtZW50IG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXInKTtyZXR1cm4gdGhpcy5fbWF4TGlzdGVuZXJzPXQsdGhpc30sby5wcm90b3R5cGUuZ2V0TWF4TGlzdGVuZXJzPWZ1bmN0aW9uKCl7cmV0dXJuIGkodGhpcyl9LG8ucHJvdG90eXBlLmVtaXQ9ZnVuY3Rpb24odCl7dmFyIGUscyxuLHIsbyxpLGwscD1cImVycm9yXCI9PT10O2lmKGk9dGhpcy5fZXZlbnRzKXA9cCYmbnVsbD09aS5lcnJvcjtlbHNlIGlmKCFwKXJldHVybiAhMTtpZihsPXRoaXMuZG9tYWluLHApe2lmKGU9YXJndW1lbnRzWzFdLCFsKXtpZihlIGluc3RhbmNlb2YgRXJyb3IpdGhyb3cgZTt2YXIgZj1uZXcgRXJyb3IoJ1VuY2F1Z2h0LCB1bnNwZWNpZmllZCBcImVycm9yXCIgZXZlbnQuICgnK2UrXCIpXCIpO3Rocm93IGYuY29udGV4dD1lLGZ9cmV0dXJuIGV8fChlPW5ldyBFcnJvcignVW5jYXVnaHQsIHVuc3BlY2lmaWVkIFwiZXJyb3JcIiBldmVudCcpKSxlLmRvbWFpbkVtaXR0ZXI9dGhpcyxlLmRvbWFpbj1sLGUuZG9tYWluVGhyb3duPSExLGwuZW1pdChcImVycm9yXCIsZSksITF9aWYoIShzPWlbdF0pKXJldHVybiAhMTt2YXIgbT1cImZ1bmN0aW9uXCI9PXR5cGVvZiBzO3N3aXRjaChuPWFyZ3VtZW50cy5sZW5ndGgpe2Nhc2UgMTphKHMsbSx0aGlzKTticmVhaztjYXNlIDI6YyhzLG0sdGhpcyxhcmd1bWVudHNbMV0pO2JyZWFrO2Nhc2UgMzpkKHMsbSx0aGlzLGFyZ3VtZW50c1sxXSxhcmd1bWVudHNbMl0pO2JyZWFrO2Nhc2UgNDp1KHMsbSx0aGlzLGFyZ3VtZW50c1sxXSxhcmd1bWVudHNbMl0sYXJndW1lbnRzWzNdKTticmVhaztkZWZhdWx0OmZvcihyPW5ldyBBcnJheShuLTEpLG89MTtvPG47bysrKXJbby0xXT1hcmd1bWVudHNbb107aChzLG0sdGhpcyxyKTt9cmV0dXJuICEwfSxvLnByb3RvdHlwZS5hZGRMaXN0ZW5lcj1mdW5jdGlvbih0LGUpe3JldHVybiBsKHRoaXMsdCxlLCExKX0sby5wcm90b3R5cGUub249by5wcm90b3R5cGUuYWRkTGlzdGVuZXIsby5wcm90b3R5cGUucHJlcGVuZExpc3RlbmVyPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIGwodGhpcyx0LGUsITApfSxvLnByb3RvdHlwZS5vbmNlPWZ1bmN0aW9uKHQsZSl7aWYoXCJmdW5jdGlvblwiIT10eXBlb2YgZSl0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RlbmVyXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7cmV0dXJuIHRoaXMub24odCxwKHRoaXMsdCxlKSksdGhpc30sby5wcm90b3R5cGUucHJlcGVuZE9uY2VMaXN0ZW5lcj1mdW5jdGlvbih0LGUpe2lmKFwiZnVuY3Rpb25cIiE9dHlwZW9mIGUpdGhyb3cgbmV3IFR5cGVFcnJvcignXCJsaXN0ZW5lclwiIGFyZ3VtZW50IG11c3QgYmUgYSBmdW5jdGlvbicpO3JldHVybiB0aGlzLnByZXBlbmRMaXN0ZW5lcih0LHAodGhpcyx0LGUpKSx0aGlzfSxvLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lcj1mdW5jdGlvbih0LGUpe3ZhciBzLG4sbyxpLGE7aWYoXCJmdW5jdGlvblwiIT10eXBlb2YgZSl0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RlbmVyXCIgYXJndW1lbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7aWYoIShuPXRoaXMuX2V2ZW50cykpcmV0dXJuIHRoaXM7aWYoIShzPW5bdF0pKXJldHVybiB0aGlzO2lmKHM9PT1lfHxzLmxpc3RlbmVyJiZzLmxpc3RlbmVyPT09ZSkwPT0tLXRoaXMuX2V2ZW50c0NvdW50P3RoaXMuX2V2ZW50cz1uZXcgcjooZGVsZXRlIG5bdF0sbi5yZW1vdmVMaXN0ZW5lciYmdGhpcy5lbWl0KFwicmVtb3ZlTGlzdGVuZXJcIix0LHMubGlzdGVuZXJ8fGUpKTtlbHNlIGlmKFwiZnVuY3Rpb25cIiE9dHlwZW9mIHMpe2ZvcihvPS0xLGk9cy5sZW5ndGg7aS0tID4wOylpZihzW2ldPT09ZXx8c1tpXS5saXN0ZW5lciYmc1tpXS5saXN0ZW5lcj09PWUpe2E9c1tpXS5saXN0ZW5lcixvPWk7YnJlYWt9aWYobzwwKXJldHVybiB0aGlzO2lmKDE9PT1zLmxlbmd0aCl7aWYoc1swXT12b2lkIDAsMD09LS10aGlzLl9ldmVudHNDb3VudClyZXR1cm4gdGhpcy5fZXZlbnRzPW5ldyByLHRoaXM7ZGVsZXRlIG5bdF07fWVsc2UgIWZ1bmN0aW9uKHQsZSl7Zm9yKHZhciBzPWUsbj1zKzEscj10Lmxlbmd0aDtuPHI7cys9MSxuKz0xKXRbc109dFtuXTt0LnBvcCgpO30ocyxvKTtuLnJlbW92ZUxpc3RlbmVyJiZ0aGlzLmVtaXQoXCJyZW1vdmVMaXN0ZW5lclwiLHQsYXx8ZSk7fXJldHVybiB0aGlzfSxvLnByb3RvdHlwZS5vZmY9ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5yZW1vdmVMaXN0ZW5lcih0LGUpfSxvLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnM9ZnVuY3Rpb24odCl7dmFyIGUscztpZighKHM9dGhpcy5fZXZlbnRzKSlyZXR1cm4gdGhpcztpZighcy5yZW1vdmVMaXN0ZW5lcilyZXR1cm4gMD09PWFyZ3VtZW50cy5sZW5ndGg/KHRoaXMuX2V2ZW50cz1uZXcgcix0aGlzLl9ldmVudHNDb3VudD0wKTpzW3RdJiYoMD09LS10aGlzLl9ldmVudHNDb3VudD90aGlzLl9ldmVudHM9bmV3IHI6ZGVsZXRlIHNbdF0pLHRoaXM7aWYoMD09PWFyZ3VtZW50cy5sZW5ndGgpe2Zvcih2YXIgbixvPU9iamVjdC5rZXlzKHMpLGk9MDtpPG8ubGVuZ3RoOysraSlcInJlbW92ZUxpc3RlbmVyXCIhPT0obj1vW2ldKSYmdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMobik7cmV0dXJuIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKFwicmVtb3ZlTGlzdGVuZXJcIiksdGhpcy5fZXZlbnRzPW5ldyByLHRoaXMuX2V2ZW50c0NvdW50PTAsdGhpc31pZihcImZ1bmN0aW9uXCI9PXR5cGVvZihlPXNbdF0pKXRoaXMucmVtb3ZlTGlzdGVuZXIodCxlKTtlbHNlIGlmKGUpZG97dGhpcy5yZW1vdmVMaXN0ZW5lcih0LGVbZS5sZW5ndGgtMV0pO313aGlsZShlWzBdKTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUubGlzdGVuZXJzPWZ1bmN0aW9uKHQpe3ZhciBlLHM9dGhpcy5fZXZlbnRzO3JldHVybiBzJiYoZT1zW3RdKT9cImZ1bmN0aW9uXCI9PXR5cGVvZiBlP1tlLmxpc3RlbmVyfHxlXTpmdW5jdGlvbih0KXtmb3IodmFyIGU9bmV3IEFycmF5KHQubGVuZ3RoKSxzPTA7czxlLmxlbmd0aDsrK3MpZVtzXT10W3NdLmxpc3RlbmVyfHx0W3NdO3JldHVybiBlfShlKTpbXX0sby5saXN0ZW5lckNvdW50PWZ1bmN0aW9uKHQsZSl7cmV0dXJuIFwiZnVuY3Rpb25cIj09dHlwZW9mIHQubGlzdGVuZXJDb3VudD90Lmxpc3RlbmVyQ291bnQoZSk6Zi5jYWxsKHQsZSl9LG8ucHJvdG90eXBlLmxpc3RlbmVyQ291bnQ9ZixvLnByb3RvdHlwZS5ldmVudE5hbWVzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2V2ZW50c0NvdW50PjA/UmVmbGVjdC5vd25LZXlzKHRoaXMuX2V2ZW50cyk6W119O2NsYXNzIGcgZXh0ZW5kcyBve30hZnVuY3Rpb24odCl7dC5Jc3N1ZT1cImlzc3VlXCIsdC5OZXR3b3JrU2NvcmVzVXBkYXRlZD1cIm5ldHdvcmstc2NvcmVzLXVwZGF0ZWRcIix0LlN0YXRzUGFyc2luZ0ZpbmlzaGVkPVwic3RhdHMtcGFyc2luZy1maW5pc2hlZFwiO30odHx8KHQ9e30pKSxmdW5jdGlvbih0KXt0Lk5ldHdvcms9XCJuZXR3b3JrXCIsdC5DUFU9XCJjcHVcIix0LlNlcnZlcj1cInNlcnZlclwiLHQuU3RyZWFtPVwic3RyZWFtXCI7fShlfHwoZT17fSkpLGZ1bmN0aW9uKHQpe3QuT3V0Ym91bmROZXR3b3JrUXVhbGl0eT1cIm91dGJvdW5kLW5ldHdvcmstcXVhbGl0eVwiLHQuSW5ib3VuZE5ldHdvcmtRdWFsaXR5PVwiaW5ib3VuZC1uZXR3b3JrLXF1YWxpdHlcIix0Lk91dGJvdW5kTmV0d29ya01lZGlhTGF0ZW5jeT1cIm91dGJvdW5kLW5ldHdvcmstbWVkaWEtbGF0ZW5jeVwiLHQuSW5ib3VuZE5ldHdvcmtNZWRpYUxhdGVuY3k9XCJpbmJvdW5kLW5ldHdvcmstbWVkaWEtbGF0ZW5jeVwiLHQuTmV0d29ya01lZGlhU3luY0ZhaWx1cmU9XCJuZXR3b3JrLW1lZGlhLXN5bmMtZmFpbHVyZVwiLHQuT3V0Ym91bmROZXR3b3JrVGhyb3VnaHB1dD1cIm91dGJvdW5kLW5ldHdvcmstdGhyb3VnaHB1dFwiLHQuSW5ib3VuZE5ldHdvcmtUaHJvdWdocHV0PVwiaW5ib3VuZC1uZXR3b3JrLXRocm91Z2hwdXRcIix0LkVuY29kZXJDUFVUaHJvdHRsaW5nPVwiZW5jb2Rlci1jcHUtdGhyb3R0bGluZ1wiLHQuRGVjb2RlckNQVVRocm90dGxpbmc9XCJkZWNvZGVyLWNwdS10aHJvdHRsaW5nXCIsdC5TZXJ2ZXJJc3N1ZT1cInNlcnZlci1pc3N1ZVwiLHQuVW5rbm93blZpZGVvRGVjb2Rlcklzc3VlPVwidW5rbm93bi12aWRlby1kZWNvZGVyXCIsdC5Mb3dJbmJvdW5kTU9TPVwibG93LWluYm91bmQtbWVhbi1vcGluaW9uLXNjb3JlXCIsdC5Mb3dPdXRib3VuZE1PUz1cImxvdy1vdXRib3VuZC1tZWFuLW9waW5pb24tc2NvcmVcIix0LkZyb3plblZpZGVvVHJhY2s9XCJmcm96ZW4tdmlkZW8tdHJhY2tcIix0Lk1pc3NpbmdWaWRlb1N0cmVhbURhdGE9XCJtaXNzaW5nLXZpZGVvLXN0cmVhbS1kYXRhXCIsdC5NaXNzaW5nQXVkaW9TdHJlYW1EYXRhPVwibWlzc2luZy1hdWRpby1zdHJlYW0tZGF0YVwiO30oc3x8KHM9e30pKSxmdW5jdGlvbih0KXt0W3QuQkFEPTIuMV09XCJCQURcIix0W3QuUE9PUj0yLjZdPVwiUE9PUlwiLHRbdC5GQUlSPTMuMV09XCJGQUlSXCIsdFt0LkdPT0Q9My44XT1cIkdPT0RcIix0W3QuRVhDRUxMRU5UPTQuM109XCJFWENFTExFTlRcIjt9KG58fChuPXt9KSk7Y2xhc3MgUyBleHRlbmRzIG97c3RhdGljIFNUQVRTX1JFUE9SVF9SRUFEWV9FVkVOVD1cInN0YXRzLXJlcG9ydC1yZWFkeVwiO3N0YXRpYyBTVEFUU19SRVBPUlRTX1BBUlNFRD1cInN0YXRzLXJlcG9ydHMtcGFyc2VkXCI7aXNTdG9wcGVkPSExO3JlcG9ydFRpbWVyO2dldFN0YXRzSW50ZXJ2YWw7Y29tcG9zaXRlU3RhdHNQYXJzZXI7Y29uc3RydWN0b3IodCl7c3VwZXIoKSx0aGlzLmNvbXBvc2l0ZVN0YXRzUGFyc2VyPXQuY29tcG9zaXRlU3RhdHNQYXJzZXIsdGhpcy5nZXRTdGF0c0ludGVydmFsPXQuZ2V0U3RhdHNJbnRlcnZhbD8/MWU0O31nZXQgaXNSdW5uaW5nKCl7cmV0dXJuICEhdGhpcy5yZXBvcnRUaW1lciYmIXRoaXMuaXNTdG9wcGVkfXN0YXJ0UmVwb3J0aW5nKCl7aWYodGhpcy5yZXBvcnRUaW1lcilyZXR1cm47Y29uc3QgdD0oKT0+c2V0VGltZW91dCgoKCk9Pnt0aGlzLmlzU3RvcHBlZD90aGlzLnJlcG9ydFRpbWVyPXZvaWQgMDp0aGlzLnBhcnNlUmVwb3J0cygpLmZpbmFsbHkoKCgpPT57dGhpcy5yZXBvcnRUaW1lcj10KCk7fSkpO30pLHRoaXMuZ2V0U3RhdHNJbnRlcnZhbCk7dGhpcy5pc1N0b3BwZWQ9ITEsdGhpcy5yZXBvcnRUaW1lcj10KCk7fXN0b3BSZXBvcnRpbmcoKXt0aGlzLmlzU3RvcHBlZD0hMCx0aGlzLnJlcG9ydFRpbWVyJiYoY2xlYXJUaW1lb3V0KHRoaXMucmVwb3J0VGltZXIpLHRoaXMucmVwb3J0VGltZXI9dm9pZCAwKTt9YXN5bmMgcGFyc2VSZXBvcnRzKCl7Y29uc3QgdD1EYXRlLm5vdygpLGU9YXdhaXQgdGhpcy5jb21wb3NpdGVTdGF0c1BhcnNlci5wYXJzZSgpLHM9RGF0ZS5ub3coKS10O3RoaXMuZW1pdChTLlNUQVRTX1JFUE9SVFNfUEFSU0VELHt0aW1lVGFrZW46cyxyZXBvcnRJdGVtczplfSksZS5mb3JFYWNoKCh0PT57dGhpcy5lbWl0KFMuU1RBVFNfUkVQT1JUX1JFQURZX0VWRU5ULHQpO30pKTt9fWNvbnN0IHY9KCgpPT57Y29uc3QgdD1uZXcgTWFwO3JldHVybiBlPT57Y29uc3R7dGFza0lkOnMsZGVsYXlNczpuLG1heEppdHRlck1zOnIsY2FsbGJhY2s6b309ZSxpPU1hdGguY2VpbChNYXRoLnJhbmRvbSgpKihyfHwwKSksYT10LmdldChzKTthJiZjbGVhclRpbWVvdXQoYSk7Y29uc3QgYz1zZXRUaW1lb3V0KCgoKT0+e28oKSx0LmRlbGV0ZShzKTt9KSxuK2kpO3Quc2V0KHMsYyk7fX0pKCk7Y2xhc3Mga3sjdD17fTtjYWxjdWxhdGUodCl7Y29uc3R7Y29ubmVjdGlvbjp7aWQ6ZX19PXQse21vczpzLHN0YXRzOm59PXRoaXMuY2FsY3VsYXRlT3V0Ym91bmRTY29yZSh0KXx8e30se21vczpyLHN0YXRzOm99PXRoaXMuY2FsY3VsYXRlSW5ib3VuZFNjb3JlKHQpfHx7fTtyZXR1cm4gdGhpcy4jdFtlXT10LHYoe3Rhc2tJZDplLGRlbGF5TXM6MzVlMyxjYWxsYmFjazooKT0+ZGVsZXRlIHRoaXMuI3RbZV19KSx7b3V0Ym91bmQ6cyxpbmJvdW5kOnIsY29ubmVjdGlvbklkOmUsc3RhdHNTYW1wbGVzOntpbmJvdW5kU3RhdHNTYW1wbGU6byxvdXRib3VuZFN0YXRzU2FtcGxlOm59fX1jYWxjdWxhdGVPdXRib3VuZFNjb3JlKHQpe2NvbnN0IGU9Wy4uLnQucmVtb3RlPy5hdWRpby5pbmJvdW5kfHxbXSwuLi50LnJlbW90ZT8udmlkZW8uaW5ib3VuZHx8W11dO2lmKCFlLmxlbmd0aClyZXR1cm47Y29uc3Qgcz10aGlzLiN0W3QuY29ubmVjdGlvbi5pZF07aWYoIXMpcmV0dXJuO2NvbnN0IG49Wy4uLnMucmVtb3RlPy5hdWRpby5pbmJvdW5kfHxbXSwuLi5zLnJlbW90ZT8udmlkZW8uaW5ib3VuZHx8W11dLHtwYWNrZXRzU2VudDpyfT10LmNvbm5lY3Rpb24sbz1zLmNvbm5lY3Rpb24ucGFja2V0c1NlbnQsaT1lLnJlZHVjZSgoKHQsZSk9Pntjb25zdCBzPW4uZmluZCgodD0+dC5zc3JjPT09ZS5zc3JjKSk7cmV0dXJuIHtzdW1KaXR0ZXI6dC5zdW1KaXR0ZXIrZS5qaXR0ZXIscGFja2V0c0xvc3Q6dC5wYWNrZXRzTG9zdCtlLnBhY2tldHNMb3N0LGxhc3RQYWNrZXRzTG9zdDp0Lmxhc3RQYWNrZXRzTG9zdCsocz8ucGFja2V0c0xvc3R8fDApfX0pLHtzdW1KaXR0ZXI6MCxwYWNrZXRzTG9zdDowLGxhc3RQYWNrZXRzTG9zdDowfSksYT0xZTMqdC5jb25uZWN0aW9uLmN1cnJlbnRSb3VuZFRyaXBUaW1lfHwwLHtzdW1KaXR0ZXI6Y309aSxkPWMvZS5sZW5ndGgsdT1yLW8saD1pLnBhY2tldHNMb3N0LWkubGFzdFBhY2tldHNMb3N0LGw9dSYmaD9NYXRoLnJvdW5kKDEwMCpoLyh1K2gpKTowO3JldHVybiB7bW9zOnRoaXMuY2FsY3VsYXRlTU9TKHthdmdKaXR0ZXI6ZCxydHQ6YSxwYWNrZXRzTG9zczpsfSksc3RhdHM6e2F2Z0ppdHRlcjpkLHJ0dDphLHBhY2tldHNMb3NzOmx9fX1jYWxjdWxhdGVJbmJvdW5kU2NvcmUodCl7Y29uc3QgZT1bLi4udC5hdWRpbz8uaW5ib3VuZCwuLi50LnZpZGVvPy5pbmJvdW5kXTtpZighZS5sZW5ndGgpcmV0dXJuO2NvbnN0IHM9dGhpcy4jdFt0LmNvbm5lY3Rpb24uaWRdO2lmKCFzKXJldHVybjtjb25zdCBuPVsuLi5zLnZpZGVvPy5pbmJvdW5kLC4uLnMuYXVkaW8/LmluYm91bmRdLHtwYWNrZXRzUmVjZWl2ZWQ6cn09dC5jb25uZWN0aW9uLG89cy5jb25uZWN0aW9uLnBhY2tldHNSZWNlaXZlZCxpPWUucmVkdWNlKCgodCxlKT0+e2NvbnN0IHM9bi5maW5kKCh0PT50LnNzcmM9PT1lLnNzcmMpKTtyZXR1cm4ge3N1bUppdHRlcjp0LnN1bUppdHRlcitlLmppdHRlcixwYWNrZXRzTG9zdDp0LnBhY2tldHNMb3N0K2UucGFja2V0c0xvc3QsbGFzdFBhY2tldHNMb3N0OnQubGFzdFBhY2tldHNMb3N0KyhzPy5wYWNrZXRzTG9zdHx8MCl9fSkse3N1bUppdHRlcjowLHBhY2tldHNMb3N0OjAsbGFzdFBhY2tldHNMb3N0OjB9KSxhPTFlMyp0LmNvbm5lY3Rpb24uY3VycmVudFJvdW5kVHJpcFRpbWV8fDAse3N1bUppdHRlcjpjfT1pLGQ9Yy9lLmxlbmd0aCx1PXItbyxoPWkucGFja2V0c0xvc3QtaS5sYXN0UGFja2V0c0xvc3QsbD11JiZoP01hdGgucm91bmQoMTAwKmgvKHUraCkpOjA7cmV0dXJuIHttb3M6dGhpcy5jYWxjdWxhdGVNT1Moe2F2Z0ppdHRlcjpkLHJ0dDphLHBhY2tldHNMb3NzOmx9KSxzdGF0czp7YXZnSml0dGVyOmQscnR0OmEscGFja2V0c0xvc3M6bH19fWNhbGN1bGF0ZU1PUyh7YXZnSml0dGVyOnQscnR0OmUscGFja2V0c0xvc3M6c30pe2NvbnN0IG49ZSsyKnQrMTA7bGV0IHI9bjwxNjA/OTMuMi1uLzQwOjkzLjItbi8xMjAtMTA7cmV0dXJuIHItPTIuNSpzLDErLjAzNSpyKzdlLTYqciooci02MCkqKDEwMC1yKX19Y2xhc3MgeXsjZT1uZXcgTWFwOyNzOyNuO2NvbnN0cnVjdG9yKHQ9e30pe3RoaXMuI3M9dC5zdGF0c0NsZWFudXBUdGxNcz8/MzVlMyx0aGlzLiNuPXQubWF4UGFyc2VkU3RhdHNTdG9yYWdlU2l6ZT8/NTt9ZGV0ZWN0KHQsZSl7Y29uc3Qgcz17Li4udCxuZXR3b3JrU2NvcmVzOnsuLi5lLHN0YXRzU2FtcGxlczplPy5zdGF0c1NhbXBsZXN8fHt9fX0sbj10aGlzLnBlcmZvcm1EZXRlY3Rpb24ocyk7cmV0dXJuIHRoaXMuc2V0TGFzdFByb2Nlc3NlZFN0YXRzKHQuY29ubmVjdGlvbi5pZCxzKSx0aGlzLnBlcmZvcm1QcmV2U3RhdHNDbGVhbnVwKHtjb25uZWN0aW9uSWQ6dC5jb25uZWN0aW9uLmlkfSksbn1wZXJmb3JtUHJldlN0YXRzQ2xlYW51cCh0KXtjb25zdHtjb25uZWN0aW9uSWQ6ZSxjbGVhbnVwQ2FsbGJhY2s6c309dDt0aGlzLiNlLmhhcyhlKSYmdih7dGFza0lkOmUsZGVsYXlNczp0aGlzLiNzLGNhbGxiYWNrOigpPT57dGhpcy5kZWxldGVMYXN0UHJvY2Vzc2VkU3RhdHMoZSksXCJmdW5jdGlvblwiPT10eXBlb2YgcyYmcygpO319KTt9c2V0TGFzdFByb2Nlc3NlZFN0YXRzKHQsZSl7aWYoIXR8fGUuY29ubmVjdGlvbi5pZCE9PXQpcmV0dXJuO2NvbnN0IHM9dGhpcy4jZS5nZXQodCk/P1tdO3MucHVzaChlKSxzLmxlbmd0aD50aGlzLiNuJiZzLnNoaWZ0KCksdGhpcy4jZS5zZXQodCxzKTt9Z2V0TGFzdFByb2Nlc3NlZFN0YXRzKHQpe2NvbnN0IGU9dGhpcy4jZS5nZXQodCk7cmV0dXJuIGU/LltlLmxlbmd0aC0xXX1nZXRBbGxMYXN0UHJvY2Vzc2VkU3RhdHModCl7cmV0dXJuIHRoaXMuI2UuZ2V0KHQpPz9bXX1kZWxldGVMYXN0UHJvY2Vzc2VkU3RhdHModCl7dGhpcy4jZS5kZWxldGUodCk7fX1jbGFzcyB3IGV4dGVuZHMgeXsjcjtjb25zdHJ1Y3Rvcih0PXt9KXtzdXBlcih0KSx0aGlzLiNyPXQuYXZhaWxhYmxlT3V0Z29pbmdCaXRyYXRlVGhyZXNob2xkPz8xZTU7fXBlcmZvcm1EZXRlY3Rpb24odCl7Y29uc3Qgbj1bXSx7YXZhaWxhYmxlT3V0Z29pbmdCaXRyYXRlOnJ9PXQuY29ubmVjdGlvbjtpZih2b2lkIDA9PT1yKXJldHVybiBuO2NvbnN0IG89dC5hdWRpby5vdXRib3VuZC5yZWR1Y2UoKCh0LGUpPT50K2UudGFyZ2V0Qml0cmF0ZSksMCksaT10LnZpZGVvLm91dGJvdW5kLnJlZHVjZSgoKHQsZSk9PnQrZS5iaXRyYXRlKSwwKTtpZighbyYmIWkpcmV0dXJuIG47Y29uc3QgYT17YXZhaWxhYmxlT3V0Z29pbmdCaXRyYXRlOnIsdmlkZW9TdHJlYW1zVG90YWxCaXRyYXRlOmksYXVkaW9TdHJlYW1zVG90YWxUYXJnZXRCaXRyYXRlOm99O3JldHVybiBvPnJ8fGk+MCYmcjx0aGlzLiNyPyhuLnB1c2goe3N0YXRzU2FtcGxlOmEsdHlwZTplLk5ldHdvcmsscmVhc29uOnMuT3V0Ym91bmROZXR3b3JrVGhyb3VnaHB1dH0pLG4pOm59fWNsYXNzIGIgZXh0ZW5kcyB5eyNvOyNpOyNhOyNjO2NvbnN0cnVjdG9yKHQ9e30pe3N1cGVyKCksdGhpcy4jbz10LmhpZ2hQYWNrZXRMb3NzVGhyZXNob2xkUGN0Pz81LHRoaXMuI2k9dC5oaWdoSml0dGVyVGhyZXNob2xkPz8yMDAsdGhpcy4jYT10LmhpZ2hKaXR0ZXJCdWZmZXJEZWxheVRocmVzaG9sZE1zPz81MDAsdGhpcy4jYz10LmhpZ2hSdHRUaHJlc2hvbGRNcz8/MjUwO31wZXJmb3JtRGV0ZWN0aW9uKHQpe3JldHVybiB0aGlzLnByb2Nlc3NEYXRhKHQpfXByb2Nlc3NEYXRhKHQpe2NvbnN0IG49W10scj1bLi4udC5hdWRpbz8uaW5ib3VuZCwuLi50LnZpZGVvPy5pbmJvdW5kXTtpZighci5sZW5ndGgpcmV0dXJuIG47Y29uc3Qgbz10aGlzLmdldExhc3RQcm9jZXNzZWRTdGF0cyh0LmNvbm5lY3Rpb24uaWQpO2lmKCFvKXJldHVybiBuO2NvbnN0IGk9Wy4uLm8udmlkZW8/LmluYm91bmQsLi4uby5hdWRpbz8uaW5ib3VuZF0se3BhY2tldHNSZWNlaXZlZDphfT10LmNvbm5lY3Rpb24sYz1vLmNvbm5lY3Rpb24ucGFja2V0c1JlY2VpdmVkLGQ9ci5yZWR1Y2UoKCh0LGUpPT57Y29uc3Qgcz1pLmZpbmQoKHQ9PnQuc3NyYz09PWUuc3NyYykpLG49cz8uaml0dGVyQnVmZmVyRGVsYXl8fDAscj1zPy5qaXR0ZXJCdWZmZXJFbWl0dGVkQ291bnR8fDAsbz1lLmppdHRlckJ1ZmZlckRlbGF5LW4sYT1lLmppdHRlckJ1ZmZlckVtaXR0ZWRDb3VudC1yLGM9byYmYT8xZTMqby9hOjA7cmV0dXJuIHtzdW1KaXR0ZXI6dC5zdW1KaXR0ZXIrZS5qaXR0ZXIsc3VtSml0dGVyQnVmZmVyRGVsYXlNczp0LnN1bUppdHRlckJ1ZmZlckRlbGF5TXMrYyxwYWNrZXRzTG9zdDp0LnBhY2tldHNMb3N0K2UucGFja2V0c0xvc3QsbGFzdFBhY2tldHNMb3N0OnQubGFzdFBhY2tldHNMb3N0KyhzPy5wYWNrZXRzTG9zdHx8MCl9fSkse3N1bUppdHRlcjowLHN1bUppdHRlckJ1ZmZlckRlbGF5TXM6MCxwYWNrZXRzTG9zdDowLGxhc3RQYWNrZXRzTG9zdDowfSksdT0xZTMqdC5jb25uZWN0aW9uLmN1cnJlbnRSb3VuZFRyaXBUaW1lfHwwLHtzdW1KaXR0ZXI6aCxzdW1KaXR0ZXJCdWZmZXJEZWxheU1zOmx9PWQscD1oL3IubGVuZ3RoLGY9bC9yLmxlbmd0aCxtPWEtYyxnPWQucGFja2V0c0xvc3QtZC5sYXN0UGFja2V0c0xvc3QsUz1tJiZnP01hdGgucm91bmQoMTAwKmcvKG0rZykpOjAsdj1TPnRoaXMuI28saz1wPj10aGlzLiNpLHk9dT49dGhpcy4jYyx3PWY+dGhpcy4jYSxiPXkmJiFrJiYhdixQPXYmJmssVD1rJiZ3LEw9e3J0dDp1LHBhY2tldExvc3NQY3Q6UyxhdmdKaXR0ZXI6cCxhdmdKaXR0ZXJCdWZmZXJEZWxheTpmfTtyZXR1cm4gKGt8fHYpJiZuLnB1c2goe3N0YXRzU2FtcGxlOkwsdHlwZTplLk5ldHdvcmsscmVhc29uOnMuSW5ib3VuZE5ldHdvcmtRdWFsaXR5LGljZUNhbmRpZGF0ZTp0LmNvbm5lY3Rpb24ubG9jYWwuaWR9KSxiJiZuLnB1c2goe3N0YXRzU2FtcGxlOkwsdHlwZTplLlNlcnZlcixyZWFzb246cy5TZXJ2ZXJJc3N1ZSxpY2VDYW5kaWRhdGU6dC5jb25uZWN0aW9uLnJlbW90ZS5pZH0pLFAmJm4ucHVzaCh7c3RhdHNTYW1wbGU6TCx0eXBlOmUuTmV0d29yayxyZWFzb246cy5JbmJvdW5kTmV0d29ya01lZGlhTGF0ZW5jeSxpY2VDYW5kaWRhdGU6dC5jb25uZWN0aW9uLmxvY2FsLmlkfSksVCYmbi5wdXNoKHtzdGF0c1NhbXBsZTpMLHR5cGU6ZS5OZXR3b3JrLHJlYXNvbjpzLk5ldHdvcmtNZWRpYVN5bmNGYWlsdXJlLGljZUNhbmRpZGF0ZTp0LmNvbm5lY3Rpb24ubG9jYWwuaWR9KSxufX1jbGFzcyBQIGV4dGVuZHMgeXsjZDtjb25zdHJ1Y3Rvcih0PXt9KXtzdXBlcigpLHRoaXMuI2Q9dC5jb3JyZWN0ZWRTYW1wbGVzVGhyZXNob2xkUGN0Pz81O31wZXJmb3JtRGV0ZWN0aW9uKHQpe3JldHVybiB0aGlzLnByb2Nlc3NEYXRhKHQpfXByb2Nlc3NEYXRhKHQpe2NvbnN0IG49dC5hdWRpby5pbmJvdW5kLHI9W10sbz10aGlzLmdldExhc3RQcm9jZXNzZWRTdGF0cyh0LmNvbm5lY3Rpb24uaWQpPy5hdWRpby5pbmJvdW5kO3JldHVybiBvPyhuLmZvckVhY2goKHQ9Pntjb25zdCBuPW8uZmluZCgoZT0+ZS5zc3JjPT09dC5zc3JjKSk7aWYoIW4pcmV0dXJuO2NvbnN0IGk9dC50cmFjay5pbnNlcnRlZFNhbXBsZXNGb3JEZWNlbGVyYXRpb24rdC50cmFjay5yZW1vdmVkU2FtcGxlc0ZvckFjY2VsZXJhdGlvbixhPW4udHJhY2suaW5zZXJ0ZWRTYW1wbGVzRm9yRGVjZWxlcmF0aW9uK24udHJhY2sucmVtb3ZlZFNhbXBsZXNGb3JBY2NlbGVyYXRpb247aWYoaT09PWEpcmV0dXJuO2NvbnN0IGM9dC50cmFjay50b3RhbFNhbXBsZXNSZWNlaXZlZC1uLnRyYWNrLnRvdGFsU2FtcGxlc1JlY2VpdmVkLGQ9aS1hLHU9TWF0aC5yb3VuZCgxMDAqZC9jKSxoPXtjb3JyZWN0ZWRTYW1wbGVzUGN0OnV9O3U+dGhpcy4jZCYmci5wdXNoKHtzdGF0c1NhbXBsZTpoLHR5cGU6ZS5OZXR3b3JrLHJlYXNvbjpzLk5ldHdvcmtNZWRpYVN5bmNGYWlsdXJlLHNzcmM6dC5zc3JjfSk7fSkpLHIpOnJ9fWNsYXNzIFQgZXh0ZW5kcyB5eyNvOyNpO2NvbnN0cnVjdG9yKHQ9e30pe3N1cGVyKCksdGhpcy4jbz10LmhpZ2hQYWNrZXRMb3NzVGhyZXNob2xkUGN0Pz81LHRoaXMuI2k9dC5oaWdoSml0dGVyVGhyZXNob2xkPz8yMDA7fXBlcmZvcm1EZXRlY3Rpb24odCl7cmV0dXJuIHRoaXMucHJvY2Vzc0RhdGEodCl9cHJvY2Vzc0RhdGEodCl7Y29uc3Qgbj1bXSxyPVsuLi50LnJlbW90ZT8uYXVkaW8uaW5ib3VuZHx8W10sLi4udC5yZW1vdGU/LnZpZGVvLmluYm91bmR8fFtdXTtpZighci5sZW5ndGgpcmV0dXJuIG47Y29uc3Qgbz10aGlzLmdldExhc3RQcm9jZXNzZWRTdGF0cyh0LmNvbm5lY3Rpb24uaWQpO2lmKCFvKXJldHVybiBuO2NvbnN0IGk9Wy4uLm8ucmVtb3RlPy5hdWRpby5pbmJvdW5kfHxbXSwuLi5vLnJlbW90ZT8udmlkZW8uaW5ib3VuZHx8W11dLHtwYWNrZXRzU2VudDphfT10LmNvbm5lY3Rpb24sYz1vLmNvbm5lY3Rpb24ucGFja2V0c1NlbnQsZD1yLnJlZHVjZSgoKHQsZSk9Pntjb25zdCBzPWkuZmluZCgodD0+dC5zc3JjPT09ZS5zc3JjKSk7cmV0dXJuIHtzdW1KaXR0ZXI6dC5zdW1KaXR0ZXIrZS5qaXR0ZXIscGFja2V0c0xvc3Q6dC5wYWNrZXRzTG9zdCtlLnBhY2tldHNMb3N0LGxhc3RQYWNrZXRzTG9zdDp0Lmxhc3RQYWNrZXRzTG9zdCsocz8ucGFja2V0c0xvc3R8fDApfX0pLHtzdW1KaXR0ZXI6MCxwYWNrZXRzTG9zdDowLGxhc3RQYWNrZXRzTG9zdDowfSksdT0xZTMqdC5jb25uZWN0aW9uLmN1cnJlbnRSb3VuZFRyaXBUaW1lfHwwLHtzdW1KaXR0ZXI6aH09ZCxsPWgvci5sZW5ndGgscD1hLWMsZj1kLnBhY2tldHNMb3N0LWQubGFzdFBhY2tldHNMb3N0LG09cCYmZj9NYXRoLnJvdW5kKDEwMCpmLyhwK2YpKTowLGc9bT50aGlzLiNvLFM9bD49dGhpcy4jaSx2PSFnJiZTfHxTfHxnLGs9e3J0dDp1LGF2Z0ppdHRlcjpsLHBhY2tldExvc3NQY3Q6bX07cmV0dXJuIGcmJlMmJm4ucHVzaCh7c3RhdHNTYW1wbGU6ayx0eXBlOmUuTmV0d29yayxyZWFzb246cy5PdXRib3VuZE5ldHdvcmtNZWRpYUxhdGVuY3ksaWNlQ2FuZGlkYXRlOnQuY29ubmVjdGlvbi5sb2NhbC5pZH0pLHYmJm4ucHVzaCh7c3RhdHNTYW1wbGU6ayx0eXBlOmUuTmV0d29yayxyZWFzb246cy5PdXRib3VuZE5ldHdvcmtRdWFsaXR5LGljZUNhbmRpZGF0ZTp0LmNvbm5lY3Rpb24ubG9jYWwuaWR9KSxufX1jbGFzcyBMIGV4dGVuZHMgeXtwZXJmb3JtRGV0ZWN0aW9uKHQpe3JldHVybiB0aGlzLnByb2Nlc3NEYXRhKHQpfXByb2Nlc3NEYXRhKHQpe2NvbnN0IG49dC52aWRlby5vdXRib3VuZC5maWx0ZXIoKHQ9Plwibm9uZVwiIT09dC5xdWFsaXR5TGltaXRhdGlvblJlYXNvbikpLHI9W10sbz10aGlzLmdldExhc3RQcm9jZXNzZWRTdGF0cyh0LmNvbm5lY3Rpb24uaWQpPy52aWRlby5vdXRib3VuZDtyZXR1cm4gbz8obi5mb3JFYWNoKCh0PT57Y29uc3Qgbj1vLmZpbmQoKGU9PmUuc3NyYz09PXQuc3NyYykpO2lmKCFuKXJldHVybjtjb25zdCBpPXtxdWFsaXR5TGltaXRhdGlvblJlYXNvbjp0LnF1YWxpdHlMaW1pdGF0aW9uUmVhc29ufTt0LmZyYW1lc1NlbnQ+bi5mcmFtZXNTZW50fHwoXCJjcHVcIj09PXQucXVhbGl0eUxpbWl0YXRpb25SZWFzb24mJnIucHVzaCh7c3RhdHNTYW1wbGU6aSx0eXBlOmUuQ1BVLHJlYXNvbjpzLkVuY29kZXJDUFVUaHJvdHRsaW5nLHNzcmM6dC5zc3JjfSksXCJiYW5kd2lkdGhcIj09PXQucXVhbGl0eUxpbWl0YXRpb25SZWFzb24mJnIucHVzaCh7c3RhdHNTYW1wbGU6aSx0eXBlOmUuTmV0d29yayxyZWFzb246cy5PdXRib3VuZE5ldHdvcmtUaHJvdWdocHV0LHNzcmM6dC5zc3JjfSkpO30pKSxyKTpyfX1jbGFzcyBEIGV4dGVuZHMgeXtVTktOT1dOX0RFQ09ERVI9XCJ1bmtub3duXCI7I3U9e307cGVyZm9ybURldGVjdGlvbih0KXtyZXR1cm4gdGhpcy5wcm9jZXNzRGF0YSh0KX1wZXJmb3JtUHJldlN0YXRzQ2xlYW51cCh0KXtjb25zdHtjb25uZWN0aW9uSWQ6ZSxjbGVhbnVwQ2FsbGJhY2s6c309dDtzdXBlci5wZXJmb3JtUHJldlN0YXRzQ2xlYW51cCh7Li4udCxjbGVhbnVwQ2FsbGJhY2s6KCk9PntkZWxldGUgdGhpcy4jdVtlXSxcImZ1bmN0aW9uXCI9PXR5cGVvZiBzJiZzKCk7fX0pO31wcm9jZXNzRGF0YSh0KXtjb25zdCBuPVtdLHtpZDpyfT10LmNvbm5lY3Rpb24sbz10aGlzLmdldExhc3RQcm9jZXNzZWRTdGF0cyhyKT8udmlkZW8uaW5ib3VuZDtyZXR1cm4gdC52aWRlby5pbmJvdW5kLmZvckVhY2goKHQ9Pntjb25zdHtkZWNvZGVySW1wbGVtZW50YXRpb246aSxzc3JjOmF9PXQsYz1vPy5maW5kKCh0PT50LnNzcmM9PT1hKSk7aWYoYylpZihpPT09dGhpcy5VTktOT1dOX0RFQ09ERVIpe2lmKCF0aGlzLmhhZExhc3REZWNvZGVyV2l0aElzc3VlKHIsYSkpe3RoaXMuc2V0TGFzdERlY29kZXJXaXRoSXNzdWUocixhLHRoaXMuVU5LTk9XTl9ERUNPREVSKTtjb25zdCBvPXttaW1lVHlwZTp0Lm1pbWVUeXBlLGRlY29kZXJJbXBsZW1lbnRhdGlvbjppfTtuLnB1c2goe3NzcmM6YSxzdGF0c1NhbXBsZTpvLHR5cGU6ZS5TdHJlYW0scmVhc29uOnMuVW5rbm93blZpZGVvRGVjb2Rlcklzc3VlLHRyYWNrSWRlbnRpZmllcjp0LnRyYWNrLnRyYWNrSWRlbnRpZmllcn0pO319ZWxzZSB0aGlzLnNldExhc3REZWNvZGVyV2l0aElzc3VlKHIsYSx2b2lkIDApO30pKSxufXNldExhc3REZWNvZGVyV2l0aElzc3VlKHQsZSxzKXtjb25zdCBuPXRoaXMuI3VbdF0/P3t9O3ZvaWQgMD09PXM/ZGVsZXRlIG5bZV06bltlXT1zLHRoaXMuI3VbdF09bjt9aGFkTGFzdERlY29kZXJXaXRoSXNzdWUodCxlKXtjb25zdCBzPXRoaXMuI3VbdF07cmV0dXJuIChzJiZzW2VdKT09PXRoaXMuVU5LTk9XTl9ERUNPREVSfX1jb25zdCBDPXQ9PnQucmVkdWNlKCgodCxlKT0+dCtlKSwwKS90Lmxlbmd0aCxSPSh0LGUscz0zMCk9Pntjb25zdCBuPVtdO2ZvcihsZXQgcz0xO3M8ZS5sZW5ndGgtMTtzKz0xKXtjb25zdCByPWVbc10/LnZpZGVvPy5pbmJvdW5kLmZpbmQoKGU9PmUuc3NyYz09PXQpKTtpZighciljb250aW51ZTtjb25zdCBvPWVbcy0xXT8udmlkZW8/LmluYm91bmQ/LmZpbmQoKGU9PmUuc3NyYz09PXQpKTtpZighcnx8IW8pY29udGludWU7Y29uc3QgaT1yLnRpbWVzdGFtcC1vLnRpbWVzdGFtcCxhPXIuZnJhbWVzRGVjb2RlZC1vLmZyYW1lc0RlY29kZWQ7aWYoYT4wKXtjb25zdCB0PWkvYTtuLnB1c2godCk7fX1pZihuLmxlbmd0aDw9MSlyZXR1cm4gITE7cmV0dXJuICh0PT57Y29uc3QgZT0oKHQsZSk9PmUucmVkdWNlKCgoZSxzKT0+ZSsocy10KSoqMiksMCkvZS5sZW5ndGgpKEModCksdCk7cmV0dXJuIE1hdGguc3FydChlKX0pKG4pPnN9LE09KHQsZSk9Pntmb3IobGV0IHM9MTtzPGUubGVuZ3RoO3MrPTEpe2NvbnN0IG49ZVtzXS52aWRlby5pbmJvdW5kLmZpbmQoKGU9PmUuc3NyYz09PXQpKTtpZighbiljb250aW51ZTtjb25zdCByPWVbcy0xXS52aWRlby5pbmJvdW5kLmZpbmQoKGU9PmUuc3NyYz09PXQpKSxvPW4uZnJhbWVXaWR0aCE9PXI/LmZyYW1lV2lkdGgsaT1uLmZyYW1lSGVpZ2h0IT09cj8uZnJhbWVIZWlnaHQ7aWYob3x8aSlyZXR1cm4gITB9cmV0dXJuICExfTtjbGFzcyBJIGV4dGVuZHMgeXsjaDsjbDsjcDtjb25zdHJ1Y3Rvcih0PXt9KXtzdXBlcigpLHRoaXMuI2g9dC5hdmdGcmVlemVEdXJhdGlvblRocmVzaG9sZE1zPz8xZTMsdGhpcy4jbD10LmZyb3plbkR1cmF0aW9uVGhyZXNob2xkUGN0Pz8zMCx0aGlzLiNwPXQubWluTW9zUXVhbGl0eT8/bi5CQUQ7fXBlcmZvcm1EZXRlY3Rpb24odCl7Y29uc3QgZT10Lm5ldHdvcmtTY29yZXMuaW5ib3VuZDtyZXR1cm4gdm9pZCAwIT09ZSYmZTw9dGhpcy4jcD9bXTp0aGlzLnByb2Nlc3NEYXRhKHQpfXByb2Nlc3NEYXRhKHQpe2NvbnN0IG49W10scj10aGlzLmdldEFsbExhc3RQcm9jZXNzZWRTdGF0cyh0LmNvbm5lY3Rpb24uaWQpO2lmKDA9PT1yLmxlbmd0aClyZXR1cm4gW107Y29uc3Qgbz10LnZpZGVvLmluYm91bmQubWFwKChlPT57Y29uc3Qgcz1yW3IubGVuZ3RoLTFdLnZpZGVvLmluYm91bmQuZmluZCgodD0+dC5zc3JjPT09ZS5zc3JjKSk7aWYoIXMpcmV0dXJuO2lmKE0oZS5zc3JjLFtyW3IubGVuZ3RoLTFdLHRdKSlyZXR1cm47aWYoUihlLnNzcmMscikpcmV0dXJuO2NvbnN0IG49ZS5mcmVlemVDb3VudC0ocy5mcmVlemVDb3VudD8/MCksbz0xZTMqKGUudG90YWxGcmVlemVzRHVyYXRpb24tKHMudG90YWxGcmVlemVzRHVyYXRpb24/PzApKSxpPW4+MD9vL246MCxhPW8vKGUudGltZXN0YW1wLXMudGltZXN0YW1wKSoxMDA7cmV0dXJuIGE+dGhpcy4jbHx8aT50aGlzLiNoP3tzc3JjOmUuc3NyYyxhdmdGcmVlemVEdXJhdGlvbk1zOmksZnJvemVuRHVyYXRpb25QY3Q6YX06dm9pZCAwfSkpLmZpbHRlcigodD0+dm9pZCAwIT09dCkpO3JldHVybiBvLmxlbmd0aD4wJiYobi5wdXNoKHt0eXBlOmUuU3RyZWFtLHJlYXNvbjpzLkZyb3plblZpZGVvVHJhY2ssc3RhdHNTYW1wbGU6e3NzcmNzOm8ubWFwKCh0PT50LnNzcmMpKX19KSx0aGlzLmRlbGV0ZUxhc3RQcm9jZXNzZWRTdGF0cyh0LmNvbm5lY3Rpb24uaWQpKSxufX1jbGFzcyBFIGV4dGVuZHMgeXsjZjsjbTsjcDtjb25zdHJ1Y3Rvcih0PXt9KXtzdXBlcih0KSx0aGlzLiNmPXQudm9sYXRpbGl0eVRocmVzaG9sZD8/OCx0aGlzLiNtPXQuYWZmZWN0ZWRTdHJlYW1zUGVyY2VudFRocmVzaG9sZD8/MzAsdGhpcy4jcD10Lm1pbk1vc1F1YWxpdHk/P24uQkFEO31wZXJmb3JtRGV0ZWN0aW9uKHQpe3JldHVybiBbLi4udGhpcy5nZXRBbGxMYXN0UHJvY2Vzc2VkU3RhdHModC5jb25uZWN0aW9uLmlkKSx0XS5maW5kKCh0PT52b2lkIDAhPT10Lm5ldHdvcmtTY29yZXMuaW5ib3VuZCYmdC5uZXR3b3JrU2NvcmVzLmluYm91bmQ8PXRoaXMuI3ApKT9bXTp0aGlzLnByb2Nlc3NEYXRhKHQpfXByb2Nlc3NEYXRhKHQpe2NvbnN0IG49W10scj1bLi4udGhpcy5nZXRBbGxMYXN0UHJvY2Vzc2VkU3RhdHModC5jb25uZWN0aW9uLmlkKSx0XSxvPXQudmlkZW8uaW5ib3VuZC5tYXAoKHQ9PntpZihyLmxlbmd0aDw1KXJldHVybjtpZihNKHQuc3NyYyxyKSlyZXR1cm47Y29uc3QgZT1bXTtmb3IobGV0IHM9MDtzPHIubGVuZ3RoLTE7cys9MSl7Y29uc3Qgbj1yW3NdLnZpZGVvLmluYm91bmQuZmluZCgoZT0+ZS5zc3JjPT09dC5zc3JjKSk7dm9pZCAwIT09bj8uZnJhbWVzUGVyU2Vjb25kJiZlLnB1c2gobi5mcmFtZXNQZXJTZWNvbmQpO31pZihlLmxlbmd0aDw1KXJldHVybjtpZihSKHQuc3NyYyxyKSlyZXR1cm47Y29uc3Qgcz0odD0+e2lmKDA9PT10Lmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgY2FsY3VsYXRlIHZvbGF0aWxpdHkgZm9yIGVtcHR5IGFycmF5XCIpO2NvbnN0IGU9Qyh0KTtyZXR1cm4gdC5yZWR1Y2UoKCh0LHMpPT50K01hdGguYWJzKHMtZSkpLDApL3QubGVuZ3RoKjEwMC9lfSkoZSk7cmV0dXJuIHM+dGhpcy4jZj97c3NyYzp0LnNzcmMsYWxsRnBzOmUsdm9sYXRpbGl0eTpzfTp2b2lkIDB9KSkuZmlsdGVyKCh0PT5Cb29sZWFuKHQpKSk7aWYoMD09PW8ubGVuZ3RoKXJldHVybiBuO2NvbnN0IGk9by5sZW5ndGgvKHQudmlkZW8uaW5ib3VuZC5sZW5ndGgvMTAwKTtyZXR1cm4gaT50aGlzLiNtJiYobi5wdXNoKHt0eXBlOmUuQ1BVLHJlYXNvbjpzLkRlY29kZXJDUFVUaHJvdHRsaW5nLHN0YXRzU2FtcGxlOnthZmZlY3RlZFN0cmVhbXNQZXJjZW50OmksdGhyb3R0aGVkU3RyZWFtczpvfX0pLHRoaXMuZGVsZXRlTGFzdFByb2Nlc3NlZFN0YXRzKHQuY29ubmVjdGlvbi5pZCkpLG59fWNvbnN0IE49dD0+XCJjbG9zZWRcIj09PXQuaWNlQ29ubmVjdGlvblN0YXRlfHxcImNsb3NlZFwiPT09dC5jb25uZWN0aW9uU3RhdGUsXz0odCxlLHMpPT44KigodCxlLHMpPT57aWYoIWUpcmV0dXJuIDA7Y29uc3Qgbj10W3NdLHI9ZVtzXTtpZihudWxsPT1ufHxudWxsPT1yKXJldHVybiAwO2NvbnN0IG89TWF0aC5mbG9vcih0LnRpbWVzdGFtcCktTWF0aC5mbG9vcihlLnRpbWVzdGFtcCk7cmV0dXJuIDA9PT1vPzA6KE51bWJlcihuKS1OdW1iZXIocikpL28qMWUzfSkodCxlLHMpO2NsYXNzIEF7Y29ubmVjdGlvbnM9W107c3RhdHNQYXJzZXI7Y29uc3RydWN0b3IodCl7dGhpcy5zdGF0c1BhcnNlcj10LnN0YXRzUGFyc2VyO31saXN0Q29ubmVjdGlvbnMoKXtyZXR1cm4gWy4uLnRoaXMuY29ubmVjdGlvbnNdfWFkZFBlZXJDb25uZWN0aW9uKHQpe3RoaXMuY29ubmVjdGlvbnMucHVzaCh7aWQ6dC5pZD8/U3RyaW5nKERhdGUubm93KCkrTWF0aC5yYW5kb20oKS50b1N0cmluZygzMikpLHBjOnQucGN9KTt9cmVtb3ZlUGVlckNvbm5lY3Rpb24odCl7Y29uc3QgZT10aGlzLmNvbm5lY3Rpb25zLmZpbmRJbmRleCgoKHtwYzplfSk9PmU9PT10LnBjKSk7ZT49MCYmdGhpcy5yZW1vdmVDb25uZWN0aW9uc0J5SW5kZXhlcyhbZV0pO31hc3luYyBwYXJzZSgpe2NvbnN0IHQ9W10sZT10aGlzLmNvbm5lY3Rpb25zLm1hcCgoYXN5bmMoZSxzKT0+e2lmKCFOKGUucGMpKXJldHVybiB0aGlzLnN0YXRzUGFyc2VyLnBhcnNlKGUpO3QudW5zaGlmdChzKTt9KSk7dC5sZW5ndGgmJnRoaXMucmVtb3ZlQ29ubmVjdGlvbnNCeUluZGV4ZXModCk7cmV0dXJuIChhd2FpdCBQcm9taXNlLmFsbChlKSkuZmlsdGVyKCh0PT52b2lkIDAhPT10KSl9cmVtb3ZlQ29ubmVjdGlvbnNCeUluZGV4ZXModCl7dC5mb3JFYWNoKCh0PT57dGhpcy5jb25uZWN0aW9ucy5zcGxpY2UodCwxKTt9KSk7fX1jbGFzcyBPe3ByZXZTdGF0cz1uZXcgTWFwO2FsbG93ZWRSZXBvcnRUeXBlcz1uZXcgU2V0KFtcImNhbmRpZGF0ZS1wYWlyXCIsXCJpbmJvdW5kLXJ0cFwiLFwib3V0Ym91bmQtcnRwXCIsXCJyZW1vdGUtb3V0Ym91bmQtcnRwXCIsXCJyZW1vdGUtaW5ib3VuZC1ydHBcIixcInRyYWNrXCIsXCJ0cmFuc3BvcnRcIl0pO2lnbm9yZVNTUkNMaXN0O2xvZ2dlcjtjb25zdHJ1Y3Rvcih0KXt0aGlzLmlnbm9yZVNTUkNMaXN0PXQuaWdub3JlU1NSQ0xpc3Q/P1tdLHRoaXMubG9nZ2VyPXQubG9nZ2VyO31nZXQgcHJldmlvdXNseVBhcnNlZFN0YXRzQ29ubmVjdGlvbnNJZHMoKXtyZXR1cm4gWy4uLnRoaXMucHJldlN0YXRzLmtleXMoKV19YXN5bmMgcGFyc2UodCl7aWYoIU4odC5wYykpcmV0dXJuIHRoaXMuZ2V0Q29ubmVjdGlvblN0YXRzKHQpO3RoaXMubG9nZ2VyLmRlYnVnKFwiU2tpcCBzdGF0cyBwYXJzaW5nLiBDb25uZWN0aW9uIGlzIGNsb3NlZC5cIix7Y29ubmVjdGlvbjp0fSk7fWFzeW5jIGdldENvbm5lY3Rpb25TdGF0cyh0KXtjb25zdHtwYzplLGlkOnN9PXQ7dHJ5e2NvbnN0IG49RGF0ZS5ub3coKSxyPWUuZ2V0UmVjZWl2ZXJzKCkuZmlsdGVyKCh0PT50LnRyYWNrPy5lbmFibGVkKSksbz1lLmdldFNlbmRlcnMoKS5maWx0ZXIoKHQ9PnQudHJhY2s/LmVuYWJsZWQpKSxpPWF3YWl0IFByb21pc2UuYWxsKHIubWFwKCh0PT50LmdldFN0YXRzKCkpKSksYT1hd2FpdCBQcm9taXNlLmFsbChvLm1hcCgodD0+dC5nZXRTdGF0cygpKSkpO3JldHVybiB7aWQ6cyxzdGF0czp0aGlzLm1hcFJlcG9ydHNTdGF0cyhbLi4uaSwuLi5hXSx0KSx0aW1lVGFrZW46RGF0ZS5ub3coKS1ufX1jYXRjaCh0KXtyZXR1cm4gdm9pZCB0aGlzLmxvZ2dlci5lcnJvcihcIkZhaWxlZCB0byBnZXQgc3RhdHMgZm9yIFBDXCIse2lkOnMscGM6ZSxlcnJvcjp0fSl9fW1hcFJlcG9ydHNTdGF0cyh0LGUpe2NvbnN0IHM9e2F1ZGlvOntpbmJvdW5kOltdLG91dGJvdW5kOltdfSx2aWRlbzp7aW5ib3VuZDpbXSxvdXRib3VuZDpbXX0sY29ubmVjdGlvbjp7fSxyZW1vdGU6e3ZpZGVvOntpbmJvdW5kOltdLG91dGJvdW5kOltdfSxhdWRpbzp7aW5ib3VuZDpbXSxvdXRib3VuZDpbXX19fTt0LmZvckVhY2goKHQ9Pnt0LmZvckVhY2goKGU9Pnt0aGlzLmFsbG93ZWRSZXBvcnRUeXBlcy5oYXMoZS50eXBlKSYmdGhpcy51cGRhdGVNYXBwZWRTdGF0c1dpdGhSZXBvcnRJdGVtRGF0YShlLHMsdCk7fSkpO30pKTtjb25zdHtpZDpufT1lLHI9dGhpcy5wcmV2U3RhdHMuZ2V0KG4pO3JldHVybiByJiZ0aGlzLnByb3BhZ2F0ZVN0YXRzV2l0aFJhdGVWYWx1ZXMocyxyLnN0YXRzKSx0aGlzLnByZXZTdGF0cy5zZXQobix7c3RhdHM6cyx0czpEYXRlLm5vdygpfSksdih7dGFza0lkOm4sZGVsYXlNczozNWUzLGNhbGxiYWNrOigpPT50aGlzLnByZXZTdGF0cy5kZWxldGUobil9KSxzfXVwZGF0ZU1hcHBlZFN0YXRzV2l0aFJlcG9ydEl0ZW1EYXRhKHQsZSxzKXtjb25zdCBuPXQudHlwZTtpZihcImNhbmRpZGF0ZS1wYWlyXCI9PT1uJiZcInN1Y2NlZWRlZFwiPT09dC5zdGF0ZSYmdC5ub21pbmF0ZWQpcmV0dXJuIHZvaWQoZS5jb25uZWN0aW9uPXRoaXMucHJlcGFyZUNvbm5lY3Rpb25TdGF0cyh0LHMpKTtjb25zdCByPXRoaXMuZ2V0TWVkaWFUeXBlKHQpO2lmKCFyKXJldHVybjtjb25zdCBvPXQuc3NyYztpZighb3x8IXRoaXMuaWdub3JlU1NSQ0xpc3QuaW5jbHVkZXMobykpaWYoXCJvdXRib3VuZC1ydHBcIiE9PW4paWYoXCJpbmJvdW5kLXJ0cFwiIT09bilcInJlbW90ZS1vdXRib3VuZC1ydHBcIiE9PW4/XCJyZW1vdGUtaW5ib3VuZC1ydHBcIj09PW4mJih0aGlzLm1hcENvbm5lY3Rpb25TdGF0c0lmTmVjZXNzYXJ5KGUsdCxzKSxlLnJlbW90ZVtyXS5pbmJvdW5kLnB1c2goey4uLnR9KSk6ZS5yZW1vdGVbcl0ub3V0Ym91bmQucHVzaCh7Li4udH0pO2Vsc2Uge2NvbnN0IG49cy5nZXQodC50cmFja0lkKXx8cy5nZXQodC5tZWRpYVNvdXJjZUlkKXx8e307dGhpcy5tYXBDb25uZWN0aW9uU3RhdHNJZk5lY2Vzc2FyeShlLHQscyk7Y29uc3Qgbz17Li4udCx0cmFjazp7Li4ubn19O2Vbcl0uaW5ib3VuZC5wdXNoKG8pO31lbHNlIHtjb25zdCBuPXMuZ2V0KHQudHJhY2tJZCl8fHMuZ2V0KHQubWVkaWFTb3VyY2VJZCl8fHt9LG89ey4uLnQsdHJhY2s6ey4uLm59fTtlW3JdLm91dGJvdW5kLnB1c2gobyk7fX1nZXRNZWRpYVR5cGUodCl7Y29uc3QgZT10Lm1lZGlhVHlwZXx8dC5raW5kO2lmKCFbXCJhdWRpb1wiLFwidmlkZW9cIl0uaW5jbHVkZXMoZSkpe2NvbnN0e2lkOmV9PXQ7aWYoIWUpcmV0dXJuO3JldHVybiBTdHJpbmcoZSkuaW5jbHVkZXMoXCJWaWRlb1wiKT9cInZpZGVvXCI6U3RyaW5nKGUpLmluY2x1ZGVzKFwiQXVkaW9cIik/XCJhdWRpb1wiOnZvaWQgMH1yZXR1cm4gZX1wcm9wYWdhdGVTdGF0c1dpdGhSYXRlVmFsdWVzKHQsZSl7dC5hdWRpby5pbmJvdW5kLmZvckVhY2goKHQ9Pntjb25zdCBzPWUuYXVkaW8uaW5ib3VuZC5maW5kKCgoe2lkOmV9KT0+ZT09PXQuaWQpKTt0LmJpdHJhdGU9Xyh0LHMsXCJieXRlc1JlY2VpdmVkXCIpLHQucGFja2V0UmF0ZT1fKHQscyxcInBhY2tldHNSZWNlaXZlZFwiKTt9KSksdC5hdWRpby5vdXRib3VuZC5mb3JFYWNoKCh0PT57Y29uc3Qgcz1lLmF1ZGlvLm91dGJvdW5kLmZpbmQoKCh7aWQ6ZX0pPT5lPT09dC5pZCkpO3QuYml0cmF0ZT1fKHQscyxcImJ5dGVzU2VudFwiKSx0LnBhY2tldFJhdGU9Xyh0LHMsXCJwYWNrZXRzU2VudFwiKTt9KSksdC52aWRlby5pbmJvdW5kLmZvckVhY2goKHQ9Pntjb25zdCBzPWUudmlkZW8uaW5ib3VuZC5maW5kKCgoe2lkOmV9KT0+ZT09PXQuaWQpKTt0LmJpdHJhdGU9Xyh0LHMsXCJieXRlc1JlY2VpdmVkXCIpLHQucGFja2V0UmF0ZT1fKHQscyxcInBhY2tldHNSZWNlaXZlZFwiKTt9KSksdC52aWRlby5vdXRib3VuZC5mb3JFYWNoKCh0PT57Y29uc3Qgcz1lLnZpZGVvLm91dGJvdW5kLmZpbmQoKCh7aWQ6ZX0pPT5lPT09dC5pZCkpO3QuYml0cmF0ZT1fKHQscyxcImJ5dGVzU2VudFwiKSx0LnBhY2tldFJhdGU9Xyh0LHMsXCJwYWNrZXRzU2VudFwiKTt9KSk7fW1hcENvbm5lY3Rpb25TdGF0c0lmTmVjZXNzYXJ5KHQsZSxzKXtpZih0LmNvbm5lY3Rpb24uaWR8fCFlLnRyYW5zcG9ydElkKXJldHVybjtjb25zdCBuPXMuZ2V0KGUudHJhbnNwb3J0SWQpO2lmKG4mJm4uc2VsZWN0ZWRDYW5kaWRhdGVQYWlySWQpe2NvbnN0IGU9cy5nZXQobi5zZWxlY3RlZENhbmRpZGF0ZVBhaXJJZCk7dC5jb25uZWN0aW9uPXRoaXMucHJlcGFyZUNvbm5lY3Rpb25TdGF0cyhlLHMpO319cHJlcGFyZUNvbm5lY3Rpb25TdGF0cyh0LGUpe2lmKCF0fHwhZSlyZXR1cm4ge307Y29uc3Qgcz17Li4udH07aWYocy5yZW1vdGVDYW5kaWRhdGVJZCl7Y29uc3QgdD1lLmdldChzLnJlbW90ZUNhbmRpZGF0ZUlkKTtzLnJlbW90ZT17Li4udH07fWlmKHMubG9jYWxDYW5kaWRhdGVJZCl7Y29uc3QgdD1lLmdldChzLmxvY2FsQ2FuZGlkYXRlSWQpO3MubG9jYWw9ey4uLnR9O31yZXR1cm4gc319Y2xhc3MgSiBleHRlbmRzIHl7I2c9bmV3IE1hcDsjUzsjdjtjb25zdHJ1Y3Rvcih0PXt9KXtzdXBlcigpLHRoaXMuI1M9dC50aW1lb3V0TXM/PzE1ZTMsdGhpcy4jdj10LnN0ZXBzPz8zO31wZXJmb3JtRGV0ZWN0aW9uKHQpe3JldHVybiB0aGlzLnByb2Nlc3NEYXRhKHQpfXByb2Nlc3NEYXRhKHQpe2NvbnN0IG49W10scj1bLi4udGhpcy5nZXRBbGxMYXN0UHJvY2Vzc2VkU3RhdHModC5jb25uZWN0aW9uLmlkKSx0XTtpZihyLmxlbmd0aDx0aGlzLiN2KXJldHVybiBuO2NvbnN0IG89ci5zbGljZSgtdGhpcy4jdiksaT1vLm1hcCgodD0+dC52aWRlby5pbmJvdW5kKSksYT1vLm1hcCgodD0+dC5hdWRpby5pbmJvdW5kKSk7bi5wdXNoKC4uLnRoaXMuZGV0ZWN0TWlzc2luZ0RhdGEoYSxlLlN0cmVhbSxzLk1pc3NpbmdBdWRpb1N0cmVhbURhdGEpKSxuLnB1c2goLi4udGhpcy5kZXRlY3RNaXNzaW5nRGF0YShpLGUuU3RyZWFtLHMuTWlzc2luZ1ZpZGVvU3RyZWFtRGF0YSkpO3JldHVybiBuZXcgU2V0KHRoaXMuI2cua2V5cygpKS5mb3JFYWNoKCh0PT57Y29uc3QgZT10aGlzLiNnLmdldCh0KTtlJiZEYXRlLm5vdygpLWU+dGhpcy4jUyYmdGhpcy5yZW1vdmVNYXJrZWRJc3N1ZSh0KTt9KSksbn1kZXRlY3RNaXNzaW5nRGF0YSh0LGUscyl7Y29uc3Qgbj1bXSxyPXQucG9wKCksbz1KLm1hcFN0YXRzQnlUcmFja0lkKHQpO3JldHVybiByLmZvckVhY2goKHQ9Pntjb25zdCByPXQudHJhY2sudHJhY2tJZGVudGlmaWVyLGk9by5nZXQocik7aWYoIUFycmF5LmlzQXJyYXkoaSl8fDA9PT1pLmxlbmd0aClyZXR1cm47aWYodC50cmFjay5kZXRhY2hlZHx8dC50cmFjay5lbmRlZClyZXR1cm47aWYoIUouaXNBbGxCeXRlc1JlY2VpdmVkRGlkbnRDaGFuZ2UodC5ieXRlc1JlY2VpdmVkLGkpKXJldHVybiB2b2lkIHRoaXMucmVtb3ZlTWFya2VkSXNzdWUocik7aWYoIXRoaXMubWFya0lzc3VlKHIpKXJldHVybjtjb25zdCBhPXtieXRlc1JlY2VpdmVkOnQuYnl0ZXNSZWNlaXZlZH07bi5wdXNoKHt0eXBlOmUscmVhc29uOnMsc3RhdHNTYW1wbGU6YSx0cmFja0lkZW50aWZpZXI6cn0pO30pKSxufXN0YXRpYyBtYXBTdGF0c0J5VHJhY2tJZCh0KXtjb25zdCBlPW5ldyBNYXA7cmV0dXJuIHQuZm9yRWFjaCgodD0+e3QuZm9yRWFjaCgodD0+e2NvbnN0IHM9ZS5nZXQodC50cmFjay50cmFja0lkZW50aWZpZXIpfHxbXTtzLnB1c2godCksZS5zZXQodC50cmFjay50cmFja0lkZW50aWZpZXIscyk7fSkpO30pKSxlfXN0YXRpYyBpc0FsbEJ5dGVzUmVjZWl2ZWREaWRudENoYW5nZSh0LGUpe2ZvcihsZXQgcz0wO3M8ZS5sZW5ndGg7cys9MSl7aWYoZVtzXS5ieXRlc1JlY2VpdmVkIT09dClyZXR1cm4gITF9cmV0dXJuICEwfW1hcmtJc3N1ZSh0KXtjb25zdCBlPURhdGUubm93KCkscz10aGlzLiNnLmdldCh0KTtyZXR1cm4gKCFzfHxlLXM+dGhpcy4jUykmJih0aGlzLiNnLnNldCh0LGUpLCEwKX1yZW1vdmVNYXJrZWRJc3N1ZSh0KXt0aGlzLiNnLmRlbGV0ZSh0KTt9fWNsYXNzIHh7ZXZlbnRFbWl0dGVyOyNrPSExO2RldGVjdG9ycz1bXTtuZXR3b3JrU2NvcmVzQ2FsY3VsYXRvcjtzdGF0c1JlcG9ydGVyO2NvbXBvc2l0ZVN0YXRzUGFyc2VyO2xvZ2dlcjthdXRvQWRkUGVlckNvbm5lY3Rpb25zO2NvbnN0cnVjdG9yKGUpe3RoaXMubG9nZ2VyPWUubG9nZ2VyPz97ZGVidWc6KCk9Pnt9LGluZm86KCk9Pnt9LHdhcm46KCk9Pnt9LGVycm9yOigpPT57fX0sdGhpcy5ldmVudEVtaXR0ZXI9ZS5pc3N1ZUVtaXR0ZXI/P25ldyBnLGUub25Jc3N1ZXMmJnRoaXMuZXZlbnRFbWl0dGVyLm9uKHQuSXNzdWUsZS5vbklzc3VlcyksZS5vbk5ldHdvcmtTY29yZXNVcGRhdGVkJiZ0aGlzLmV2ZW50RW1pdHRlci5vbih0Lk5ldHdvcmtTY29yZXNVcGRhdGVkLGUub25OZXR3b3JrU2NvcmVzVXBkYXRlZCksdGhpcy5kZXRlY3RvcnM9ZS5kZXRlY3RvcnM/P1tuZXcgTCxuZXcgYixuZXcgVCxuZXcgUCxuZXcgdyxuZXcgRCxuZXcgSSxuZXcgRSxuZXcgSl0sdGhpcy5uZXR3b3JrU2NvcmVzQ2FsY3VsYXRvcj1lLm5ldHdvcmtTY29yZXNDYWxjdWxhdG9yPz9uZXcgayx0aGlzLmNvbXBvc2l0ZVN0YXRzUGFyc2VyPWUuY29tcG9zaXRlU3RhdHNQYXJzZXI/P25ldyBBKHtzdGF0c1BhcnNlcjpuZXcgTyh7aWdub3JlU1NSQ0xpc3Q6ZS5pZ25vcmVTU1JDTGlzdCxsb2dnZXI6dGhpcy5sb2dnZXJ9KX0pLHRoaXMuc3RhdHNSZXBvcnRlcj1lLnN0YXRzUmVwb3J0ZXI/P25ldyBTKHtjb21wb3NpdGVTdGF0c1BhcnNlcjp0aGlzLmNvbXBvc2l0ZVN0YXRzUGFyc2VyLGdldFN0YXRzSW50ZXJ2YWw6ZS5nZXRTdGF0c0ludGVydmFsPz81ZTN9KSx3aW5kb3cud2lkPXRoaXMsdGhpcy5hdXRvQWRkUGVlckNvbm5lY3Rpb25zPWUuYXV0b0FkZFBlZXJDb25uZWN0aW9ucz8/ITAsdGhpcy5hdXRvQWRkUGVlckNvbm5lY3Rpb25zJiZ0aGlzLndyYXBSVENQZWVyQ29ubmVjdGlvbigpLHRoaXMuc3RhdHNSZXBvcnRlci5vbihTLlNUQVRTX1JFUE9SVF9SRUFEWV9FVkVOVCwodD0+e2NvbnN0IGU9dGhpcy5jYWxjdWxhdGVOZXR3b3JrU2NvcmVzKHQuc3RhdHMpO3RoaXMuZGV0ZWN0SXNzdWVzKHtkYXRhOnQuc3RhdHN9LGUpO30pKSx0aGlzLnN0YXRzUmVwb3J0ZXIub24oUy5TVEFUU19SRVBPUlRTX1BBUlNFRCwocz0+e2NvbnN0IG49e3RpbWVUYWtlbjpzLnRpbWVUYWtlbix0czpEYXRlLm5vdygpfTtlLm9uU3RhdHMmJmUub25TdGF0cyhzLnJlcG9ydEl0ZW1zKSx0aGlzLmV2ZW50RW1pdHRlci5lbWl0KHQuU3RhdHNQYXJzaW5nRmluaXNoZWQsbik7fSkpO313YXRjaE5ld1BlZXJDb25uZWN0aW9ucygpe2lmKCF0aGlzLmF1dG9BZGRQZWVyQ29ubmVjdGlvbnMpdGhyb3cgbmV3IEVycm9yKFwiQXV0byBhZGQgcGVlciBjb25uZWN0aW9ucyB3YXMgZGlzYWJsZWQgaW4gdGhlIGNvbnN0cnVjdG9yLlwiKTt0aGlzLiNrP3RoaXMubG9nZ2VyLndhcm4oXCJXZWJSVENJc3N1ZURldGVjdG9yIGlzIGFscmVhZHkgc3RhcnRlZC4gU2tpcCBwcm9jZXNzaW5nXCIpOih0aGlzLmxvZ2dlci5pbmZvKFwiU3RhcnQgd2F0Y2hpbmcgcGVlciBjb25uZWN0aW9uc1wiKSx0aGlzLiNrPSEwLHRoaXMuc3RhdHNSZXBvcnRlci5zdGFydFJlcG9ydGluZygpKTt9c3RvcFdhdGNoaW5nTmV3UGVlckNvbm5lY3Rpb25zKCl7dGhpcy4jaz8odGhpcy5sb2dnZXIuaW5mbyhcIlN0b3Agd2F0Y2hpbmcgcGVlciBjb25uZWN0aW9uc1wiKSx0aGlzLiNrPSExLHRoaXMuc3RhdHNSZXBvcnRlci5zdG9wUmVwb3J0aW5nKCkpOnRoaXMubG9nZ2VyLndhcm4oXCJXZWJSVENJc3N1ZURldGVjdG9yIGlzIGFscmVhZHkgc3RvcHBlZC4gU2tpcCBwcm9jZXNzaW5nXCIpO31oYW5kbGVOZXdQZWVyQ29ubmVjdGlvbih0LGUpe3RoaXMuI2t8fCF0aGlzLmF1dG9BZGRQZWVyQ29ubmVjdGlvbnM/KHRoaXMuI2t8fCExIT09dGhpcy5hdXRvQWRkUGVlckNvbm5lY3Rpb25zfHwodGhpcy5sb2dnZXIuaW5mbyhcIlN0YXJ0aW5nIHN0YXRzIHJlcG9ydGluZyBmb3IgbmV3IHBlZXIgY29ubmVjdGlvblwiKSx0aGlzLiNrPSEwLHRoaXMuc3RhdHNSZXBvcnRlci5zdGFydFJlcG9ydGluZygpKSx0aGlzLmxvZ2dlci5kZWJ1ZyhcIkhhbmRsaW5nIG5ldyBwZWVyIGNvbm5lY3Rpb25cIix0KSx0aGlzLmNvbXBvc2l0ZVN0YXRzUGFyc2VyLmFkZFBlZXJDb25uZWN0aW9uKHtwYzp0LGlkOmV9KSk6dGhpcy5sb2dnZXIuZGVidWcoXCJTa2lwIGhhbmRsaW5nIG5ldyBwZWVyIGNvbm5lY3Rpb24uIERldGVjdG9yIGlzIG5vdCBydW5uaW5nXCIsdCk7fWVtaXRJc3N1ZXMoZSl7dGhpcy5ldmVudEVtaXR0ZXIuZW1pdCh0Lklzc3VlLGUpO31kZXRlY3RJc3N1ZXMoe2RhdGE6dH0sZSl7Y29uc3Qgcz10aGlzLmRldGVjdG9ycy5yZWR1Y2UoKChzLG4pPT5bLi4ucywuLi5uLmRldGVjdCh0LGUpXSksW10pO3MubGVuZ3RoPjAmJnRoaXMuZW1pdElzc3VlcyhzKTt9Y2FsY3VsYXRlTmV0d29ya1Njb3JlcyhlKXtjb25zdCBzPXRoaXMubmV0d29ya1Njb3Jlc0NhbGN1bGF0b3IuY2FsY3VsYXRlKGUpO3JldHVybiB0aGlzLmV2ZW50RW1pdHRlci5lbWl0KHQuTmV0d29ya1Njb3Jlc1VwZGF0ZWQscyksc313cmFwUlRDUGVlckNvbm5lY3Rpb24oKXtpZighd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uKXJldHVybiB2b2lkIHRoaXMubG9nZ2VyLndhcm4oXCJObyBSVENQZWVyQ29ubmVjdGlvbiBmb3VuZCBpbiBicm93c2VyIHdpbmRvdy4gU2tpcHBpbmdcIik7Y29uc3QgdD13aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24sZT10PT50aGlzLmhhbmRsZU5ld1BlZXJDb25uZWN0aW9uKHQpO2Z1bmN0aW9uIHMocyl7Y29uc3Qgbj1uZXcgdChzKTtyZXR1cm4gZShuKSxufXMucHJvdG90eXBlPXQucHJvdG90eXBlLHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbj1zO319XG5cbnZhciBXZWJSVENDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoV2ViUlRDQ29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3IsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gV2ViUlRDQ29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3IoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5pc3N1ZURldGVjdG9yID0gbnVsbDtcbiAgICAgICAgX3RoaXMubW9zU2NvcmVzID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBXZWJSVENDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvci5wcm90b3R5cGUuX3N0YXJ0ID0gZnVuY3Rpb24gKHBlZXJDb25uZWN0aW9uKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuaXNzdWVEZXRlY3RvciA9IG5ldyB4KHtcbiAgICAgICAgICAgIGF1dG9BZGRQZWVyQ29ubmVjdGlvbnM6IGZhbHNlLFxuICAgICAgICAgICAgZ2V0U3RhdHNJbnRlcnZhbDogMzAwMCxcbiAgICAgICAgICAgIG9uTmV0d29ya1Njb3Jlc1VwZGF0ZWQ6IGZ1bmN0aW9uIChzY29yZXMpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5tb3NTY29yZXMgPSBzY29yZXM7XG4gICAgICAgICAgICAgICAgX3RoaXMuaGFuZGxlU3RhdHNDaGFuZ2VkKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5pc3N1ZURldGVjdG9yLmhhbmRsZU5ld1BlZXJDb25uZWN0aW9uKHBlZXJDb25uZWN0aW9uKTtcbiAgICB9O1xuICAgIFdlYlJUQ0Nvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yLnByb3RvdHlwZS5fc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNzdWVEZXRlY3Rvcikge1xuICAgICAgICAgICAgdGhpcy5pc3N1ZURldGVjdG9yLnN0b3BXYXRjaGluZ05ld1BlZXJDb25uZWN0aW9ucygpO1xuICAgICAgICAgICAgdGhpcy5pc3N1ZURldGVjdG9yID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1vc1Njb3JlcyA9IG51bGw7XG4gICAgfTtcbiAgICBXZWJSVENDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvci5wcm90b3R5cGUuY2FsY3VsYXRlQ29ubmVjdGlvblF1YWxpdHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5tb3NTY29yZXMgfHwgKHRoaXMubW9zU2NvcmVzLmluYm91bmQgJiYgdGhpcy5tb3NTY29yZXMub3V0Ym91bmQpKSB7XG4gICAgICAgICAgICByZXR1cm4gQ29ubmVjdGlvblF1YWxpdHkuVU5LTk9XTjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKHRoaXMubW9zU2NvcmVzLmluYm91bmQgJiYgdGhpcy5tb3NTY29yZXMuaW5ib3VuZCA8IDMpIHx8XG4gICAgICAgICAgICAodGhpcy5tb3NTY29yZXMub3V0Ym91bmQgJiYgdGhpcy5tb3NTY29yZXMub3V0Ym91bmQgPCAzKSkge1xuICAgICAgICAgICAgcmV0dXJuIENvbm5lY3Rpb25RdWFsaXR5LkJBRDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQ29ubmVjdGlvblF1YWxpdHkuR09PRDtcbiAgICB9O1xuICAgIHJldHVybiBXZWJSVENDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvcjtcbn0oQWJzdHJhY3RDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvcikpO1xuXG52YXIgVm9pY2VDaGF0U3RhdGU7XG4oZnVuY3Rpb24gKFZvaWNlQ2hhdFN0YXRlKSB7XG4gICAgVm9pY2VDaGF0U3RhdGVbXCJJTkFDVElWRVwiXSA9IFwiaW5hY3RpdmVcIjtcbiAgICBWb2ljZUNoYXRTdGF0ZVtcIlNUQVJUSU5HXCJdID0gXCJzdGFydGluZ1wiO1xuICAgIFZvaWNlQ2hhdFN0YXRlW1wiQUNUSVZFXCJdID0gXCJzdGFydGVkXCI7XG4gICAgVm9pY2VDaGF0U3RhdGVbXCJTVE9QUElOR1wiXSA9IFwic3RvcHBpbmdcIjtcbn0pKFZvaWNlQ2hhdFN0YXRlIHx8IChWb2ljZUNoYXRTdGF0ZSA9IHt9KSk7XG52YXIgQWJzdHJhY3RWb2ljZUNoYXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQWJzdHJhY3RWb2ljZUNoYXQoKSB7XG4gICAgfVxuICAgIHJldHVybiBBYnN0cmFjdFZvaWNlQ2hhdDtcbn0oKSk7XG52YXIgQWJzdHJhY3RWb2ljZUNoYXRJbXBsZW1lbnRhdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoQWJzdHJhY3RWb2ljZUNoYXRJbXBsZW1lbnRhdGlvbiwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBBYnN0cmFjdFZvaWNlQ2hhdEltcGxlbWVudGF0aW9uKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX2lzTXV0ZWQgPSB0cnVlO1xuICAgICAgICBfdGhpcy5zdGF0ZSA9IFZvaWNlQ2hhdFN0YXRlLklOQUNUSVZFO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYnN0cmFjdFZvaWNlQ2hhdEltcGxlbWVudGF0aW9uLnByb3RvdHlwZSwgXCJpc011dGVkXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5faXNNdXRlZDtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYnN0cmFjdFZvaWNlQ2hhdEltcGxlbWVudGF0aW9uLnByb3RvdHlwZSwgXCJpc1ZvaWNlQ2hhdHRpbmdcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlICE9PSBWb2ljZUNoYXRTdGF0ZS5JTkFDVElWRTtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIEFic3RyYWN0Vm9pY2VDaGF0SW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnN0YXJ0Vm9pY2VDaGF0ID0gZnVuY3Rpb24gKHZvaWNlQ2hhdENvbmZpZykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZV8xO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEodGhpcy5zdGF0ZSAhPT0gVm9pY2VDaGF0U3RhdGUuSU5BQ1RJVkUpKSByZXR1cm4gWzMgLypicmVhayovLCAyXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuc3RvcFZvaWNlQ2hhdCgpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2EubGFiZWwgPSAyO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzIsIDQsICwgNl0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IFZvaWNlQ2hhdFN0YXRlLlNUQVJUSU5HO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5fc3RhcnRWb2ljZUNoYXQodm9pY2VDaGF0Q29uZmlnKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBWb2ljZUNoYXRTdGF0ZS5BQ1RJVkU7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzMgLypicmVhayovLCA2XTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAgZV8xID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5zdG9wVm9pY2VDaGF0KCldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlXzE7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNjogcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEFic3RyYWN0Vm9pY2VDaGF0SW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnN0b3BWb2ljZUNoYXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlID09PSBWb2ljZUNoYXRTdGF0ZS5JTkFDVElWRSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBWb2ljZUNoYXRTdGF0ZS5TVE9QUElORztcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuX3N0b3BWb2ljZUNoYXQoKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzTXV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IFZvaWNlQ2hhdFN0YXRlLklOQUNUSVZFO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEFic3RyYWN0Vm9pY2VDaGF0SW1wbGVtZW50YXRpb24ucHJvdG90eXBlLl9tdXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm47XG4gICAgfTtcbiAgICBBYnN0cmFjdFZvaWNlQ2hhdEltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5fdW5tdXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm47XG4gICAgfTtcbiAgICBBYnN0cmFjdFZvaWNlQ2hhdEltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5tdXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNWb2ljZUNoYXR0aW5nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbXV0ZSgpO1xuICAgICAgICB0aGlzLl9pc011dGVkID0gdHJ1ZTtcbiAgICB9O1xuICAgIEFic3RyYWN0Vm9pY2VDaGF0SW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnVubXV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzVm9pY2VDaGF0dGluZykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3VubXV0ZSgpO1xuICAgICAgICB0aGlzLl9pc011dGVkID0gZmFsc2U7XG4gICAgfTtcbiAgICByZXR1cm4gQWJzdHJhY3RWb2ljZUNoYXRJbXBsZW1lbnRhdGlvbjtcbn0oQWJzdHJhY3RWb2ljZUNoYXQpKTtcblxuZnVuY3Rpb24gc2xlZXAobXMpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmV0dXJuIHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpOyB9KTtcbn1cbmZ1bmN0aW9uIGNvbnZlcnRGbG9hdDMyVG9TMTZQQ00oZmxvYXQzMkFycmF5KSB7XG4gICAgdmFyIGludDE2QXJyYXkgPSBuZXcgSW50MTZBcnJheShmbG9hdDMyQXJyYXkubGVuZ3RoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZsb2F0MzJBcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgY2xhbXBlZFZhbHVlID0gTWF0aC5tYXgoLTEsIE1hdGgubWluKDEsIGZsb2F0MzJBcnJheVtpXSkpO1xuICAgICAgICBpbnQxNkFycmF5W2ldID0gY2xhbXBlZFZhbHVlIDwgMCA/IGNsYW1wZWRWYWx1ZSAqIDMyNzY4IDogY2xhbXBlZFZhbHVlICogMzI3Njc7XG4gICAgfVxuICAgIHJldHVybiBpbnQxNkFycmF5O1xufVxuXG52YXIgTGl2ZWtpdFZvaWNlQ2hhdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTGl2ZWtpdFZvaWNlQ2hhdCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBMaXZla2l0Vm9pY2VDaGF0KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMucm9vbSA9IG51bGw7XG4gICAgICAgIF90aGlzLnRyYWNrID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBMaXZla2l0Vm9pY2VDaGF0LnByb3RvdHlwZS5fc3RhcnRWb2ljZUNoYXQgPSBmdW5jdGlvbiAodm9pY2VDaGF0Q29uZmlnKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIHZhciBfYjtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2MpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm9vbSA9IHZvaWNlQ2hhdENvbmZpZy5yb29tO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2EgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgY3JlYXRlTG9jYWxBdWRpb1RyYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNob0NhbmNlbGxhdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9pc2VTdXBwcmVzc2lvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b0dhaW5Db250cm9sOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJhY2sgPSBfYy5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLnJvb20ubG9jYWxQYXJ0aWNpcGFudC5wdWJsaXNoVHJhY2sodGhpcy50cmFjayldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYy5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISgoX2IgPSB2b2ljZUNoYXRDb25maWcuY29uZmlnKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZGVmYXVsdE11dGVkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudW5tdXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm11dGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHNsZWVwKDQwMDApXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Muc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIExpdmVraXRWb2ljZUNoYXQucHJvdG90eXBlLl9zdG9wVm9pY2VDaGF0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9iKSB7XG4gICAgICAgICAgICAgICAgaWYgKChfYSA9IHRoaXMucm9vbSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxvY2FsUGFydGljaXBhbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb29tLmxvY2FsUGFydGljaXBhbnQuZ2V0VHJhY2tQdWJsaWNhdGlvbnMoKS5mb3JFYWNoKGZ1bmN0aW9uIChwdWJsaWNhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHB1YmxpY2F0aW9uLnRyYWNrICYmIHB1YmxpY2F0aW9uLnRyYWNrLmtpbmQgPT09IFRyYWNrLktpbmQuQXVkaW8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWNhdGlvbi50cmFjay5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy50cmFjaykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYWNrLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFjayA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIExpdmVraXRWb2ljZUNoYXQucHJvdG90eXBlLl9tdXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy50cmFjayAmJiAhdGhpcy50cmFjay5pc011dGVkKSB7XG4gICAgICAgICAgICB0aGlzLnRyYWNrLm11dGUoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgTGl2ZWtpdFZvaWNlQ2hhdC5wcm90b3R5cGUuX3VubXV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMudHJhY2sgJiYgdGhpcy50cmFjay5pc011dGVkKSB7XG4gICAgICAgICAgICB0aGlzLnRyYWNrLnVubXV0ZSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gTGl2ZWtpdFZvaWNlQ2hhdDtcbn0oQWJzdHJhY3RWb2ljZUNoYXRJbXBsZW1lbnRhdGlvbikpO1xuXG52YXIgV2ViU29ja2V0Vm9pY2VDaGF0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhXZWJTb2NrZXRWb2ljZUNoYXQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gV2ViU29ja2V0Vm9pY2VDaGF0KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuYXVkaW9Db250ZXh0ID0gbnVsbDtcbiAgICAgICAgX3RoaXMud2ViU29ja2V0ID0gbnVsbDtcbiAgICAgICAgX3RoaXMuc2NyaXB0UHJvY2Vzc29yID0gbnVsbDtcbiAgICAgICAgX3RoaXMubWVkaWFTdHJlYW1BdWRpb1NvdXJjZSA9IG51bGw7XG4gICAgICAgIF90aGlzLm1lZGlhRGV2aWNlc1N0cmVhbSA9IG51bGw7XG4gICAgICAgIF90aGlzLmF1ZGlvUmF3RnJhbWUgPSBudWxsO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIFdlYlNvY2tldFZvaWNlQ2hhdC5wcm90b3R5cGUuX3N0YXJ0Vm9pY2VDaGF0ID0gZnVuY3Rpb24gKHZvaWNlQ2hhdENvbmZpZykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZGV2aWNlc1N0cmVhbTtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9lKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfZS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW5hdmlnYXRvci5tZWRpYURldmljZXMgfHwgIW5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3Qgc3RhcnQgdm9pY2UgY2hhdCB3aXRob3V0IG1lZGlhIGRldmljZXMnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMud2ViU29ja2V0ID0gdm9pY2VDaGF0Q29uZmlnLndlYlNvY2tldDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXVkaW9SYXdGcmFtZSA9IHZvaWNlQ2hhdENvbmZpZy5hdWRpb1Jhd0ZyYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hdWRpb0NvbnRleHQgPSBuZXcgd2luZG93LkF1ZGlvQ29udGV4dCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF0ZW5jeUhpbnQ6ICdpbnRlcmFjdGl2ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtcGxlUmF0ZTogMTYwMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKChfYSA9IHZvaWNlQ2hhdENvbmZpZy5jb25maWcpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kZWZhdWx0TXV0ZWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51bm11dGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXVkaW86IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBsZVJhdGU6IDE2MDAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbm5lbENvdW50OiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b0dhaW5Db250cm9sOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNob0NhbmNlbGxhdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vaXNlU3VwcHJlc3Npb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VzU3RyZWFtID0gX2Uuc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZWRpYURldmljZXNTdHJlYW0gPSBkZXZpY2VzU3RyZWFtO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZWRpYVN0cmVhbUF1ZGlvU291cmNlID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoX2IgPSB0aGlzLmF1ZGlvQ29udGV4dCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmNyZWF0ZU1lZGlhU3RyZWFtU291cmNlKGRldmljZXNTdHJlYW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JpcHRQcm9jZXNzb3IgPSAoX2MgPSB0aGlzLmF1ZGlvQ29udGV4dCkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmNyZWF0ZVNjcmlwdFByb2Nlc3Nvcig1MTIsIDEsIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZWRpYVN0cmVhbUF1ZGlvU291cmNlLmNvbm5lY3QodGhpcy5zY3JpcHRQcm9jZXNzb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JpcHRQcm9jZXNzb3IuY29ubmVjdCgoX2QgPSB0aGlzLmF1ZGlvQ29udGV4dCkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2NyaXB0UHJvY2Vzc29yLm9uYXVkaW9wcm9jZXNzID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX3RoaXMud2ViU29ja2V0IHx8ICFfdGhpcy5hdWRpb1Jhd0ZyYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF1ZGlvRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaXNNdXRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdWRpb0RhdGEgPSBuZXcgRmxvYXQzMkFycmF5KDUxMik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdWRpb0RhdGEgPSBldmVudC5pbnB1dEJ1ZmZlci5nZXRDaGFubmVsRGF0YSgwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBjbVMxNkFycmF5ID0gY29udmVydEZsb2F0MzJUb1MxNlBDTShhdWRpb0RhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwY21CeXRlQXJyYXkgPSBuZXcgVWludDhBcnJheShwY21TMTZBcnJheS5idWZmZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmcmFtZSA9IF90aGlzLmF1ZGlvUmF3RnJhbWUuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXVkaW86IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1ZGlvOiBBcnJheS5mcm9tKHBjbUJ5dGVBcnJheSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1wbGVSYXRlOiAxNjAwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bUNoYW5uZWxzOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbmNvZGVkRnJhbWUgPSBuZXcgVWludDhBcnJheShfdGhpcy5hdWRpb1Jhd0ZyYW1lLmVuY29kZShmcmFtZSkuZmluaXNoKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChfYSA9IF90aGlzLndlYlNvY2tldCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNlbmQoZW5jb2RlZEZyYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0aG91Z2ggcm9vbSBoYXMgYmVlbiBjb25uZWN0ZWQsIGJ1dCB0aGUgc3RyZWFtIG1heSBub3QgYmUgcmVhZHkuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBzbGVlcCgyMDAwKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRob3VnaCByb29tIGhhcyBiZWVuIGNvbm5lY3RlZCwgYnV0IHRoZSBzdHJlYW0gbWF5IG5vdCBiZSByZWFkeS5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9lLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBXZWJTb2NrZXRWb2ljZUNoYXQucHJvdG90eXBlLl9zdG9wVm9pY2VDaGF0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmF1ZGlvQ29udGV4dCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvQ29udGV4dCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNjcmlwdFByb2Nlc3Nvcikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcmlwdFByb2Nlc3Nvci5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NyaXB0UHJvY2Vzc29yID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubWVkaWFTdHJlYW1BdWRpb1NvdXJjZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1lZGlhU3RyZWFtQXVkaW9Tb3VyY2UuZGlzY29ubmVjdCgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1lZGlhU3RyZWFtQXVkaW9Tb3VyY2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tZWRpYURldmljZXNTdHJlYW0pIHtcbiAgICAgICAgICAgICAgICAgICAgKF9iID0gKF9hID0gdGhpcy5tZWRpYURldmljZXNTdHJlYW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRUcmFja3MoKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7IHJldHVybiB0cmFjay5zdG9wKCk7IH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1lZGlhRGV2aWNlc1N0cmVhbSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHJldHVybiBXZWJTb2NrZXRWb2ljZUNoYXQ7XG59KEFic3RyYWN0Vm9pY2VDaGF0SW1wbGVtZW50YXRpb24pKTtcblxudmFyIFZvaWNlQ2hhdFRyYW5zcG9ydDtcbihmdW5jdGlvbiAoVm9pY2VDaGF0VHJhbnNwb3J0KSB7XG4gICAgVm9pY2VDaGF0VHJhbnNwb3J0W1wiTElWRUtJVFwiXSA9IFwibGl2ZWtpdFwiO1xuICAgIFZvaWNlQ2hhdFRyYW5zcG9ydFtcIldFQlNPQ0tFVFwiXSA9IFwid2Vic29ja2V0XCI7XG59KShWb2ljZUNoYXRUcmFuc3BvcnQgfHwgKFZvaWNlQ2hhdFRyYW5zcG9ydCA9IHt9KSk7XG52YXIgVm9pY2VDaGF0RmFjdG9yeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVm9pY2VDaGF0RmFjdG9yeSwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBWb2ljZUNoYXRGYWN0b3J5KF9hKSB7XG4gICAgICAgIHZhciB2b2ljZUNoYXRJbnN0YW5jZSA9IF9hLnZvaWNlQ2hhdEluc3RhbmNlLCBpbml0aWFsQ29uZmlnID0gX2EuaW5pdGlhbENvbmZpZztcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuaW5pdGlhbENvbmZpZyA9IGluaXRpYWxDb25maWc7XG4gICAgICAgIF90aGlzLnZvaWNlQ2hhdCA9IHZvaWNlQ2hhdEluc3RhbmNlO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShWb2ljZUNoYXRGYWN0b3J5LnByb3RvdHlwZSwgXCJpc011dGVkXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy52b2ljZUNoYXQuaXNNdXRlZDtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShWb2ljZUNoYXRGYWN0b3J5LnByb3RvdHlwZSwgXCJpc1ZvaWNlQ2hhdHRpbmdcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZvaWNlQ2hhdC5pc1ZvaWNlQ2hhdHRpbmc7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBWb2ljZUNoYXRGYWN0b3J5LnByb3RvdHlwZS5zdGFydFZvaWNlQ2hhdCA9IGZ1bmN0aW9uIChfYSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIGFyZ3VtZW50cywgdm9pZCAwLCBmdW5jdGlvbiAoX2IpIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSBfYi5jb25maWc7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9jKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYy5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMudm9pY2VDaGF0LnN0YXJ0Vm9pY2VDaGF0KF9fYXNzaWduKF9fYXNzaWduKHt9LCB0aGlzLmluaXRpYWxDb25maWcpLCB7IGNvbmZpZzogY29uZmlnIH0pKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9jLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBWb2ljZUNoYXRGYWN0b3J5LnByb3RvdHlwZS5zdG9wVm9pY2VDaGF0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMudm9pY2VDaGF0LnN0b3BWb2ljZUNoYXQoKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBWb2ljZUNoYXRGYWN0b3J5LnByb3RvdHlwZS5tdXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnZvaWNlQ2hhdC5tdXRlKCk7XG4gICAgfTtcbiAgICBWb2ljZUNoYXRGYWN0b3J5LnByb3RvdHlwZS51bm11dGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudm9pY2VDaGF0LnVubXV0ZSgpO1xuICAgIH07XG4gICAgVm9pY2VDaGF0RmFjdG9yeS5jcmVhdGVMaXZlS2l0Vm9pY2VDaGF0ID0gZnVuY3Rpb24gKHZvaWNlQ2hhdENvbmZpZykge1xuICAgICAgICByZXR1cm4gbmV3IHRoaXMoe1xuICAgICAgICAgICAgdm9pY2VDaGF0SW5zdGFuY2U6IG5ldyBMaXZla2l0Vm9pY2VDaGF0KCksXG4gICAgICAgICAgICBpbml0aWFsQ29uZmlnOiB2b2ljZUNoYXRDb25maWcsXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgVm9pY2VDaGF0RmFjdG9yeS5jcmVhdGVXZWJTb2NrZXRWb2ljZUNoYXQgPSBmdW5jdGlvbiAodm9pY2VDaGF0Q29uZmlnKSB7XG4gICAgICAgIHJldHVybiBuZXcgdGhpcyh7XG4gICAgICAgICAgICB2b2ljZUNoYXRJbnN0YW5jZTogbmV3IFdlYlNvY2tldFZvaWNlQ2hhdCgpLFxuICAgICAgICAgICAgaW5pdGlhbENvbmZpZzogdm9pY2VDaGF0Q29uZmlnLFxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHJldHVybiBWb2ljZUNoYXRGYWN0b3J5O1xufShBYnN0cmFjdFZvaWNlQ2hhdCkpO1xuXG52YXIgQXZhdGFyUXVhbGl0eTtcbihmdW5jdGlvbiAoQXZhdGFyUXVhbGl0eSkge1xuICAgIEF2YXRhclF1YWxpdHlbXCJMb3dcIl0gPSBcImxvd1wiO1xuICAgIEF2YXRhclF1YWxpdHlbXCJNZWRpdW1cIl0gPSBcIm1lZGl1bVwiO1xuICAgIEF2YXRhclF1YWxpdHlbXCJIaWdoXCJdID0gXCJoaWdoXCI7XG59KShBdmF0YXJRdWFsaXR5IHx8IChBdmF0YXJRdWFsaXR5ID0ge30pKTtcbnZhciBWb2ljZUVtb3Rpb247XG4oZnVuY3Rpb24gKFZvaWNlRW1vdGlvbikge1xuICAgIFZvaWNlRW1vdGlvbltcIkVYQ0lURURcIl0gPSBcImV4Y2l0ZWRcIjtcbiAgICBWb2ljZUVtb3Rpb25bXCJTRVJJT1VTXCJdID0gXCJzZXJpb3VzXCI7XG4gICAgVm9pY2VFbW90aW9uW1wiRlJJRU5ETFlcIl0gPSBcImZyaWVuZGx5XCI7XG4gICAgVm9pY2VFbW90aW9uW1wiU09PVEhJTkdcIl0gPSBcInNvb3RoaW5nXCI7XG4gICAgVm9pY2VFbW90aW9uW1wiQlJPQURDQVNURVJcIl0gPSBcImJyb2FkY2FzdGVyXCI7XG59KShWb2ljZUVtb3Rpb24gfHwgKFZvaWNlRW1vdGlvbiA9IHt9KSk7XG52YXIgRWxldmVuTGFic01vZGVsO1xuKGZ1bmN0aW9uIChFbGV2ZW5MYWJzTW9kZWwpIHtcbiAgICBFbGV2ZW5MYWJzTW9kZWxbXCJlbGV2ZW5fZmxhc2hfdjJfNVwiXSA9IFwiZWxldmVuX2ZsYXNoX3YyXzVcIjtcbiAgICBFbGV2ZW5MYWJzTW9kZWxbXCJlbGV2ZW5fbXVsdGlsaW5ndWFsX3YyXCJdID0gXCJlbGV2ZW5fbXVsdGlsaW5ndWFsX3YyXCI7XG59KShFbGV2ZW5MYWJzTW9kZWwgfHwgKEVsZXZlbkxhYnNNb2RlbCA9IHt9KSk7XG52YXIgU1RUUHJvdmlkZXI7XG4oZnVuY3Rpb24gKFNUVFByb3ZpZGVyKSB7XG4gICAgU1RUUHJvdmlkZXJbXCJERUVQR1JBTVwiXSA9IFwiZGVlcGdyYW1cIjtcbiAgICBTVFRQcm92aWRlcltcIkdMQURJQVwiXSA9IFwiZ2xhZGlhXCI7XG59KShTVFRQcm92aWRlciB8fCAoU1RUUHJvdmlkZXIgPSB7fSkpO1xudmFyIFRhc2tUeXBlO1xuKGZ1bmN0aW9uIChUYXNrVHlwZSkge1xuICAgIFRhc2tUeXBlW1wiVEFMS1wiXSA9IFwidGFsa1wiO1xuICAgIFRhc2tUeXBlW1wiUkVQRUFUXCJdID0gXCJyZXBlYXRcIjtcbn0pKFRhc2tUeXBlIHx8IChUYXNrVHlwZSA9IHt9KSk7XG52YXIgVGFza01vZGU7XG4oZnVuY3Rpb24gKFRhc2tNb2RlKSB7XG4gICAgVGFza01vZGVbXCJTWU5DXCJdID0gXCJzeW5jXCI7XG4gICAgVGFza01vZGVbXCJBU1lOQ1wiXSA9IFwiYXN5bmNcIjtcbn0pKFRhc2tNb2RlIHx8IChUYXNrTW9kZSA9IHt9KSk7XG4vLyBldmVudCB0eXBlcyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxudmFyIFN0cmVhbWluZ0V2ZW50cztcbihmdW5jdGlvbiAoU3RyZWFtaW5nRXZlbnRzKSB7XG4gICAgU3RyZWFtaW5nRXZlbnRzW1wiQVZBVEFSX1NUQVJUX1RBTEtJTkdcIl0gPSBcImF2YXRhcl9zdGFydF90YWxraW5nXCI7XG4gICAgU3RyZWFtaW5nRXZlbnRzW1wiQVZBVEFSX1NUT1BfVEFMS0lOR1wiXSA9IFwiYXZhdGFyX3N0b3BfdGFsa2luZ1wiO1xuICAgIFN0cmVhbWluZ0V2ZW50c1tcIkFWQVRBUl9UQUxLSU5HX01FU1NBR0VcIl0gPSBcImF2YXRhcl90YWxraW5nX21lc3NhZ2VcIjtcbiAgICBTdHJlYW1pbmdFdmVudHNbXCJBVkFUQVJfRU5EX01FU1NBR0VcIl0gPSBcImF2YXRhcl9lbmRfbWVzc2FnZVwiO1xuICAgIFN0cmVhbWluZ0V2ZW50c1tcIlVTRVJfVEFMS0lOR19NRVNTQUdFXCJdID0gXCJ1c2VyX3RhbGtpbmdfbWVzc2FnZVwiO1xuICAgIFN0cmVhbWluZ0V2ZW50c1tcIlVTRVJfRU5EX01FU1NBR0VcIl0gPSBcInVzZXJfZW5kX21lc3NhZ2VcIjtcbiAgICBTdHJlYW1pbmdFdmVudHNbXCJVU0VSX1NUQVJUXCJdID0gXCJ1c2VyX3N0YXJ0XCI7XG4gICAgU3RyZWFtaW5nRXZlbnRzW1wiVVNFUl9TVE9QXCJdID0gXCJ1c2VyX3N0b3BcIjtcbiAgICBTdHJlYW1pbmdFdmVudHNbXCJVU0VSX1NJTEVOQ0VcIl0gPSBcInVzZXJfc2lsZW5jZVwiO1xuICAgIFN0cmVhbWluZ0V2ZW50c1tcIlNUUkVBTV9SRUFEWVwiXSA9IFwic3RyZWFtX3JlYWR5XCI7XG4gICAgU3RyZWFtaW5nRXZlbnRzW1wiU1RSRUFNX0RJU0NPTk5FQ1RFRFwiXSA9IFwic3RyZWFtX2Rpc2Nvbm5lY3RlZFwiO1xuICAgIFN0cmVhbWluZ0V2ZW50c1tcIkNPTk5FQ1RJT05fUVVBTElUWV9DSEFOR0VEXCJdID0gXCJjb25uZWN0aW9uX3F1YWxpdHlfY2hhbmdlZFwiO1xufSkoU3RyZWFtaW5nRXZlbnRzIHx8IChTdHJlYW1pbmdFdmVudHMgPSB7fSkpO1xudmFyIEFQSUVycm9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhBUElFcnJvciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBBUElFcnJvcihtZXNzYWdlLCBzdGF0dXMsIHJlc3BvbnNlVGV4dCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5uYW1lID0gJ0FQSUVycm9yJztcbiAgICAgICAgX3RoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICBfdGhpcy5yZXNwb25zZVRleHQgPSByZXNwb25zZVRleHQ7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIEFQSUVycm9yO1xufShFcnJvcikpO1xudmFyIENvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yQ2xhc3MgPSBRdWFsaXR5SW5kaWNhdG9yTWl4ZXIoe1xuICAgIFRyYWNrZXJDbGFzczogTGl2ZUtpdENvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yLFxuICAgIGdldFBhcmFtczogZnVuY3Rpb24gKHJvb20pIHsgcmV0dXJuIHJvb207IH0sXG59LCB7XG4gICAgVHJhY2tlckNsYXNzOiBXZWJSVENDb25uZWN0aW9uUXVhbGl0eUluZGljYXRvcixcbiAgICBnZXRQYXJhbXM6IGZ1bmN0aW9uIChyb29tKSB7IHZhciBfYTsgcmV0dXJuICgoX2EgPSByb29tLmVuZ2luZS5wY01hbmFnZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdWJzY3JpYmVyKS5fcGM7IH0sXG59KTtcbnZhciBTdHJlYW1pbmdBdmF0YXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gU3RyZWFtaW5nQXZhdGFyKF9hKSB7XG4gICAgICAgIHZhciB0b2tlbiA9IF9hLnRva2VuLCBfYiA9IF9hLmJhc2VQYXRoLCBiYXNlUGF0aCA9IF9iID09PSB2b2lkIDAgPyAnaHR0cHM6Ly9hcGkuaGV5Z2VuLmNvbScgOiBfYjtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5yb29tID0gbnVsbDtcbiAgICAgICAgdGhpcy5tZWRpYVN0cmVhbSA9IG51bGw7XG4gICAgICAgIHRoaXMuZXZlbnRUYXJnZXQgPSBuZXcgRXZlbnRUYXJnZXQoKTtcbiAgICAgICAgdGhpcy53ZWJTb2NrZXQgPSBudWxsO1xuICAgICAgICB0aGlzLnNlc3Npb25JZCA9IG51bGw7XG4gICAgICAgIHRoaXMudm9pY2VDaGF0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5pc0xpdmVLaXRUcmFuc3BvcnQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5lbmFibGVQdXNoVG9UYWxrID0gZmFsc2U7XG4gICAgICAgIHRoaXMudG9rZW4gPSB0b2tlbjtcbiAgICAgICAgdGhpcy5iYXNlUGF0aCA9IGJhc2VQYXRoO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yID0gbmV3IENvbm5lY3Rpb25RdWFsaXR5SW5kaWNhdG9yQ2xhc3MoZnVuY3Rpb24gKHF1YWxpdHkpIHtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5lbWl0KFN0cmVhbWluZ0V2ZW50cy5DT05ORUNUSU9OX1FVQUxJVFlfQ0hBTkdFRCwgcXVhbGl0eSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZSwgXCJjb25uZWN0aW9uUXVhbGl0eVwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3IuY29ubmVjdGlvblF1YWxpdHk7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZSwgXCJpc0lucHV0QXVkaW9NdXRlZFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgIHJldHVybiAoX2IgPSAoX2EgPSB0aGlzLnZvaWNlQ2hhdCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzTXV0ZWQpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IHRydWU7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLm11dGVJbnB1dEF1ZGlvID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMudm9pY2VDaGF0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubXV0ZSgpO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS51bm11dGVJbnB1dEF1ZGlvID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIChfYSA9IHRoaXMudm9pY2VDaGF0KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudW5tdXRlKCk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLmNyZWF0ZVN0YXJ0QXZhdGFyID0gZnVuY3Rpb24gKHJlcXVlc3REYXRhKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzZXNzaW9uSW5mbztcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5uZXdTZXNzaW9uKHJlcXVlc3REYXRhKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25JbmZvID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMuc3RhcnRBdmF0YXIocmVxdWVzdERhdGEsIHNlc3Npb25JbmZvKV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5zdGFydEF2YXRhciA9IGZ1bmN0aW9uIChyZXF1ZXN0RGF0YSwgc2Vzc2lvbkluZm8pIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHJvb20sIG1lZGlhU3RyZWFtO1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2IpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9iLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2Vzc2lvbklkID0gc2Vzc2lvbkluZm8uc2Vzc2lvbl9pZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNMaXZlS2l0VHJhbnNwb3J0ID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YS52b2ljZUNoYXRUcmFuc3BvcnQgPT09IFZvaWNlQ2hhdFRyYW5zcG9ydC5MSVZFS0lUO1xuICAgICAgICAgICAgICAgICAgICAgICAgcm9vbSA9IG5ldyBSb29tKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGFwdGl2ZVN0cmVhbTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkeW5hY2FzdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlb0NhcHR1cmVEZWZhdWx0czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiBWaWRlb1ByZXNldHMuaDcyMC5yZXNvbHV0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm9vbSA9IHJvb207XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1lZGlhU3RyZWFtID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlUHVzaFRvVGFsayA9IChfYSA9IHJlcXVlc3REYXRhLmVuYWJsZVB1c2hUb1RhbGspICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgcm9vbS5vbihSb29tRXZlbnQuRGF0YVJlY2VpdmVkLCBmdW5jdGlvbiAocm9vbU1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnRNc2cgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlU3RyaW5nID0gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKHJvb21NZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRNc2cgPSBKU09OLnBhcnNlKG1lc3NhZ2VTdHJpbmcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWV2ZW50TXNnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZW1pdChldmVudE1zZy50eXBlLCBldmVudE1zZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhU3RyZWFtID0gbmV3IE1lZGlhU3RyZWFtKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByb29tLm9uKFJvb21FdmVudC5UcmFja1N1YnNjcmliZWQsIGZ1bmN0aW9uICh0cmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmFjay5raW5kID09PSAndmlkZW8nIHx8IHRyYWNrLmtpbmQgPT09ICdhdWRpbycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVkaWFTdHJlYW0uYWRkVHJhY2sodHJhY2subWVkaWFTdHJlYW1UcmFjayk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoYXNWaWRlb1RyYWNrID0gbWVkaWFTdHJlYW0uZ2V0VmlkZW9UcmFja3MoKS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGFzQXVkaW9UcmFjayA9IG1lZGlhU3RyZWFtLmdldEF1ZGlvVHJhY2tzKCkubGVuZ3RoID4gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhc1ZpZGVvVHJhY2sgJiYgaGFzQXVkaW9UcmFjayAmJiAhX3RoaXMubWVkaWFTdHJlYW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm1lZGlhU3RyZWFtID0gbWVkaWFTdHJlYW07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5lbWl0KFN0cmVhbWluZ0V2ZW50cy5TVFJFQU1fUkVBRFksIF90aGlzLm1lZGlhU3RyZWFtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcm9vbS5vbihSb29tRXZlbnQuVHJhY2tVbnN1YnNjcmliZWQsIGZ1bmN0aW9uICh0cmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZWRpYVRyYWNrID0gdHJhY2subWVkaWFTdHJlYW1UcmFjaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVkaWFUcmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWRpYVN0cmVhbS5yZW1vdmVUcmFjayhtZWRpYVRyYWNrKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvb20ub24oUm9vbUV2ZW50LkRpc2Nvbm5lY3RlZCwgZnVuY3Rpb24gKHJlYXNvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmVtaXQoU3RyZWFtaW5nRXZlbnRzLlNUUkVBTV9ESVNDT05ORUNURUQsIHJlYXNvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9iLmxhYmVsID0gMTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2IudHJ5cy5wdXNoKFsxLCAzLCAsIDRdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHJvb20ucHJlcGFyZUNvbm5lY3Rpb24oc2Vzc2lvbkluZm8udXJsLCBzZXNzaW9uSW5mby5hY2Nlc3NfdG9rZW4pXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Iuc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNF07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9iLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDRdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6IHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuc3RhcnRTZXNzaW9uKCldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYi5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCByb29tLmNvbm5lY3Qoc2Vzc2lvbkluZm8udXJsLCBzZXNzaW9uSW5mby5hY2Nlc3NfdG9rZW4pXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Iuc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5jb25uZWN0V2ViU29ja2V0KHsgdXNlU2lsZW5jZVByb21wdDogISFyZXF1ZXN0RGF0YS51c2VTaWxlbmNlUHJvbXB0IH0pXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Iuc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0Vm9pY2VDaGF0KHJlcXVlc3REYXRhLnZvaWNlQ2hhdFRyYW5zcG9ydCB8fCBWb2ljZUNoYXRUcmFuc3BvcnQuV0VCU09DS0VUKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3Iuc3RhcnQocm9vbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgc2Vzc2lvbkluZm9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuc3RhcnRWb2ljZUNoYXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgYXJndW1lbnRzLCB2b2lkIDAsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgdmFyIF9iO1xuICAgICAgICAgICAgdmFyIF9jID0gX2EgPT09IHZvaWQgMCA/IHt9IDogX2EsIGlzSW5wdXRBdWRpb011dGVkID0gX2MuaXNJbnB1dEF1ZGlvTXV0ZWQ7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9kKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfZC5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiBbNCAvKnlpZWxkKi8sICgoX2IgPSB0aGlzLnZvaWNlQ2hhdCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnN0YXJ0Vm9pY2VDaGF0KHsgY29uZmlnOiB7IGRlZmF1bHRNdXRlZDogaXNJbnB1dEF1ZGlvTXV0ZWQgfSB9KSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBfZC5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5jbG9zZVZvaWNlQ2hhdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYikge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2IubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCAoKF9hID0gdGhpcy52b2ljZUNoYXQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdG9wVm9pY2VDaGF0KCkpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Iuc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUubmV3U2Vzc2lvbiA9IGZ1bmN0aW9uIChyZXF1ZXN0RGF0YSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfZikge1xuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnJlcXVlc3QoJy92MS9zdHJlYW1pbmcubmV3Jywge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXZhdGFyX25hbWU6IHJlcXVlc3REYXRhLmF2YXRhck5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBxdWFsaXR5OiByZXF1ZXN0RGF0YS5xdWFsaXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAga25vd2xlZGdlX2Jhc2VfaWQ6IHJlcXVlc3REYXRhLmtub3dsZWRnZUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAga25vd2xlZGdlX2Jhc2U6IHJlcXVlc3REYXRhLmtub3dsZWRnZUJhc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICB2b2ljZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWNlX2lkOiAoX2EgPSByZXF1ZXN0RGF0YS52b2ljZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnZvaWNlSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZTogKF9iID0gcmVxdWVzdERhdGEudm9pY2UpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5yYXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb3Rpb246IChfYyA9IHJlcXVlc3REYXRhLnZvaWNlKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZW1vdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGV2ZW5sYWJzX3NldHRpbmdzOiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgKF9kID0gcmVxdWVzdERhdGEgPT09IG51bGwgfHwgcmVxdWVzdERhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlcXVlc3REYXRhLnZvaWNlKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QuZWxldmVubGFic1NldHRpbmdzKSwgeyBtb2RlbF9pZDogKF9lID0gcmVxdWVzdERhdGEudm9pY2UpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5tb2RlbCB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogcmVxdWVzdERhdGEubGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiAndjInLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW9fZW5jb2Rpbmc6ICdIMjY0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogJ3NkaycsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlX2lkbGVfdGltZW91dDogcmVxdWVzdERhdGEuZGlzYWJsZUlkbGVUaW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3R0X3NldHRpbmdzOiByZXF1ZXN0RGF0YS5zdHRTZXR0aW5ncyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlhX2lzX2xpdmVraXRfdHJhbnNwb3J0OiByZXF1ZXN0RGF0YS52b2ljZUNoYXRUcmFuc3BvcnQgPT09IFZvaWNlQ2hhdFRyYW5zcG9ydC5MSVZFS0lULFxuICAgICAgICAgICAgICAgICAgICAgICAgc2lsZW5jZV9yZXNwb25zZTogcmVxdWVzdERhdGEudXNlU2lsZW5jZVByb21wdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5X2lkbGVfdGltZW91dDogcmVxdWVzdERhdGEuYWN0aXZpdHlJZGxlVGltZW91dCxcbiAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5zdGFydFNlc3Npb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5yZXF1ZXN0KCcvdjEvc3RyZWFtaW5nLnN0YXJ0Jywge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9pZDogdGhpcy5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuc3BlYWsgPSBmdW5jdGlvbiAocmVxdWVzdERhdGEpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHRhc2tUeXBlLCB0YXNrTW9kZTtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICB0YXNrVHlwZSA9IHJlcXVlc3REYXRhLnRhc2tUeXBlIHx8IHJlcXVlc3REYXRhLnRhc2tfdHlwZSB8fCBUYXNrVHlwZS5UQUxLO1xuICAgICAgICAgICAgICAgIHRhc2tNb2RlID0gcmVxdWVzdERhdGEudGFza01vZGUgfHwgVGFza01vZGUuQVNZTkM7XG4gICAgICAgICAgICAgICAgLy8gbGl2ZWtpdC93ZWJzb2NrZXQgdGV4dCB0cmFuc3BvcnQgc3VwcG9ydHMgb25seSBhc3luYyB0YWxrIHRhc2tcbiAgICAgICAgICAgICAgICBpZiAodGFza1R5cGUgPT09IFRhc2tUeXBlLlRBTEsgJiYgdGFza01vZGUgPT09IFRhc2tNb2RlLkFTWU5DKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzTGl2ZUtpdFRyYW5zcG9ydCAmJiB0aGlzLnJvb20pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZExpdmVraXRNZXNzYWdlKHJlcXVlc3REYXRhLnRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0xpdmVLaXRUcmFuc3BvcnQgJiYgdGhpcy53ZWJTb2NrZXQgJiYgdGhpcy5hdWRpb1Jhd0ZyYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmRXZWJzb2NrZXRNZXNzYWdlKHJlcXVlc3REYXRhLnRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnJlcXVlc3QoJy92MS9zdHJlYW1pbmcudGFzaycsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHJlcXVlc3REYXRhLnRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uX2lkOiB0aGlzLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfbW9kZTogcmVxdWVzdERhdGEudGFza01vZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrX3R5cGU6IHJlcXVlc3REYXRhLnRhc2tUeXBlLFxuICAgICAgICAgICAgICAgICAgICB9KV07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLnN0YXJ0TGlzdGVuaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMucmVxdWVzdCgnL3YxL3N0cmVhbWluZy5zdGFydF9saXN0ZW5pbmcnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uX2lkOiB0aGlzLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5zdG9wTGlzdGVuaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMucmVxdWVzdCgnL3YxL3N0cmVhbWluZy5zdG9wX2xpc3RlbmluZycsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25faWQ6IHRoaXMuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICAgICB9KV07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLmludGVycnVwdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnJlcXVlc3QoJy92MS9zdHJlYW1pbmcuaW50ZXJydXB0Jywge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9pZDogdGhpcy5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuc3RvcEF2YXRhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIC8vIGNsZWFyIHNvbWUgcmVzb3VyY2VzXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZVZvaWNlQ2hhdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblF1YWxpdHlJbmRpY2F0b3Iuc3RvcCgpO1xuICAgICAgICAgICAgICAgIHRoaXMudm9pY2VDaGF0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy53ZWJTb2NrZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy53ZWJTb2NrZXQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy53ZWJTb2NrZXQgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5yZXF1ZXN0KCcvdjEvc3RyZWFtaW5nLnN0b3AnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uX2lkOiB0aGlzLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5wdXNoVG9UYWxrU3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNMaXZlS2l0VHJhbnNwb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigncHVzaCB0byB0YWxrIGlzIG9ubHkgc3VwcG9ydGVkIGZvciBMaXZlS2l0IHRyYW5zcG9ydCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZW5hYmxlUHVzaFRvVGFsaykge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3B1c2ggdG8gdGFsayBpcyBub3QgZW5hYmxlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMudm9pY2VDaGF0LmlzVm9pY2VDaGF0dGluZykge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3ZvaWNlIGNoYXQgaXMgbm90IGFjdGl2ZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMucm9vbSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3Jvb20gaXMgbm90IGluaXRpYWxpemVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnNlbmRMaXZla2l0TWVzc2FnZShcInB1c2hfdG9fdGFsazpzdGFydFwiKV07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLnB1c2hUb1RhbGtTdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzTGl2ZUtpdFRyYW5zcG9ydCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3B1c2ggdG8gdGFsayBpcyBvbmx5IHN1cHBvcnRlZCBmb3IgTGl2ZUtpdCB0cmFuc3BvcnQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZVB1c2hUb1RhbGspIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdwdXNoIHRvIHRhbGsgaXMgbm90IGVuYWJsZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnZvaWNlQ2hhdC5pc1ZvaWNlQ2hhdHRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3ZvaWNlIGNoYXQgaXMgbm90IGFjdGl2ZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMucm9vbSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3Jvb20gaXMgbm90IGluaXRpYWxpemVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnNlbmRMaXZla2l0TWVzc2FnZShcInB1c2hfdG9fdGFsazpzdG9wXCIpXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUua2VlcEFsaXZlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMucmVxdWVzdCgnL3YxL3N0cmVhbWluZy5rZWVwX2FsaXZlJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9pZDogdGhpcy5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUub24gPSBmdW5jdGlvbiAoZXZlbnRUeXBlLCBsaXN0ZW5lcikge1xuICAgICAgICB0aGlzLmV2ZW50VGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCBsaXN0ZW5lcik7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbiAoZXZlbnRUeXBlLCBsaXN0ZW5lcikge1xuICAgICAgICB0aGlzLmV2ZW50VGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCBsaXN0ZW5lcik7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5zZW5kTGl2ZWtpdE1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZGF0YTtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMucm9vbSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRhdGEgPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoSlNPTi5zdHJpbmdpZnkobWVzc2FnZSkpO1xuICAgICAgICAgICAgICAgIHRoaXMucm9vbS5sb2NhbFBhcnRpY2lwYW50LnB1Ymxpc2hEYXRhKGRhdGEsIHsgcmVsaWFibGU6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5zZW5kV2Vic29ja2V0TWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBmcmFtZSwgZW5jb2RlZEZyYW1lO1xuICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2MpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMud2ViU29ja2V0IHx8ICF0aGlzLmF1ZGlvUmF3RnJhbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmcmFtZSA9IChfYSA9IHRoaXMuYXVkaW9SYXdGcmFtZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZW5jb2RlZEZyYW1lID0gbmV3IFVpbnQ4QXJyYXkoKF9iID0gdGhpcy5hdWRpb1Jhd0ZyYW1lKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZW5jb2RlKGZyYW1lKS5maW5pc2goKSk7XG4gICAgICAgICAgICAgICAgdGhpcy53ZWJTb2NrZXQuc2VuZChlbmNvZGVkRnJhbWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuaW5pdFZvaWNlQ2hhdCA9IGZ1bmN0aW9uICh0cmFuc3BvcnQpIHtcbiAgICAgICAgaWYgKHRyYW5zcG9ydCA9PT0gVm9pY2VDaGF0VHJhbnNwb3J0LldFQlNPQ0tFVCkge1xuICAgICAgICAgICAgdGhpcy5sb2FkQXVkaW9SYXdGcmFtZSgpO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmF1ZGlvUmF3RnJhbWUgfHwgIXRoaXMud2ViU29ja2V0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy52b2ljZUNoYXQgPSBWb2ljZUNoYXRGYWN0b3J5LmNyZWF0ZVdlYlNvY2tldFZvaWNlQ2hhdCh7XG4gICAgICAgICAgICAgICAgd2ViU29ja2V0OiB0aGlzLndlYlNvY2tldCxcbiAgICAgICAgICAgICAgICBhdWRpb1Jhd0ZyYW1lOiB0aGlzLmF1ZGlvUmF3RnJhbWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5yb29tKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy52b2ljZUNoYXQgPSBWb2ljZUNoYXRGYWN0b3J5LmNyZWF0ZUxpdmVLaXRWb2ljZUNoYXQoe1xuICAgICAgICAgICAgICAgIHJvb206IHRoaXMucm9vbSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLnJlcXVlc3QgPSBmdW5jdGlvbiAocGF0aCwgcGFyYW1zLCBjb25maWcpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHJlc3BvbnNlLCBlcnJvclRleHQsIGpzb25EYXRhLCBlcnJvcl8yO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFswLCA1LCAsIDZdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGZldGNoKHRoaXMuZ2V0UmVxdWVzdFVybChwYXRoKSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogXCJCZWFyZXIgXCIuY29uY2F0KHRoaXMudG9rZW4pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocGFyYW1zKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEhcmVzcG9uc2Uub2spIHJldHVybiBbMyAvKmJyZWFrKi8sIDNdO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgcmVzcG9uc2UudGV4dCgpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JUZXh0ID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQVBJIHJlcXVlc3QgZmFpbGVkIHdpdGggc3RhdHVzIFwiLmNvbmNhdChyZXNwb25zZS5zdGF0dXMpLCByZXNwb25zZS5zdGF0dXMsIGVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzogcmV0dXJuIFs0IC8qeWllbGQqLywgcmVzcG9uc2UuanNvbigpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAganNvbkRhdGEgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywganNvbkRhdGEuZGF0YV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yXzIgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcl8yO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDY6IHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbiAoZXZlbnRUeXBlLCBkZXRhaWwpIHtcbiAgICAgICAgdmFyIGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KGV2ZW50VHlwZSwgeyBkZXRhaWw6IGRldGFpbCB9KTtcbiAgICAgICAgdGhpcy5ldmVudFRhcmdldC5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuZ2V0UmVxdWVzdFVybCA9IGZ1bmN0aW9uIChlbmRwb2ludCkge1xuICAgICAgICByZXR1cm4gXCJcIi5jb25jYXQodGhpcy5iYXNlUGF0aCkuY29uY2F0KGVuZHBvaW50KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuY29ubmVjdFdlYlNvY2tldCA9IGZ1bmN0aW9uIChyZXF1ZXN0RGF0YSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgd2Vic29ja2V0VXJsO1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICB3ZWJzb2NrZXRVcmwgPSBcIndzczovL1wiLmNvbmNhdChuZXcgVVJMKHRoaXMuYmFzZVBhdGgpLmhvc3RuYW1lLCBcIi92MS93cy9zdHJlYW1pbmcuY2hhdD9zZXNzaW9uX2lkPVwiKS5jb25jYXQodGhpcy5zZXNzaW9uSWQsIFwiJnNlc3Npb25fdG9rZW49XCIpLmNvbmNhdCh0aGlzLnRva2VuKS5jb25jYXQodGhpcy5pc0xpdmVLaXRUcmFuc3BvcnQgPyAnJmFyY2hfdmVyc2lvbj12MicgOiAnJywgXCImc2lsZW5jZV9yZXNwb25zZT1cIikuY29uY2F0KHJlcXVlc3REYXRhLnVzZVNpbGVuY2VQcm9tcHQsIFwiJnB1c2hfdG9fdGFsaz1cIikuY29uY2F0KHRoaXMuZW5hYmxlUHVzaFRvVGFsayk7XG4gICAgICAgICAgICAgICAgdGhpcy53ZWJTb2NrZXQgPSBuZXcgV2ViU29ja2V0KHdlYnNvY2tldFVybCk7XG4gICAgICAgICAgICAgICAgdGhpcy53ZWJTb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnREYXRhID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50RGF0YSA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50RGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZW1pdChldmVudERhdGEuZXZlbnRfdHlwZSwgZXZlbnREYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMud2ViU29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoJ2Nsb3NlJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLndlYlNvY2tldCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgICAgICAgICAgICAgICAgICAoX2EgPSBfdGhpcy53ZWJTb2NrZXQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLndlYlNvY2tldCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgKF9iID0gX3RoaXMud2ViU29ja2V0KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuYWRkRXZlbnRMaXN0ZW5lcignb3BlbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUubG9hZEF1ZGlvUmF3RnJhbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciByb290O1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5hdWRpb1Jhd0ZyYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHJvb3QgPSBwcm90b2J1Zi5Sb290LmZyb21KU09OKGpzb25EZXNjcmlwdG9yKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdWRpb1Jhd0ZyYW1lID0gcm9vdCA9PT0gbnVsbCB8fCByb290ID09PSB2b2lkIDAgPyB2b2lkIDAgOiByb290Lmxvb2t1cFR5cGUoJ3BpcGVjYXQuRnJhbWUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi9dO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcmV0dXJuIFN0cmVhbWluZ0F2YXRhcjtcbn0oKSk7XG5cbmV4cG9ydCB7IEF2YXRhclF1YWxpdHksIENvbm5lY3Rpb25RdWFsaXR5LCBFbGV2ZW5MYWJzTW9kZWwsIFNUVFByb3ZpZGVyLCBTdHJlYW1pbmdFdmVudHMsIFRhc2tNb2RlLCBUYXNrVHlwZSwgVm9pY2VDaGF0VHJhbnNwb3J0LCBWb2ljZUVtb3Rpb24sIFN0cmVhbWluZ0F2YXRhciBhcyBkZWZhdWx0IH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/../../node_modules/.pnpm/@heygen+streaming-avatar@2.1.0/node_modules/@heygen/streaming-avatar/lib/index.esm.js\n");

/***/ })

};
;